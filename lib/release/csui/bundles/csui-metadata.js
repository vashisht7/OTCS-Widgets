csui.define("csui/controls/tableheader/comment/comment.button.view",["require","csui/lib/underscore","csui/lib/marionette","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/behaviors/keyboard.navigation/tabable.region.behavior"],function(e,t,i,n,o){var a=i.View.extend({"className":"csui-comment-button","behaviors":{"TabableRegionBehavior":{"behaviorClass":o}},"constructor":function(e){i.View.call(this,e),this.listenTo(this.model,"change",this.render)},"render":function(){var e=this;return csui.require(["esoc/widgets/utils/commentdialog/commentdialog.view"],function(t){var n=new i.Region({"el":e.el});(void 0!==window.require?window.require.s.contexts._.config:window.csui.require.s.contexts._.config).roId=e.model.get("id");var o=new t({"connector":e.model.connector,"nodeid":e.model.get("id"),"CSID":e.model.get("id"),"model":e.model,"context":e.options.context});o.listenTo(o,"before:render",function(){e.triggerMethod("before:render",e)}),o.listenTo(o,"render",function(){e.triggerMethod("render",e)}),e.propagateEventsToViews(o),n.show(o)},function(){}),this}});return t.extend(a.prototype,n),a}),csui.define("csui/widgets/metadata/versions.toolbaritems",["csui/lib/underscore","i18n!csui/widgets/metadata/impl/nls/lang","csui/controls/toolbar/toolitems.factory","csui-ext!csui/widgets/metadata/versions.toolbaritems","csui/controls/toolbar/toolitem.model"],function(e,t,i,n,o){var a={"tableHeaderToolbar":new i({"main":[{"signature":"VersionProperties","name":t.ToolbarItemVersionInfo,"icon":"icon icon-toolbar-metadata","svgId":"themes--carbonfiber--image--generated_icons--action_properties32"},{"signature":"VersionDownload","name":t.ToolbarItemVersionDownload},{"signature":"VersionDelete","name":t.ToolbarItemVersionDelete},{"signature":"PromoteVersion","name":t.ToolbarItemPromoteVersion}]},{"maxItemsShown":5,"dropDownIcon":"icon icon-toolbar-more","dropDownSvgId":"themes--carbonfiber--image--generated_icons--action_more32"}),"rightToolbar":new i({"main":[{"signature":"PurgeAllVersions","name":t.ToolbarItemVersionPurgeAll}]},{"hAlign":"right"})};return n&&function(t){e.each(t,function(t){e.each(t,function(t,i){var n=a[i];if(!n)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new o(e),n.addItem(e)})})})}(n),a}),csui.define("csui/widgets/metadata/impl/metadata.tabcontentcollection.view",["csui/lib/underscore","csui/controls/tab.panel/impl/tab.contents.view","csui/utils/base"],function(e,t,i){return t.extend({"constructor":function(n,o){t.prototype.constructor.apply(this,arguments),e.extend(this,{"currentlyFocusedElement":function(e){for(var t=e&&e.shiftKey,n=this.currentlyFocusedElementInternal(e),o=this.keyboardBehavior.tabableElements.length,a=t?o-1:0;!i.isElementVisibleInParent(n,this.$el,1,1)&&a>=0&&a<o;)e.elementCursor=a+=t?-1:1,n=this.currentlyFocusedElementInternal(e);return n}})}})}),csui.define("csui/widgets/metadata/impl/header/rightbar/toolbaritems",["csui/lib/underscore","csui/utils/base","i18n!csui/controls/tabletoolbar/impl/nls/localized.strings","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","csui-ext!csui/widgets/metadata/impl/header/rightbar/toolbaritems"],function(e,t,i,n,o,a){"use strict";var s={"rightToolbar":new n({"main":[]})};return a&&function(t){e.each(t,function(t){e.each(t,function(t,i){var n=s[i];if(!n)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new o(e),n.addItem(e)})})})}(a),s}),csui.define("csui/widgets/metadata/impl/header/rightbar/toolbaritems.masks",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,n){"use strict";function o(){var o=e.config(),s=new n;this.toolbars=t.reduce(a,function(e,n){var a=new i(s,{"normalize":!1});return t.each(o,function(e,t){(e=e[n])&&a.extendMask(e)}),a.storeMask(),e[n]=a,e},{})}var a=["rightToolbar"];return o.toolbars=a,o}),csui.define("hbs!csui/widgets/metadata/impl/header/item.name/metadata.item.name",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){return'  <div class="title-edit-icon-div"></div>\r\n'},"3":function(e,t,i,n){return'  <div class="csui-metadata-item-name-dropdown"></div>\r\n'},"5":function(e,t,i,n){var o;return'    <span class="csui-undo edit-cancel inline-edit-icon" title="'+this.escapeExpression((o=null!=(o=t.cancel_edit_name_tooltip||(null!=e?e.cancel_edit_name_tooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"cancel_edit_name_tooltip","hash":{}}):o))+'"\r\n          aria-label="'+this.escapeExpression((o=null!=(o=t.cancel_edit_name_tooltip||(null!=e?e.cancel_edit_name_tooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"cancel_edit_name_tooltip","hash":{}}):o))+'"></span>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o,a;return'<div class="cs-metadata-item-name">\r\n<span class="csui-toggle-wrapper binf-hidden">\r\n  <span class="icon circular1 arrow_back cs-go-back binf-hidden1" style="display:none;"\r\n        aria-label="'+this.escapeExpression((a=null!=(a=t.goBack||(null!=e?e.goBack:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"goBack","hash":{}}):a))+'" title="'+this.escapeExpression((a=null!=(a=t.goBack||(null!=e?e.goBack:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"goBack","hash":{}}):a))+'" tabindex="0"></span>\r\n  <span class="csui-icon csui-metadata-listview csui-metadata-listview-expand-icon" role="button" title="'+this.escapeExpression((a=null!=(a=t.sidebarToggleTitle||(null!=e?e.sidebarToggleTitle:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"sidebarToggleTitle","hash":{}}):a))+'"\r\n        aria-label="'+this.escapeExpression((a=null!=(a=t.sidebarToggleTitle||(null!=e?e.sidebarToggleTitle:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"sidebarToggleTitle","hash":{}}):a))+'" tabindex="0"></span>\r\n</span><span class="csui-type-icon"></span>\r\n<div role="heading" aria-level="2" class="title-header">\r\n<span class="title binf-line-clamp" tabindex="0" title="'+this.escapeExpression((a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"name","hash":{}}):a))+'" aria-label="'+this.escapeExpression((a=null!=(a=t.nameAria||(null!=e?e.nameAria:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"nameAria","hash":{}}):a))+'" role="button"\r\n      aria-expanded="false">\r\n    '+this.escapeExpression((a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"name","hash":{}}):a))+"\r\n</span>\r\n</div>\r\n\r\n"+(null!=(o=t.unless.call(e,null!=e?e.read_only:e,{"name":"unless","hash":{},"fn":this.program(1,n,0),"inverse":this.noop}))?o:"")+"\r\n"+(null!=(o=t.if.call(e,null!=e?e.show_dropdown_menu:e,{"name":"if","hash":{},"fn":this.program(3,n,0),"inverse":this.noop}))?o:"")+'\r\n<div class="title-edit-div">\r\n  <label id="'+this.escapeExpression((a=null!=(a=t.edit_name_id||(null!=e?e.edit_name_id:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"edit_name_id","hash":{}}):a))+'" class="binf-hidden">'+this.escapeExpression((a=null!=(a=t.placeholder_text||(null!=e?e.placeholder_text:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"placeholder_text","hash":{}}):a))+'</label>\r\n  <span class="cs-icon-required category_required" title="'+this.escapeExpression((a=null!=(a=t.required_tooltip||(null!=e?e.required_tooltip:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"required_tooltip","hash":{}}):a))+'"></span>\r\n  <input type="text" class="title-input" placeholder="'+this.escapeExpression((a=null!=(a=t.placeholder_text||(null!=e?e.placeholder_text:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"placeholder_text","hash":{}}):a))+'"\r\n         value="'+this.escapeExpression((a=null!=(a=t.edit_name||(null!=e?e.edit_name:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"edit_name","hash":{}}):a))+'" aria-labelledby="'+this.escapeExpression((a=null!=(a=t.edit_name_id||(null!=e?e.edit_name_id:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"edit_name_id","hash":{}}):a))+'" aria-required="true">\r\n'+(null!=(o=t.unless.call(e,null!=e?e.hideCancelButton:e,{"name":"unless","hash":{},"fn":this.program(5,n,0),"inverse":this.noop}))?o:"")+'</div>\r\n</div>\r\n<div class="title-error-div">\r\n  <span class="title-error" title=""></span>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_header_item.name_metadata.item.name",n),n}),csui.define("hbs!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <div class="binf-dropdown">\r\n    <button id="'+this.escapeExpression((o=null!=(o=t.btnId||(null!=e?e.btnId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"btnId","hash":{}}):o))+'" type="button" class="binf-btn binf-dropdown-toggle"\r\n            data-binf-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\r\n            aria-label="'+this.escapeExpression((o=null!=(o=t.showMoreAria||(null!=e?e.showMoreAria:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"showMoreAria","hash":{}}):o))+'" title="'+this.escapeExpression((o=null!=(o=t.showMoreTooltip||(null!=e?e.showMoreTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"showMoreTooltip","hash":{}}):o))+'">\r\n      <span class="csui-button-icon icon-expandArrowDown" title="'+this.escapeExpression((o=null!=(o=t.showMoreTooltip||(null!=e?e.showMoreTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"showMoreTooltip","hash":{}}):o))+'"></span>\r\n    </button>\r\n    <ul class="binf-dropdown-menu" role="menu"></ul>\r\n  </div>\r\n'},"3":function(e,t,i,n){return'  <div class="csui-loading-parent-wrapper binf-disabled binf-hidden">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n  </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return(null!=(o=t.if.call(e,null!=e?e.hasCommands:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.program(3,n,0)}))?o:"")+"\r\n"}});return i.registerPartial("csui_widgets_metadata_impl_header_dropdown.menu_dropdown.menu",n),n}),csui.define("hbs!csui/widgets/metadata/impl/header/dropdown.menu/lazy.loading.template",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<li role="menuitem" class="csui-loading-parent-wrapper binf-disabled">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n</li>'}});return i.registerPartial("csui_widgets_metadata_impl_header_dropdown.menu_lazy.loading.template",n),n}),csui.define("css!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu",[],function(){}),csui.define("csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu.view",["module","csui/lib/jquery","csui/lib/underscore","csui/utils/log","csui/lib/backbone","csui/lib/marionette","csui/utils/commands","csui/controls/toolbar/toolitem.view","csui/models/nodes","csui/controls/toolbar/toolitems.filtered.model","hbs!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/behaviors/dropdown.menu/dropdown.menu.behavior","csui/controls/tile/behaviors/perfect.scrolling.behavior","i18n!csui/widgets/metadata/impl/nls/lang","hbs!csui/widgets/metadata/impl/header/dropdown.menu/lazy.loading.template","csui/utils/base","csui/controls/globalmessage/globalmessage","css!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu","csui/lib/binf/js/binf"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p,g,f,w){"use strict";return n=n(e.id),a.CompositeView.extend({"className":"cs-dropdown-menu","template":c,"childView":r,"childViewContainer":"ul.binf-dropdown-menu","childViewOptions":function(e){return{"role":"menuitem","command":this.collection.commands&&this.collection.commands.findWhere({"signature":e.get("signature")})}},"templateHelpers":function(){return{"hasCommands":!!this.collection.length,"btnId":i.uniqueId("dropdownMenuButton"),"showMoreTooltip":p.showMore,"showMoreAria":p.showMoreAria}},"ui":{"dropdownToggle":".binf-dropdown-toggle","dropdownMenu":".binf-dropdown-menu","loadingIconsDiv":".csui-loading-parent-wrapper"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":u},"DropdownMenuBehavior":{"behaviorClass":h},"PerfectScrolling":{"behaviorClass":m,"contentParent":".binf-dropdown-menu","suppressScrollX":!0,"includePadding":!0}},"constructor":function(e){var n={"nodes":new l([e.model]),"container":e.container,"containerCollection":e.containerCollection,"context":e.context};e.status=n,this.commands=e.commands||s,e.collection=new d(e.toolItems,{"status":n,"commands":this.commands,"delayedActions":e.containerCollection&&e.containerCollection.delayedActions,"mask":e.toolItemsMask}),e.reorderOnSort=!0,a.CompositeView.prototype.constructor.apply(this,arguments),i.defaults(this.options,e.toolItems.options),this.originatingView=e.originatingView,e.el&&t(e.el).addClass(i.result(this,"className")),this.listenTo(this,"childview:toolitem:action",this._triggerMenuItemAction).listenTo(this.model,"sync",this.render).listenTo(o,"closeToggleAction",this._closeToggle).listenTo(this.model,"change",this.render),this.model.delayedActions&&this.listenTo(this.model.delayedActions,"request",this._hide).listenTo(this.model.delayedActions,"sync error",this._show),this.model.actions&&this.listenTo(this.model.actions,"update",this._updateMenuItems)},"_updateMenuItems":function(){this.collection.silentFetch=!0,this.collection.refilter(),this.render()},"onRender":function(){if(this.model.delayedActions&&this.model.delayedActions.fetching&&this._hide(),this.collection.length){this.fetchingNonPromotedActions=!1,this.ui.dropdownToggle.binf_dropdown(),this.ui.dropdownMenu.find("> li > a.binf-hidden").removeClass("binf-hidden");var e=i.bind(function(){this.trigger("update:scrollbar"),this.ui.dropdownMenu.removeClass("adjust-dropdown-menu");var e=this.ui.dropdownMenu.offset().left,t=this.options.originatingView.$el.offset().left,i=this.ui.dropdownMenu.outerWidth(),n=this.options.originatingView.$el.width(),o=(window.innerWidth-n)/2,a=n-(e+i-o);(e+i>t+n||a+i>n)&&this.ui.dropdownMenu.addClass("adjust-dropdown-menu")},this),n=i.bind(function(){var e=this,t=this.options.model?this.options.model:this.model,n=!!t&&!!t.get("csuiLazyActionsRetrieved"),o=!!t&&!!t.isLocallyCreated;t&&!n&&t.nonPromotedActionCommands&&t.nonPromotedActionCommands.length&&!o&&(this.fetchingNonPromotedActions=!0,this.ui.dropdownMenu.append(g),t.setEnabledLazyActionCommands(!0).done(function(){e.fetchingNonPromotedActions=!1;var t=new d(e.options.toolItems,{"status":e.options.status,"commands":e.commands,"delayedActions":e.options.containerCollection&&e.options.containerCollection.lazyActions,"lazyActions":e.options.containerCollection&&e.options.containerCollection.lazyActions,"mask":e.options.toolItemsMask}),n=e.ui.dropdownMenu.find(".csui-loading-parent-wrapper");n.animate("width: 0",300,function(){n.remove(),e.collection.models.length!==t.models.length&&i.filter(t.models,function(t){if(!0===e.isDestroyed||e._isDestroyed)e.children=void 0;else{var i=t.get("signature");if(!e.collection.find({"signature":i})){e.collection.models.push(t);e.addChild(t,r).renderTextOnly()}}})})}).fail(function(t){e.fetchingNonPromotedActions=!1;var i=e.ui.dropdownMenu.find(".csui-loading-parent-wrapper"),n=new f.Error(t);i.length&&i.remove(),w.showMessage("error",n.message)}))},this);this.ui.dropdownToggle.on("binf.dropdown.after.show",e),this.ui.dropdownToggle.on("binf.dropdown.before.show",n),t(window).on("resize.metadata.header.dropdown.menu",i.debounce(e,100)),this.delegateEvents()}else{var o=this.options.model?this.options.model:this.model,a=!!o&&!!o.get("csuiLazyActionsRetrieved"),s=!!o&&!!o.isLocallyCreated;o&&!a&&o.nonPromotedActionCommands&&o.nonPromotedActionCommands.length&&!s&&(this.$el.find(".binf-dropdown").addClass("binf-hidden"),this.ui.loadingIconsDiv.removeClass("binf-hidden"),this.fetchingNonPromotedActions=!0,o.setEnabledLazyActionCommands(!0).done(i.bind(function(){this.fetchingNonPromotedActions=!1;var e=this.$el.find(".csui-loading-parent-wrapper");e.animate("width: 0",300,i.bind(function(){e.addClass("binf-hidden"),this.$el.find(".binf-dropdown").removeClass("binf-hidden"),this._updateMenuItems()},this))},this)))}},"onRenderCollection":function(){if(this.collection.length&&this.fetchingNonPromotedActions){var e=this.ui.dropdownMenu.find(".csui-loading-parent-wrapper");e.length&&e.remove(),this.ui.dropdownMenu.append(g)}},"onDestroy":function(){this.undelegateEvents(),t(window).off("resize.metadata.header.dropdown.menu")},"currentlyFocusedElement":function(){return t(this.ui.dropdownToggle)},"_hide":function(){this.$el.addClass("binf-invisible")},"_show":function(){this.$el.removeClass("binf-invisible")},"_closeToggle":function(){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&e.binf_dropdown("toggle")},"_triggerMenuItemAction":function(e,t){this.$el.find(".binf-dropdown-toggle").binf_dropdown("toggle");var o=t.toolItem,a=o.get("signature"),s=this.commands.get(a);if("Rename"===a)setTimeout(i.bind(function(){this.trigger("rename",this)},this),200);else{var r={"context":this.options.context,"nodes":new l([this.model]),"container":this.options.container,"collection":this.options.containerCollection,"originatingView":this.options.targetView?this.options.targetView:this.originatingView};try{if(!s)throw new Error('Command "'+a+'" not found.');"Delete"===a&&this.trigger("metadata:item:before:delete",this),"Move"===a&&this.trigger("metadata:item:before:move",this),s.execute(r).done(i.bind(function(e){"Delete"===a&&this.trigger("metadata:item:deleted",this)},this))}catch(e){n.warn('Executing the command "{0}" failed.\n{1}',s.get("signature"),e.message)&&console.warn(n.last)}}}})}),csui.define("csui/widgets/metadata/versions.toolbaritems.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask","csui-ext!csui/widgets/metadata/versions.toolbaritems.mask"],function(e,t,i,n,o){"use strict";return o||(o=[]),i.extend({"constructor":function(o){var a=e.config(),s=new n;i.prototype.constructor.call(this,s,{"normalize":!1}),t.each(a,function(e,t){this.extendMask(e)},this),this.storeMask(),this.context=o.context,this.node=o.node?o.node:o.model,this._updateMask(),this.listenTo(this.node,"change:id",this._updateMask)},"_updateMask":function(){var e=this.restoreMask({"silent":!0});o.forEach(function(t){(t=t({"context":this.context,"node":this.node}))&&(e=this.extendMask(t,{"silent":!0})||e)},this),e&&this.trigger("update",this)}})}),csui.define("csui/widgets/metadata/header.dropdown.menu.items",["csui/lib/underscore","i18n!csui/controls/tabletoolbar/impl/nls/localized.strings","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","csui-ext!csui/widgets/metadata/header.dropdown.menu.items","csui-ext!csui/widgets/metadata/header.item.name/menuitems"],function(e,t,i,n,o,a){"use strict";function s(t){e.each(t,function(t){e.each(t,function(t,i){var o=r[i];if(!o)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new n(e),o.addItem(e)})})})}var r={"dropdownMenuList":new i({"main":[{"signature":"Properties","name":t.ToolbarItemInformation},{"signature":"CopyLink","name":t.ToolbarItemCopyLink},{"signature":"Edit","name":t.ToolbarItemEdit},{"signature":"EmailLink","name":t.ToolbarItemEmailLinkShort},{"signature":"permissions","name":t.ToolbarItemPermissions},{"signature":"Rename","name":t.ToolbarItemRename},{"signature":"Download","name":t.ToolbarItemDownload},{"signature":"ReserveDoc","name":t.ToolbarItemReserve},{"signature":"UnreserveDoc","name":t.ToolbarItemUnreserve},{"signature":"Copy","name":t.ToolbarItemCopy},{"signature":"Move","name":t.ToolbarItemMove},{"signature":"AddVersion","name":t.ToolbarItemAddVersion},{"signature":"Delete","name":t.ToolbarItemDelete},{"signature":"Collect","name":t.ToolbarCollect},{"signature":"ZipAndDownload","name":t.MenuItemZipAndDownload}],"shortcut":[{"signature":"OriginalCopyLink","name":t.ToolbarItemOriginalCopyLink},{"signature":"OriginalEdit","name":t.ToolbarItemOriginalEdit},{"signature":"OriginalEmailLink","name":t.ToolbarItemOriginalShare},{"signature":"OriginalReserveDoc","name":t.ToolbarItemOriginalReserve},{"signature":"OriginalUnreserveDoc","name":t.ToolbarItemOriginalUnreserve},{"signature":"OriginalCopy","name":t.ToolbarItemOriginalCopy},{"signature":"OriginalMove","name":t.ToolbarItemOriginalMove},{"signature":"OriginalAddVersion","name":t.ToolbarItemAddVersion},{"signature":"OriginalDownload","name":t.ToolbarItemOriginalDownload},{"signature":"OriginalDelete","name":t.ToolbarItemOriginalDelete}]},{"maxItemsShown":0,"dropDownIcon":"icon icon-expandArrowDown","dropDownSvgId":"themes--carbonfiber--image--generated_icons--action_caret_down32"})};return a&&s(a),o&&s(o),r}),csui.define("csui/widgets/metadata/header.dropdown.menu.items.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,n){"use strict";return i.extend({"constructor":function(){var o=e.config(),a=new n;i.prototype.constructor.call(this,a,{"normalize":!1}),t.each(o,function(e,t){this.extendMask(e)},this),this.storeMask()}})}),csui.define("css!csui/widgets/metadata/impl/metadata",[],function(){}),csui.define("css!csui/widgets/metadata/impl/header/item.name/metadata.item.name",[],function(){}),csui.define("csui/widgets/metadata/impl/header/item.name/metadata.item.name.view",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/node-type.icon/node-type.icon.view","csui/utils/base","hbs!csui/widgets/metadata/impl/header/item.name/metadata.item.name","i18n!csui/widgets/metadata/impl/nls/lang","csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu.view","csui/utils/commands/versions","csui/widgets/metadata/versions.toolbaritems","csui/widgets/metadata/versions.toolbaritems.mask","csui/widgets/metadata/header.dropdown.menu.items","csui/widgets/metadata/header.dropdown.menu.items.mask","csui/models/version","csui/behaviors/item.name/item.name.behavior","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","i18n","css!csui/widgets/metadata/impl/metadata","css!csui/widgets/metadata/impl/header/item.name/metadata.item.name"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p,g,f,w,b){"use strict";var v=n.ItemView.extend({"className":"cs-metadata-item-name-container","template":s,"templateHelpers":function(){return{"name":this.modelHasEmptyName?this.readonly?this.placeHolderName:"":this.options.model.get("name"),"edit_name":this.modelHasEmptyName?"":this.options.model.get("name"),"edit_name_id":t.uniqueId("cs-metadata-edit-name"),"placeholder_text":this.placeHolderName,"nameAria":this.options.model.get("name")||r.emptyObjectNameAria,"cancel_edit_name_tooltip":r.cancelEditNameTooltip,"switch_language_tooltip":r.switchLanguageTooltip,"show_dropdown_menu":!!this.options.showDropdownMenu,"read_only":this.readonly,"goBack":r.goBackTooltip,"sidebarToggleTitle":r.expand,"hideCancelButton":this.options.mode&&"create"===this.options.mode}},"ui":{"name":".title","contextMenuDiv":".csui-metadata-item-name-dropdown","nameEditDiv":".title-edit-div","nameInput":".title-input","nameEditCancelIcon":".edit-cancel","titleError":".title-error","toggleIcon":".csui-metadata-listview","toggleWrapper":".csui-toggle-wrapper","backEle":".arrow_back","titleHeader":".title-header"},"modelEvents":{"change":"render"},"events":{"keydown":"onKeyInView","mouseenter":"onMouseEnterName","mouseleave":"onMouseLeaveName","keydown @ui.nameInput":"onKeyDown","click @ui.toggleIcon":"toggleSideBar","click @ui.backEle":"goBack","keydown @ui.toggleIcon":"toggleSideBar","keydown @ui.backEle":"goBack","keydown @ui.toggleWrapper":"_onKeyInView"},"behaviors":function(){return{"ItemName":{"behaviorClass":g,"nameSchema":this._nameSchema,"mode":this.options.mode},"TabableRegionBehavior":{"behaviorClass":f}}},"toggleSideBar":function(e){!e||13!==e.keyCode&&32!==e.keyCode&&"click"!==e.type||(this.toggleSideBarEvent(),e.preventDefault(),e.stopPropagation())},"setToggleIconTabIndex":function(){this.ui.toggleIcon.attr("tabindex",0)},"toggleSideBarEvent":function(){if(this.leftBar&&this.leftBar.length>0){var t=this.leftBar.closest(".metadata-navigation");if(t&&t.length>0){var i=this.leftBar;if(i.length>0){if(t.hasClass("csui-hide-side-bar"))t.toggleClass("csui-hide-side-bar"),e(i).show("blind",{"direction":this.direction},"200",function(){e(window).trigger("resize.tableview")}),e(this.ui.backEle).hide(),e(this.ui.toggleIcon).attr("title",r.collapse).attr("aria-label",r.collapse),e(this.ui.toggleIcon).addClass("csui-metadata-listview-collapse-icon").removeClass("csui-metadata-listview-expand-icon"),this.sideBarHidden=!1;else{var n=this;e(i).hide("blind",{"direction":this.direction},"200",function(){t.toggleClass("csui-hide-side-bar"),e(window).trigger("resize.tableview")}),e(n.ui.backEle).show().trigger("focus"),this.sideBarHidden=!0,e(this.ui.toggleIcon).attr("title",r.expand).attr("aria-label",r.expand),e(this.ui.toggleIcon).addClass("csui-metadata-listview-expand-icon").removeClass("csui-metadata-listview-collapse-icon")}e(i).promise().done(function(){var t=e.Event("toggled:navigationbar");this.closest(".metadata-navigation").find(".cs-metadata").trigger(t)})}}}},"ensureTitleLabelIcon":function(){if(this.leftBar&&this.leftBar.length>0){var t=this.leftBar.closest(".metadata-navigation");if(t&&t.length>0){this.leftBar.length>0&&(t.hasClass("csui-hide-side-bar")?(e(this.ui.toggleIcon).attr("title",r.expand).attr("aria-label",r.expand),e(this.ui.toggleIcon).addClass("csui-metadata-listview-expand-icon").removeClass("csui-metadata-listview-collapse-icon")):(e(this.ui.toggleIcon).attr("title",r.collapse).attr("aria-label",r.collapse),e(this.ui.toggleIcon).addClass("csui-metadata-listview-collapse-icon").removeClass("csui-metadata-listview-expand-icon")))}}},"constructor":function(i){i||(i={}),this._nameSchema=t.extend({"required":!0,"readonly":!1},i.nameSchema),this.listenTo(i.model,"change:name",this._updateName),this.direction=b.settings.rtl?"right":"left",n.ItemView.prototype.constructor.call(this,i),this.readonly=this._nameSchema.readonly,this.placeHolderName=r.addItemPlaceHolderName;var o=this.model.get("name");this.modelHasEmptyName=!o,this.options.showDropdownMenu&&this._createDropdownMenu(),e(window).on("resize."+this.cid,{"view":this},this._onWindowResize)},"goBack":function(e){13!==e.keyCode&&32!==e.keyCode&&"click"!==e.type||(this.options.originatingView.triggerMethod("metadata:close"),e.preventDefault(),e.stopPropagation())},"_applyToggle":function(){this.sideBarHidden||(this.ui.toggleWrapper instanceof Object&&this.ui.toggleWrapper.removeClass("binf-hidden"),this.$el.addClass("csui-metadata-header-with-toggle"),this.options.originatingView&&this.options.originatingView.mdn&&this.options.originatingView.mdn.$el.is(":visible")&&this.ui.backEle instanceof Object&&this.ui.backEle.hide())},"_removeToggle":function(){this.ui.toggleWrapper instanceof Object&&(this.ui.toggleWrapper.addClass("binf-hidden"),this.$el.removeClass("csui-metadata-header-with-toggle")),this.sideBarHidden&&this.toggleSideBarEvent()},"onDestroy":function(){this._destroyDropdownMenu(),e(window).off("resize."+this.cid).off("resize.tableview."+this.cid)},"_updateName":function(){var t=this.model.get("name");this.modelHasEmptyName=!t,this.render();var i=e(this.ui.nameInput).is(":focus");this._toggleEditMode(i||this.modelHasEmptyName||!1,!1),this.validate()},"_destroyDropdownMenu":function(){this.dropdownMenuView&&(this.cancelEventsToViewsPropagation(this.dropdownMenuView),this.dropdownMenuView.destroy())},"_createDropdownMenu":function(){var e,i=this.options.originatingView,n=this.options.model instanceof p,o=this.options.toolbarItemsMask;e=i&&i.options&&i.options.toolbarItems&&i.options.toolbarItems.dropdownMenuListInProperties?i.options.toolbarItems.dropdownMenuListInProperties:n?c.tableHeaderToolbar:h.dropdownMenuList,o||(o=n?new u(this.options):new m),this.options.showPermissionView?e=e.collection.filter(function(e){return"permissions"!=e.get("signature")}):!0!==this.options.showPropertiesCommand&&(e=e.collection.filter(function(e){return"Properties"!=e.get("signature")&&"VersionProperties"!=e.get("signature")})),this._destroyDropdownMenu();var a=this.dropdownMenuView=new l({"model":this.options.model,"container":this.options.container,"containerCollection":this.options.collection||this.options.containerCollection,"toolItems":e,"toolItemsMask":o,"originatingView":this.options.originatingView,"targetView":this.options.targetView,"context":this.options.context,"commands":n?d:this.options.commands,"metadataScenario":this.options.metadataScenario});this.listenTo(a,"rename",t.bind(this._toggleEditMode,this,!0)),this.listenTo(a,"metadata:item:before:delete",t.bind(function(e){this.trigger("metadata:item:before:delete",e)},this)),this.listenTo(a,"metadata:item:before:move",t.bind(function(e){this.trigger("metadata:item:before:move",e)},this)),this.listenTo(a,"metadata:item:deleted",t.bind(function(e){this.trigger("metadata:item:deleted",e)},this)),a.$el.on("keydown",t.bind(function(e){9===e.keyCode&&e.shiftKey&&(this.ui.backEle.is(":visible")||this.ui.toggleIcon.is(":visible"))&&(this.ui.name.prop("tabindex",0),e.stopPropagation())},this)),this.propagateEventsToViews(this.dropdownMenuView)},"_onWindowResize":function(e){if(e&&e.data&&e.data.view){var t=e.data.view;t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){t._setHideShowToggleButton()},200)}},"_setHideShowToggleButton":function(t){var i=window.matchMedia("(orientation: landscape)").matches,n=window.matchMedia("(orientation: portrait)").matches,o=t&&t.data&&t.data.view?t.data.view:this;if(o.leftBar=o.options.originatingView&&o.options.originatingView.$el.find(".metadata-sidebar"),o.leftBar&&o.leftBar.length>0){var a=o.leftBar.closest(".metadata-navigation");i?window.innerWidth<=1280?o.sideBarHidden?(o.ui.toggleWrapper instanceof Object&&o.ui.toggleWrapper.removeClass("binf-hidden"),o.ui.backEle instanceof Object&&(o.ui.backEle.css({"display":"inline-block","positin":"relative"}),o.ui.backEle.attr("tabindex",0)),this.ensureTitleLabelIcon()):(o._applyToggle(t),o.leftBar.removeClass("binf-hidden"),a.hasClass("csui-hide-side-bar")&&(o.leftBar.show(),a.toggleClass("csui-hide-side-bar"),o.ui.backEle instanceof Object&&o.ui.backEle.hide(),e(window).trigger("resize.tableview")),this.ensureTitleLabelIcon()):(this.sideBarHidden=!1,o._removeToggle(t),a.hasClass("csui-hide-side-bar")&&(o.leftBar.show(),a.toggleClass("csui-hide-side-bar"),o.ui.backEle instanceof Object&&o.ui.backEle.hide()),e(window).trigger("resize.tableview"),this.ensureTitleLabelIcon()):n&&(o._applyToggle(t),o.leftBar.length>0&&(a.hasClass("csui-hide-side-bar")||(o.leftBar.hide(),a.toggleClass("csui-hide-side-bar"),e(window).trigger("resize.tableview")),o.ui.backEle instanceof Object&&(o.ui.backEle.css({"display":"inline-block","positin":"relative"}),o.ui.backEle.attr("tabindex",0))),this.ensureTitleLabelIcon())}},"currentlyFocusedElement":function(){
return this.ui.backEle&&e(this.ui.backEle).is(":visible")?this.ui.backEle:this.ui.toggleIcon&&e(this.ui.toggleIcon).is(":visible")?this.ui.toggleIcon:e(this.options.mode&&"create"===this.options.mode?this.ui.nameInput:this.ui.name)},"onRender":function(){this.editing=!1,this.ui.nameEditDiv.addClass("binf-hidden"),this._nodeIconView&&this._nodeIconView.destroy(),this._nodeIconView=new o({"el":this.$(".csui-type-icon").get(0),"node":this.options.model}),1===this.model.get("type")&&this._nodeIconView.$el.addClass("csui-metadata-shortcut-overlay"),this._nodeIconView.render(),this.dropdownMenuView&&(this.dropdownMenuView.render(),n.triggerMethodOn(this.dropdownMenuView,"before:show",this.dropdownMenuView,this),this.ui.contextMenuDiv.append(this.dropdownMenuView.el),n.triggerMethodOn(this.dropdownMenuView,"show",this.dropdownMenuView,this)),this.modelHasEmptyName&&(this.ui.nameInput.addClass("csui-empty-with-placeholder"),this.ui.nameInput.attr("placeholder",this.placeHolderName),this.readonly&&this.ui.name.addClass("csui-empty-with-placeholder")),this._setHideShowToggleButton()},"onMouseEnterName":function(e){this.readonly||(e.preventDefault(),e.stopPropagation())},"onMouseLeaveName":function(e){this.readonly||(e.preventDefault(),e.stopPropagation())},"onKeyDown":function(e){if(this.$el.parents(".cs-item-action-metadata").find("div[class='load-container']").length>0)return!1;this.readonly||this.modelHasEmptyName&&!0!==this.inputBoxNameChange&&(this.setInputBoxValue(""),this.inputBoxNameChange=!0,this.ui.nameInput.removeClass("csui-empty-with-placeholder"))},"_validateAndSave":function(){var e=this.getValue().trim(),t=this.getInputBoxValue();if(t=t.trim(),0===t.length||e!==t){if(!0===this.validate(t)){var i=this;this.setInputBoxValue(t),this.setValue(t),this.modelHasEmptyName=!1,this.trigger("metadata:item:name:save",{"sender":this,"success":function(){i._toggleEditMode(!1,!1)},"error":function(t){i.setValue(e),i._toggleEditMode(!0),i.showInlineError(t)}})}}else this.clearInlineError(),this._toggleEditMode(!1,!1)},"_onKeyInView":function(t){9!==t.keyCode||t.shiftKey||(e(t.target).is(this.ui.backEle)?(this.ui.toggleIcon.trigger("focus"),t.stopPropagation(),t.preventDefault()):e(t.target).is(this.ui.toggleIcon)&&(this.ui.name.trigger("focus"),t.stopPropagation(),t.preventDefault()))},"onKeyInView":function(e){if(!this.readonly)return!(!this.options.mode||"create"!==this.options.mode)||(9===e.keyCode&&e.shiftKey&&e.stopPropagation(),this.ItemNameBehavior.onKeyInView(e))},"_toggleEditMode":function(e,t){if("create"!=this.options.mode)return this.ItemNameBehavior._toggleEditMode(e,t)},"getValue":function(){return this.ItemNameBehavior.getValue()},"setValue":function(e){return this.ItemNameBehavior.setValue(e)},"getInputBoxValue":function(){return this.ItemNameBehavior.getInputBoxValue()},"setInputBoxValue":function(e){return this.ItemNameBehavior.setInputBoxValue(e)},"validate":function(e){return this.ItemNameBehavior.validate(e)},"setEditModeFocus":function(){return this.ItemNameBehavior.setEditModeFocus()},"showInlineError":function(e){return this.ItemNameBehavior.showInlineError(e)},"clearInlineError":function(){return this.ItemNameBehavior.clearInlineError()},"_getErrorMessageFromResponse":function(e){return this.ItemNameBehavior._getErrorMessageFromResponse(e)},"setReadOnly":function(t){t=!!t;var i;!!this.readonly!==t?(this.readonly=t,this.render(),i=e(this.ui.nameInput).is(":focus"),this._toggleEditMode(i||this.modelHasEmptyName||!1,!1),this.validate()):(i=e(this.ui.nameInput).is(":focus"))||this.validate()},"setPlaceHolder":function(e){e||(e=r.addItemPlaceHolderName),this.placeHolderName!==e&&(this.placeHolderName=e,this.render())},"updateNameSchema":function(i){this.modelHasEmptyName&&""===this.ui.nameInput.val()&&!i.readonly&&(i.required=!0),this._nameSchema=t.extend({"required":!0,"readonly":!1},i),this.readonly=this._nameSchema.readonly,this.render(),this.ui.nameInput[0].placeholder=this.placeHolderName;var n=e(this.ui.nameInput).is(":focus");return this._toggleEditMode(n||this.modelHasEmptyName||!1,!1),this.ItemNameBehavior.updateNameSchema(i)}});return t.extend(v.prototype,w),v}),csui.define("hbs!csui/widgets/metadata/impl/header/leftbar/header.leftbar",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <span class="icon arrow_back cs-go-back" aria-label="'+this.escapeExpression((o=null!=(o=t.goBackTooltip||(null!=e?e.goBackTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"goBackTooltip","hash":{}}):o))+'"\r\n        title="'+this.escapeExpression((o=null!=(o=t.goBackTooltip||(null!=e?e.goBackTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"goBackTooltip","hash":{}}):o))+'"\r\n        role="link"></span>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return null!=(o=t.if.call(e,null!=e?e.back_button:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.noop}))?o:""}});return i.registerPartial("csui_widgets_metadata_impl_header_leftbar_header.leftbar",n),n}),csui.define("css!csui/widgets/metadata/impl/header/leftbar/header.leftbar",[],function(){}),csui.define("csui/widgets/metadata/impl/header/leftbar/header.leftbar.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","hbs!csui/widgets/metadata/impl/header/leftbar/header.leftbar","i18n!csui/widgets/metadata/impl/nls/lang","csui/behaviors/keyboard.navigation/tabable.region.behavior","css!csui/widgets/metadata/impl/header/leftbar/header.leftbar"],function(e,t,i,n,o,a){"use strict";return i.ItemView.extend({"className":"metadata-header-left-bar","template":n,"templateHelpers":function(){return{"back_button":this.options.showBackIcon,"goBackTooltip":o.goBackTooltip}},"behaviors":function(){return this.options.showBackIcon?{"TabableRegionBehavior":{"behaviorClass":a}}:{}},"ui":{"back":".cs-go-back"},"events":{"keydown":"onKeyInView","click @ui.back":"onClickClose"},"onKeyInView":function(e){var i=e||window.event,n=i.target||i.srcElement;13!==i.keyCode&&32!==i.keyCode||(i.preventDefault(),i.stopPropagation(),t(n).trigger("click"))},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,i.ItemView.prototype.constructor.call(this,e)},"currentlyFocusedElement":function(){if(this.options.showBackIcon)return t(this.ui.back)},"onClickClose":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("metadata:close")}})}),csui.define("hbs!csui/widgets/metadata/impl/header/rightbar/header.rightbar",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <div class="binf-row shortcut-div">\r\n    <a href="#" class="shortcut-switch" title="'+this.escapeExpression((o=null!=(o=t.right_label||(null!=e?e.right_label:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"right_label","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.right_label||(null!=e?e.right_label:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"right_label","hash":{}}):o))+"</a>\r\n  </div>\r\n"},"3":function(e,t,i,n){var o;return'  <div class="metadata-header-floating-rightbar">\r\n    <span class="icon close cs-metadata-close" title="'+this.escapeExpression((o=null!=(o=t.close_metadata_button_tooltip||(null!=e?e.close_metadata_button_tooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"close_metadata_button_tooltip","hash":{}}):o))+'"></span>\r\n  </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return(null!=(o=t.if.call(e,null!=e?e.is_shortcut:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.noop}))?o:"")+'<div class="csui-extra-header-wrapper"></div>\r\n'+(null!=(o=t.if.call(e,null!=e?e.show_close_icon:e,{"name":"if","hash":{},"fn":this.program(3,n,0),"inverse":this.noop}))?o:"")}});return i.registerPartial("csui_widgets_metadata_impl_header_rightbar_header.rightbar",n),n}),csui.define("css!csui/widgets/metadata/impl/header/rightbar/header.rightbar",[],function(){}),csui.define("csui/widgets/metadata/impl/header/rightbar/header.rightbar.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/commands","csui/controls/tabletoolbar/tabletoolbar.view","csui/widgets/metadata/impl/header/rightbar/toolbaritems","csui/widgets/metadata/impl/header/rightbar/toolbaritems.masks","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","hbs!csui/widgets/metadata/impl/header/rightbar/header.rightbar","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/contexts/factories/application.scope.factory","csui/controls/form/fields/booleanfield.view","csui/behaviors/keyboard.navigation/tabable.region.behavior","css!csui/widgets/metadata/impl/header/rightbar/header.rightbar"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m){var p=n.LayoutView.extend({"className":"metadata-header-right-bar","template":d,"templateHelpers":function(){var t={"show_close_icon":this.options.showCloseIcon,"close_metadata_button_tooltip":c.closeMetadataButtonTooltip};if(this.options.showShortcutSwitch&&this.options.shortcutNode){var i=c.viewOriginalMessage;return this.options.shortcutNode.original===this.node&&(i=c.viewShortcutMessage),e.extend(t,{"is_shortcut":!0,"right_label":i})}return t},"regions":{"extraToolbarRegion":".csui-extra-header-wrapper"},"behaviors":function(){return this.options.showShortcutSwitch&&this.options.shortcutNode||this.options.showCloseIcon?{"TabableRegionBehavior":{"behaviorClass":m}}:{}},"ui":{"shortcutSwitchLabel":"a.shortcut-switch","closeIcon":".cs-metadata-close"},"events":{"keydown":"onKeyInView","click @ui.shortcutSwitchLabel":"onClickShortcutSwitch","click @ui.closeIcon":"onClickClose"},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,e.toolbarItemsMasks||(e.toolbarItemsMasks=new r),e.toolbarItems||(e.toolbarItems=s),n.LayoutView.prototype.constructor.call(this,e)},"onRender":function(){this.options.showExtraRightActionBar&&(this.options.parent.$el.addClass("extended-headers"),this._showExtraRightActionBar())},"_showExtraRightActionBar":function(e){var t=this.collection||this.options.model.collection,i=(this.options.container||t)&&t.node?t.node:this.options.model,n=this.options.context&&this.options.context.getModel(u),o=!1;n&&"search"===n.get("id")&&(o=!0),this.toolbarView=new a({"toolbarItems":this.options.toolbarItems,"toolbarItemsMasks":this.options.toolbarItemsMasks,"collection":t,"model":this.options.model,"originatingView":this.options.originatingView,"context":this.options.context,"container":i,"removeContainer":o}),this.extraToolbarRegion.show(this.toolbarView)},"onKeyInView":function(e){var i=e||window.event,n=i.target||i.srcElement;13!==i.keyCode&&32!==i.keyCode||(i.preventDefault(),i.stopPropagation(),setTimeout(function(){t(n).trigger("click")},200))},"currentlyFocusedElement":function(){return this.options.showShortcutSwitch&&this.options.shortcutNode?t(this.ui.shortcutSwitchLabel):this.options.showCloseIcon?t(this.ui.closeIcon):void 0},"onClickShortcutSwitch":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("shortcut:switch")},"onClickClose":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("metadata:close")}});return e.extend(p.prototype,l),p}),csui.define("hbs!csui/widgets/metadata/impl/header/metadata.header",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){return'\r\n  <div class="metadata-header-left-bar-container"></div>\r\n  <div class="metadata-header with-right-bar"></div>\r\n\r\n'},"3":function(e,t,i,n){var o;return"\r\n"+(null!=(o=t.if.call(e,null!=e?e.back_button:e,{"name":"if","hash":{},"fn":this.program(4,n,0),"inverse":this.program(9,n,0)}))?o:"")+"\r\n"},"4":function(e,t,i,n){var o;return'\r\n    <div class="metadata-header-left-bar-container"></div>\r\n\r\n'+(null!=(o=t.if.call(e,null!=e?e.show_only_required_fields_switch:e,{"name":"if","hash":{},"fn":this.program(5,n,0),"inverse":this.program(7,n,0)}))?o:"")+"\r\n"},"5":function(e,t,i,n){return'      <div class="metadata-header with-back-button with-right-bar"></div>\r\n'},"7":function(e,t,i,n){return'      <div class="metadata-header with-back-button"></div>\r\n'},"9":function(e,t,i,n){var o;return"\r\n"+(null!=(o=t.if.call(e,null!=e?e.show_only_required_fields_switch:e,{"name":"if","hash":{},"fn":this.program(10,n,0),"inverse":this.program(12,n,0)}))?o:"")+"\r\n"},"10":function(e,t,i,n){return'      <div class="metadata-header with-right-bar"></div>\r\n'},"12":function(e,t,i,n){return'      <div class="metadata-header"></div>\r\n'},"14":function(e,t,i,n){return'  <div class="metadata-header-right-bar-container"></div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return(null!=(o=t.if.call(e,null!=e?e.is_shortcut:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.program(3,n,0)}))?o:"")+"\r\n"+(null!=(o=(t.xif||e&&e.xif||t.helperMissing).call(e,"this.show_close_icon || this.show_only_required_fields_switch || this.is_shortcut",{"name":"xif","hash":{},"fn":this.program(14,n,0),"inverse":this.noop}))?o:"")}});return i.registerPartial("csui_widgets_metadata_impl_header_metadata.header",n),n}),csui.define("css!csui/widgets/metadata/impl/header/metadata.header",[],function(){}),csui.define("csui/widgets/metadata/impl/header/metadata.header.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/impl/header/item.name/metadata.item.name.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/widgets/metadata/impl/header/leftbar/header.leftbar.view","csui/widgets/metadata/impl/header/rightbar/header.rightbar.view","hbs!csui/widgets/metadata/impl/header/metadata.header","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/log","csui/controls/form/fields/booleanfield.view","css!csui/widgets/metadata/impl/header/metadata.header","csui/lib/handlebars.helpers.xif"],function(e,t,i,n,o,a,s,r,l,d,c,u){var h=n.ItemView.extend({"className":"metadata-content-header","template":l,"templateHelpers":function(){var t={"back_button":this.options.showBackIcon,"show_close_icon":this.options.showCloseIcon,"close_metadata_button_tooltip":d.closeMetadataButtonTooltip,"show_only_required_fields_switch":this.options.showRequiredFieldsSwitch,"only_required_fields_label":d.onlyRequiredFieldsLabel};if(this.options.showShortcutSwitch&&this.options.shortcutNode){var i=d.viewOriginalMessage;return this.options.shortcutNode.original===this.node&&(i=d.viewShortcutMessage),e.extend(t,{"is_shortcut":!0,"right_label":i})}return t},"ui":{"leftbar":".metadata-header-left-bar-container","header":".metadata-header","rightbar":".metadata-header-right-bar-container"},"events":{"click .metadata-header":"onClickHeader"},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,this.originatingView=e.originatingView,n.ItemView.prototype.constructor.call(this,e),this._createMetadataHeaderLeftBarView(),this._createMetadataItemNameView(),this._createMetadataHeaderRightBarView()},"_createMetadataHeaderLeftBarView":function(){this.leftbarView&&(this.cancelEventsToViewsPropagation(this.leftbarView),this.leftbarView.destroy());var e=this.leftbarView=new s(this.options);this.listenTo(e,"metadata:close",function(e){this.trigger("metadata:close",e)}),this.propagateEventsToViews(this.leftbarView)},"_createMetadataItemNameView":function(t){this.metadataItemNameView&&(this.cancelEventsToViewsPropagation(this.metadataItemNameView),this.metadataItemNameView.destroy());var i=t||this.node,n=this.metadataItemNameView=new o({"model":i,"container":this.options.container,"containerCollection":this.options.containerCollection,"collection":this.options.collection,"context":this.options.context,"nameSchema":this._getNameSchema(),"commands":this.options.commands,"originatingView":this.options.originatingView,"showDropdownMenu":this.options.showDropdownMenu,"metadataScenario":this.options.metadataScenario,"showPermissionView":this.options.showPermissionView,"mode":this.options.action,"targetView":this.options.targetView});this.listenTo(n,"metadata:item:name:save",function(e){this.trigger("metadata:item:name:save",e)}),this.listenTo(n,"metadata:item:before:delete",e.bind(function(e){this.trigger("metadata:item:before:delete",e)},this)),this.listenTo(n,"metadata:item:before:move",e.bind(function(e){this.trigger("metadata:item:before:move",e)},this)),this.listenTo(n,"metadata:item:deleted",e.bind(function(e){this.trigger("metadata:item:deleted",e)},this)),this.listenTo(n,"update:button",e.bind(function(e){this.trigger("update:button",e)},this)),this.propagateEventsToViews(this.metadataItemNameView)},"_createMetadataHeaderRightBarView":function(t){this.rightbarView&&(this.cancelEventsToViewsPropagation(this.rightbarView),this.rightbarView.destroy());var i=t||this.node,n=this.rightbarView=new r(e.extend({},this.options,{"model":i,"parent":this,"showExtraRightActionBar":this.options.showExtraRightActionBar}));this.listenTo(n,"shortcut:switch",this.onClickShortcutSwitch),this.listenTo(n,"metadata:close",function(e){this.trigger("metadata:close",e)}),this.propagateEventsToViews(this.rightbarView)},"onRender":function(){var e=this.leftbarView.render();n.triggerMethodOn(e,"before:show",e,this),this.ui.leftbar.append(e.el);var t=this.metadataItemNameView.render();n.triggerMethodOn(t,"before:show",t,this),this.ui.header.append(t.el);var i=this.rightbarView.render();n.triggerMethodOn(i,"before:show",i,this),this.ui.rightbar.append(i.el),this.options.showCloseIcon&&this.$el.addClass("with-close-icon"),this.options.showShortcutSwitch&&this.options.shortcutNode&&this.$el.addClass("shortcut-object"),n.triggerMethodOn(e,"show",e,this),n.triggerMethodOn(t,"show",t,this),n.triggerMethodOn(i,"show",i,this)},"onBeforeDestroy":function(){this.leftbarView&&(this.cancelEventsToViewsPropagation(this.leftbarView),this.leftbarView.destroy()),this.metadataItemNameView&&(this.cancelEventsToViewsPropagation(this.metadataItemNameView),this.metadataItemNameView.destroy()),this.requiredFieldSwitchView&&this.requiredFieldSwitchView.destroy()},"onClickHeader":function(e){e.preventDefault(),e.stopPropagation()},"onClickShortcutSwitch":function(){var e=this.model;e=this.options.shortcutNode&&this.options.shortcutNode.original===this.node?this.node=this.options.shortcutNode:this.node=this.node.original,this._createMetadataItemNameView(e);var t=this.metadataItemNameView.render();n.triggerMethodOn(t,"before:show",t,this),this.ui.header.append(t.el),n.triggerMethodOn(t,"show",t,this),this._createMetadataHeaderRightBarView(e);var i=this.rightbarView.render();n.triggerMethodOn(i,"before:show",i,this),this.ui.rightbar.append(i.el),n.triggerMethodOn(i,"show",i,this);var o=i.currentlyFocusedElement();o&&o.trigger("focus"),this.trigger("shortcut:switch",{"node":e})},"getNameInputBoxValue":function(){return this.metadataItemNameView.getInputBoxValue()},"validateName":function(){var e=this.metadataItemNameView.getInputBoxValue();return this.metadataItemNameView.validate(e)},"getNameValue":function(){return this.metadataItemNameView.getValue()},"setNameEditModeFocus":function(){this.metadataItemNameView.setEditModeFocus()},"_getNameSchema":function(){var e=this.options.collection&&this.options.collection.first(),t=e&&e.get("schema"),i=t&&t.properties&&t.properties.name;return this.options.collection&&t&&!i&&c.warn("Form collection lacks name field in the first form."),i||{}}});return e.extend(h.prototype,a),h}),csui.define("csui/widgets/metadata/property.panels/categories/impl/category.form.view",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/base","csui/utils/url","csui/utils/log","csui/controls/form/form.view","csui/controls/globalmessage/globalmessage"],function(e,t,i,n,o,a,s,r){"use strict";return a=a(e.id),s.extend({"constructor":function(e){s.prototype.constructor.call(this,e),this.node=this.options.node,this.listenTo(this,"change:field",this._saveField),this.listenTo(this,"disable:active:item",this._disableItem)},"onRequestProcessing":function(e){this.propagatedView=e},"_disableItem":function(e){this.options.metadataView&&this.options.metadataView.trigger("disable:active:item")},"_saveField":function(e){if("create"!==this.mode){var t=this.getValues();this._saveChanges(t)}},"_saveChanges":function(e){if(!this.node)throw new Error("Missing node to save the categories to.");return this.isDataUpdating=!0,t.keys(e).length?this._validate(e)?(this._removeInternalProperties(e),this._blockActions(),this.node.connector.makeAjaxCall({"type":"PUT","url":o.combine(this.node.urlBase(),"categories",this.model.get("id")),"data":e}).done(t.bind(function(e){this._updateMetadataToken(e),this.trigger("forms:sync");var t=i.Event("tab:content:field:changed");this.options.metadataView&&this.options.metadataView.trigger("enable:active:item"),this.$el.trigger(t)},this)).fail(t.bind(function(e){var t=this.model.get("data");this.form.children.forEach(function(e){e.setValue(t[e.propertyId]),e.refresh()});var i=new n.Error(e);r.showMessage("error",i.message),this.trigger("forms:error")},this)).always(t.bind(function(){this.isDataUpdating=!1,this.options.metadataView&&this.options.metadataView.unblockActions(),this.trigger("request:completed",this.propagatedView),this._unblockActions()},this))):i.Deferred().reject().promise():i.Deferred().resolve().promise()},"_removeInternalProperties":function(e){var t=this.model.get("id"),i=t+"_1",n=this.model.get("schema")||{},o=n.properties&&n.properties[i];if(o){o=o.properties||(o.properties={});var s=e[i]||{};Object.keys(o).forEach(function(e){"metadata_token"===e&&a.debug('Metadata token "{1}" detected in the category "{0}".',t,s[e])&&console.log(a.last),o[e].readonly&&delete s[e]})}},"_updateMetadataToken":function(e){var t=this.model.get("id"),i=t+"_1",n=this.model.get("schema")||{},o=n.properties&&n.properties[i];if(o&&(o=o.properties||(o.properties={}),o.metadata_token))try{var s=e.state.categories[0][t].metadata_token;this.form.childrenByPropertyId[i].childrenByPropertyId.metadata_token.setValue(s),a.debug('Metadata token in the category "{0}" updated to "{1}".',t,s)&&console.log(a.last)}catch(e){a.warn('Updating metadata token the category "{0}" failed.',t)&&console.log(a.last)}}})}),csui.define("csui/widgets/metadata/metadata.general.form.fields",["csui/lib/underscore","csui/lib/backbone","csui-ext!csui/widgets/metadata/metadata.general.form.fields"],function(e,t,i){var n=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),o=t.Collection.extend({"model":n,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),a=new o;return i&&(i=e.flatten(i,!0),e.each(i,function(){var e=i.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),a.add(i)),a}),csui.define("css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view",[],function(){}),csui.define("csui/widgets/metadata/general.form.fields/impl/general.form.fields.view",["csui/lib/underscore","csui/lib/marionette","csui/controls/form/form.view","css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view"],function(e,t,i){"use strict";return t.CollectionView.extend({"className":"csui-general-form-fields","getChildView":function(t){var n=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return n&&n.formView||i},"childViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.mode,"generalFormView":this.view,"fetchedModels":this.options.fetchedModels,"displayedModels":this.options.displayedModels,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"layoutMode":"singleCol"},n=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return n&&e.extend(i,n.formViewOptions),i},"constructor":function(e){t.CollectionView.prototype.constructor.call(this,e),this.listenTo(this,"render",this._triggerRenderForms)},"_triggerRenderForms":function(){var t=this.children.map(function(i){var n=i.cid;return i.once("render:form",function(){t=e.without(t,n),t.length||this.triggerMethod("render:forms",this)},this),i.cid},this)}})}),csui.define("csui/widgets/metadata/general.form.fields/general.form.field.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/metadata.general.form.fields","csui/widgets/metadata/general.form.fields/impl/general.form.fields.view","csui/dialogs/modal.alert/modal.alert"],function(e,t,i,n,o,a,s){"use strict";return n.Behavior.extend({"constructor":function(t,i){n.Behavior.prototype.constructor.apply(this,arguments),this.view=i,this.listenTo(this.view,"render",this._insertFieldExtensions).listenTo(this.view,"destroy",this._emptyExtensionRegion);var o=this;i.getGeneralFormFieldValues=function(){var t={};return o.fieldRegion&&o.fieldRegion.currentView.children.each(function(i){var n,o,a=i.getValues(),s=i.model.get("role_name");a&&(s?(n=t.roles||(t.roles={}),o=n[s]||(n[s]={}),e.extend(o,a)):e.extend(t,a))}),t}},"_insertFieldExtensions":function(){var t=this.getOption("fieldParent");if(e.isFunction(t)&&(t=t.call(this.view)),t&&(t=this.view.$(t)[0]),t){var o=this.getOption("fieldDescriptors");if(e.isFunction(o)&&(o=o.call(this.view)),o&&o.length){this.fieldRegion=new n.Region({"el":t});var s=this.getOption("fieldViewOptions");e.isFunction(s)&&(s=s.call(this.view));var r=new i.Collection(e.pluck(o,"formModel")),l=new a(e.extend({"context":this.view.options.context,"fieldDescriptors":o,"collection":r,"node":this.view.options.node,"mode":this.view.options.mode,"generalFormView":this.view,"fetchedModels":this.view.options.fetchedModels,"displayedModels":this.view.options.displayedModels,"originatingView":this.view.options.originatingView,"metadataView":this.view.options.metadataView},s));this.listenTo(l,"render:forms",function(){this.view.triggerMethod("render:general:form:fields",l)}),this.fieldRegion.show(l)}}},"_emptyExtensionRegion":function(){this.fieldRegion&&this.fieldRegion.empty()}},{"getFieldDescriptors":function(i){var n,a;"create"===i.action?(n="getGeneralFormFieldsForCreate",a=[{"forms":i.forms}]):"copy"===i.action?(n="getGeneralFormFieldsForCopy",a=[{"forms":i.forms}]):"move"===i.action?(n="getGeneralFormFieldsForMove",a=[{"forms":i.forms}]):n="getGeneralFormFields";var s=o.chain().map(function(t){var o=t.get("controller"),s=t.get("controllerOptions"),r=new o(e.extend({"context":i.context,"model":i.node,"fetchedModels":i.forms},s)),l=r[n];return l&&l.apply(r,a)}).compact().value();return t.when.apply(t,s).then(function(){return e.flatten(arguments)})}})}),csui.define("csui/widgets/metadata/metadata.general.action.fields",["csui/lib/underscore","csui/lib/backbone","csui-ext!csui/widgets/metadata/metadata.general.action.fields"],function(e,t,i){var n=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),o=t.Collection.extend({"model":n,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),a=new o;return i&&(i=e.flatten(i,!0),e.each(i,function(){var e=i.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),a.add(i)),a}),csui.define("csui/widgets/metadata/general.action.fields/impl/general.action.fields.view",["csui/lib/underscore","csui/lib/marionette","csui/controls/form/form.view","css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view"],function(e,t,i){"use strict";return t.CollectionView.extend({"className":"csui-general-action-fields","getChildView":function(t){var n=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return n&&n.formView||i},"childViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.mode,"generalFormView":this.view,"fetchedModels":this.options.fetchedModels,"displayedModels":this.options.displayedModels,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"layoutMode":"singleCol"},n=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return n&&e.extend(i,n.formViewOptions),i},"constructor":function(e){t.CollectionView.prototype.constructor.call(this,e),this.listenTo(this,"render",this._triggerRenderForms)},"_triggerRenderForms":function(){var t=this.children.map(function(i){var n=i.cid;return i.once("render:form",function(){t=e.without(t,n),t.length||this.triggerMethod("render:forms",this)},this),i.cid},this)}})}),csui.define("csui/widgets/metadata/general.action.fields/general.action.field.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/metadata.general.action.fields","csui/widgets/metadata/general.action.fields/impl/general.action.fields.view","csui/dialogs/modal.alert/modal.alert"],function(e,t,i,n,o,a,s){"use strict";return n.Behavior.extend({"constructor":function(t,i){n.Behavior.prototype.constructor.apply(this,arguments),this.view=i,this.listenTo(this.view,"render",this._insertFieldExtensions).listenTo(this.view,"destroy",this._emptyExtensionRegion);var o=this;i.getGeneralActionFieldValues=function(){var t={};return o.fieldRegion&&o.fieldRegion.currentView.children.each(function(i){var n,o,a=i.getValues(),s=i.model.get("role_name");a&&(s?(n=t.roles||(t.roles={}),o=n[s]||(n[s]={}),e.extend(o,a)):e.extend(t,a))}),t}},"_insertFieldExtensions":function(){var t=this.getOption("fieldParent");if(e.isFunction(t)&&(t=t.call(this.view)),t&&(t=this.view.$(t)[0]),t){var o=this.getOption("fieldDescriptors");if(e.isFunction(o)&&(o=o.call(this.view)),o&&o.length){this.fieldRegion=new n.Region({"el":t});var s=this.getOption("fieldViewOptions");e.isFunction(s)&&(s=s.call(this.view));var r=new i.Collection(e.pluck(o,"formModel")),l=new a(e.extend({"context":this.view.options.context,"fieldDescriptors":o,"collection":r,"node":this.view.options.node,"mode":this.view.options.mode,"generalFormView":this.view,"fetchedModels":this.view.options.fetchedModels,"displayedModels":this.view.options.displayedModels,"originatingView":this.view.options.originatingView,"metadataView":this.view.options.metadataView},s));this.listenTo(l,"render:actions",function(){this.view.triggerMethod("render:general:action:fields",l)}),this.fieldRegion.show(l)}}},"_emptyExtensionRegion":function(){this.fieldRegion&&this.fieldRegion.empty()}},{"getFieldDescriptors":function(i){var n,a;"create"===i.action?(n="getGeneralActionFieldsForCreate",a=[{"forms":i.forms}]):"copy"===i.action?(n="getGeneralActionFieldsForCopy",a=[{"forms":i.forms}]):"move"===i.action?(n="getGeneralActionFieldsForMove",a=[{"forms":i.forms}]):n="getGeneralActionFields";var s=o.chain().map(function(t){var o=t.get("controller"),s=t.get("controllerOptions"),r=new o(e.extend({"context":i.context,"model":i.node,"fetchedModels":i.forms},s)),l=r[n];return l&&l.apply(r,a)}).compact().value();return t.when.apply(t,s).then(function(){return e.flatten(arguments)})}})}),csui.define("csui/widgets/metadata/general.panels/node/server.adaptor.mixin",["csui/lib/underscore","csui/lib/backbone","csui/utils/nodesprites","csui/controls/table/cells/size/size.view","csui/utils/base","csui/utils/url","csui/models/form","csui/models/version","csui/models/mixins/node.resource/node.resource.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,a,s,r,l,d){"use strict";var c={"makeServerAdaptor":function(e){return this},"url":function(){var t,i=this.options.node,n=i.get("id")
;return t=void 0===n?e.str.sformat("forms/nodes/create?type={0}&parent_id={1}",i.get("type"),i.get("parent_id")):i instanceof r?e.str.sformat("forms/nodes/versions/properties/general?id={0}&version_number={1}",n,i.get("version_number")):e.str.sformat("forms/nodes/properties/general?id={0}",n),a.combine(this.connector.connection.url,t)},"parse":function(t,i){var n=e.extend({"data":{},"schema":{},"options":{}},t.form||t.forms&&t.forms[0]||t),o=n.title||this.get("title")||d.general;return n.options=e.omit(n.options,"form"),n.schema.title||(n.schema.title=o),n.title||(n.title=o),this._addCreatorInfo(n,i),this._addOwnerInfo(n,i),this._addCreateDateInfo(n,i),this._addModifyDateInfo(n,i),this._addMimeTypeInfo(n,i),this._addSizeInfo(n,i),this._addItemidInfo(n,i),this._ensurePlaceholder(n,i),this._addReserveInfo(n,i),this._addMimeTypeClassNameInfo(n,i),n},"_addSizeInfo":function(t,i){this.options.node.get("type");this.sizeView=new n({"model":this.options.node,"column":{"name":this.options.node.has("size")?"size":"file_size"}});e.extend(t.data,{"size":this.sizeView.getValueData().formattedValue||this.options.node.get("size_formatted")});e.extend(t.options.fields,{"size":{"hidden":!1,"readonly":!0,"label":d.formFieldSizeLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"size":{"hidden":!1,"readonly":!0,"title":d.formFieldSizeLabel,"type":"string"}})},"_addItemidInfo":function(t,i){if(this.node){this.options.node.get("type"),e.extend(t.data,{"itemId":this.node.get("id")});e.extend(t.options.fields,{"itemId":{"hidden":!1,"readonly":!0,"label":d.formFieldItemIdLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"itemId":{"hidden":!1,"readonly":!0,"label":d.formFieldItemIdLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text","tooltip":this.node.get("id")}})}},"_addCreateDateInfo":function(e,t){e.options.fields.create_date&&(e.options.fields.create_date.type="datetime",e.options.fields.create_date.placeholder=d.alpacaPlaceholderNotAvailable,e.schema.properties.create_date.format="datetime")},"_addModifyDateInfo":function(e,t){e.options.fields.modify_date&&(e.options.fields.modify_date.type="datetime",e.options.fields.modify_date.placeholder=d.alpacaPlaceholderNotAvailable,e.schema.properties.modify_date.format="datetime")},"_addOwnerInfo":function(e,t){var i="owner_user_id";if(this.node instanceof r&&(i="owner_id"),e.options.fields[i]){var n=-3===this.node.get("owner_user_id"),a=n?{"id":-3}:this.node.get("owner_user_id_expand")||this.node.get("owner_user_id")||this.node.get("owner_id");a&&a instanceof Object&&(e.data[i]=a.id,e.options.fields[i].type="otcs_user",e.options.fields[i].type_control={"name":n?d.NoOwner:o.formatMemberName(a)},e.options.fields[i].placeholder=d.alpacaPlaceholderNotAvailable)}},"_addCreatorInfo":function(e,t){if(e.options.fields.create_user_id){var i=this.node.get("create_user_id_expand")||this.node.get("create_user_id");i&&i instanceof Object&&(e.data.create_user_id=i.id,e.options.fields.create_user_id.type="otcs_user",e.options.fields.create_user_id.type_control={"name":o.formatMemberName(i)},e.options.fields.create_user_id.placeholder=d.alpacaPlaceholderNotAvailable)}},"_addMimeTypeInfo":function(t,n){var o=(this.options.node.get("type"),this.options.node);e.extend(t.data,{"mime_type":i.findTypeByNode(o)}),e.extend(t.options.fields,{"mime_type":{"hidden":!1,"readonly":!0,"label":d.formFieldTypeLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"mime_type":{"hidden":!1,"readonly":!0,"title":d.formFieldTypeLabel,"type":"string"}})},"_addMimeTypeClassNameInfo":function(t,n){var o=(this.options.node.get("type"),this.options.node);e.extend(t.data,{"mimeTypeClassName":i.findClassByNode(o)})},"_ensurePlaceholder":function(e,t){if(e.options.fields.description){var i=e.options.fields.description;void 0!==i.placeholder&&0!==i.placeholder.length||(i.placeholder=d.alpacaPlaceholderDescription)}},"_addReserveInfo":function(t,i){e.extend(t.data,{"reserve_info":this.options.node.get("reserved")?this:void 0});e.extend(t.options.fields,{"reserve_info":{"hidden":!1,"readonly":!0,"label":d.formFieldReservedByLabel,"type":"otcs_reserve_button"}}),e.extend(t.schema.properties,{"reserve_info":{"hidden":!1,"readonly":!0,"type":"otcs_reserve_button"}})}};return{"mixin":function(t){return e.extend(t,c)}}}),csui.define("csui/widgets/metadata/general.panels/node/node.general.form.model",["csui/lib/jquery","csui/lib/underscore","csui/models/form","csui/models/mixins/node.resource/node.resource.mixin","csui/widgets/metadata/general.panels/node/server.adaptor.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,a){"use strict";var s=i.extend({"defaults":{"id":"general"},"constructor":function(e,t){i.prototype.constructor.apply(this,arguments),this.makeNodeResource(t).makeServerAdaptor(t)}});return n.mixin(s.prototype),o.mixin(s.prototype),s}),csui.define("csui/widgets/metadata/general.panels/document/document.general.form.model",["csui/lib/underscore","csui/utils/base","csui/controls/table/cells/size/size.view","csui/widgets/metadata/general.panels/node/node.general.form.model","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o){"use strict";return n.extend({"constructor":function(e,t){n.prototype.constructor.apply(this,arguments)},"parse":function(e,t){var i=n.prototype.parse.apply(this,arguments);return this._addSizeInfo(i,t),i},"_addSizeInfo":function(n,a){var s=(this.options.node.get("type"),this.options.node.has("size")),r=(s?"":"file_")+"size";this.sizeView=new i({"model":this.options.node,"column":{"name":r}});var l=this.sizeView.getValueData().formattedValue;e.extend(n.data,{"size":l||t.getReadableFileSizeString(this.options.node.get("size"))});e.extend(n.options.fields,{"size":{"hidden":!1,"readonly":!0,"label":o.formFieldSizeLabel,"placeholder":o.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(n.schema.properties,{"size":{"hidden":!1,"readonly":!0,"title":o.formFieldSizeLabel,"type":"string","tooltip":this.sizeView.getValueData().value}})}})}),csui.define("hbs!csui/widgets/metadata/general.panels/node/impl/node.general.form",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn cs-form-leftcolumn">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="typename_section general-information"></div>\r\n      {{#if options.showSize}}\r\n      <div class="size_section general-information"></div>\r\n      {{/if}}\r\n      <div class="reserve_info general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n      <div class="csui-action-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.aria_label}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_node_impl_node.general.form",n),n}),csui.define("css!csui/widgets/metadata/general.panels/node/impl/node.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/node/node.general.form.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/controls/form/form.view","csui/behaviors/default.action/default.action.behavior","csui/widgets/metadata/general.form.fields/general.form.field.behavior","csui/widgets/metadata/general.action.fields/general.action.field.behavior","csui/models/version","csui/controls/globalmessage/globalmessage","hbs!csui/widgets/metadata/general.panels/node/impl/node.general.form","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/base","csui/utils/contexts/factories/next.node","csui/utils/commands","csui/utils/commands/versions","css!csui/widgets/metadata/general.panels/node/impl/node.general.form"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p){"use strict";return n.extend({"behaviors":{"defaultAction":{"behaviorClass":o},"generalFormFields":{"behaviorClass":a,"fieldParent":".csui-extra-general-fields","fieldDescriptors":function(){return this.options.generalFormFieldDescriptors},"fieldViewOptions":function(){return{"context":this.options.context,"node":this.node,"mode":this.options.mode,"originatingView":this,"metadataView":this.options.metadataView}}},"generalActionFields":{"behaviorClass":s,"fieldParent":".csui-action-fields","fieldDescriptors":function(){return this.options.generalActionFieldDescriptors},"fieldViewOptions":function(){return{"context":this.options.context,"node":this.node,"mode":this.options.mode,"originatingView":this,"metadataView":this.options.metadataView}}}},"className":"cs-form csui-general-form","fieldToRefresh":["modify_date","reserve_info"],"constructor":function(i){n.prototype.constructor.call(this,i),this.node=this.options.node,this.fieldToRefresh=e.union(this.fieldToRefresh,i.fieldToRefresh||[]),this.listenTo(this,"change:field",this._saveField),this.listenTo(this.node,"change",e.bind(function(){"create"!==this.mode&&this.model.fetch();var e=t.Event("tab:content:field:changed");this.$el.trigger(e)},this)),this.listenTo(this,"before:destroy",this._stopListeningToThumbnailClick),this.defaultActionController.getAction(this.options.node)||(this.noDefaultActionExist=!0)},"formTemplate":d,"onRequestProcessing":function(e){this.propagatedView=e},"formTemplateHelpers":function(){var t=this.node.get("type_name"),i=this.node.get("name");return{"showThumbnail":"create"!==this.mode,"showSize":""!==this.model.get("data").size||""!==this.model.get("data").size_formatted,"reserved":this.node.get("reserved"),"title":this.noDefaultActionExist?"":e.str.sformat(c.openDoc,t),"aria_label":this.noDefaultActionExist?"":e.str.sformat(c.openDocAria,t,i)}},"_getLayout":function(){return{"parent":"bootstrap-csui","layout":{"template":this.getOption("formTemplate").call(this,{"data":this.alpaca.data,"mode":this.mode}),"bindings":this._getBindings()}}},"_getBindings":function(){var t={"name":"name_section","create_date":".owner_section","create_user_id":".owner_section","modify_date":".owner_section","owner_user_id":".owner_section","mime_type":".typename_section","description":".description_section","itemId":".owner_section","size":".size_section"};return this.node.get("reserved")&&(t=e.extend(t,{"reserve_info":".reserve_info"})),this.node instanceof r&&(t=e.extend(t,{"version_number_name":".owner_section","owner_id":".owner_section"})),t},"_saveField":function(e){if("create"!==this.mode){var t=e.targetField,i={};i[t.name]=t.value,this._saveChanges(i)}},"_saveChanges":function(t){var i=this.model.options.node,n=this,o=n.options.metadataView&&n.options.metadataView.thumbnailViewState;this.isDataUpdating=!0,i.save(t,{"wait":!0,"silent":o,"patch":!0}).then(function(){return i.fetch()}).fail(function(e){var t=n.model.get("data");n.form.children.forEach(function(e){e.setValue(t[e.propertyId]),e.refresh()});var i=new u.Error(e);l.showMessage("error",i.message),n.trigger("forms:error")}).always(e.bind(function(){this.isDataUpdating=!1,this.options.metadataView&&this.options.metadataView.unblockActions(),this.trigger("request:completed",this.propagatedView),this._unblockActions()},this))},"updateRenderedForm":function(e){this.updateReserveFieldDisplay(),n.prototype.updateRenderedForm.apply(this,arguments),this._showDefaultImage(),this._listenToThumbnailClick(),this.$(".thumbnail_section").on("focusin",function(e){u.checkAndScrollElemToViewport(e.currentTarget)});var t=this.options.generalFormFieldDescriptors;t&&t.length&&this.listenToOnce(this,"render:general:form:fields",e.async())},"setFocus":function(){var e=this.$form.find(".alpaca-field:not(.alpaca-readonly) button");e.length>0&&e.first().trigger("focus")},"updateForm":function(){(this.node.isReservedClicked||this.node.isUnreservedClicked)&&(this.render(),this.node.isReservedClicked=!1,this.node.isUnreservedClicked=!1);var e=this.$el.alpaca("get"),t=!!this.node.collection&&!!this.node.collection.requireSwitched;if(e)for(var i=this.model.get("data"),n=0;n<this.fieldToRefresh.length;n++){var o=e.childrenByPropertyId[this.fieldToRefresh[n]],a=i[this.fieldToRefresh[n]];o&&o.getValue()!==a&&!t&&(o.setValue(a),o.refresh())}return this.thumbnail&&this.thumbnail.imgUrl||this._showDefaultImage(),this.updateReserveFieldDisplay(),this},"updateReserveFieldDisplay":function(){var e=this.$el.find(".reserve_info");this.node.get("reserved")?e.hasClass("binf-hidden")&&e.removeClass("binf-hidden"):e.hasClass("binf-hidden")||e.addClass("binf-hidden")},"_showDefaultImage":function(){var e=this.$el.find(".default_thumbnail"),i="thumbnail_missing";this.options&&this.options.model.get("data")&&(i=this.options.model.get("data").mimeTypeClassName),e.addClass(i),e.removeClass("thumbnail_empty");var n=t.Event("tab:content:render");this.$el.trigger(n),this.noDefaultActionExist&&this.$el.find(".default_thumbnail").addClass("thumbnail_disabled")},"_listenToThumbnailClick":function(){this._stopListeningToThumbnailClick(),this._thumbnailClickHandler=e.bind(this._handleThumbnailClick,this),this.$(".thumbnail_section").on("click",this._thumbnailClickHandler)},"_stopListeningToThumbnailClick":function(){this._thumbnailClickHandler&&(this.$(".thumbnail_section").off("click",this._thumbnailClickHandler),this._thumbnailClickHandler=void 0)},"_handleThumbnailClick":function(){var e,t=this.options.context,n=this.options.node,o={"nodes":new i.Collection([n])},a={"context":t,"originatingView":this};if(n instanceof r)return e=p.get("VersionOpen"),e.execute(o,a);if(e=m.get("Open"),e.enabled(o,a))return e.execute(o,a);var s=this.options.context.getModel(h);if(n.get("container")&&n.get("id")===s.get("id"))return void(this.options.metadataView&&this.options.metadataView._closeMetadata());this.triggerMethod("execute:DefaultAction",n)}})}),csui.define("hbs!csui/widgets/metadata/general.panels/document/impl/document.general.form",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn cs-form-leftcolumn">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="typename_section general-information"></div>\r\n      <div class="size_section general-information"></div>\r\n      <div class="reserve_info general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="thumbnail_not_loaded thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.aria_label}}"></span>\r\n          <img src="{{options.imgSrc}}" class="img-doc-preview binf-hidden"\r\n               alt="{{options.imgAlt}}">\r\n        </div>\r\n        {{/if}}\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_document_impl_document.general.form",n),n}),csui.define("css!csui/widgets/metadata/general.panels/document/impl/document.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/document/document.general.form.view",["csui/lib/underscore","csui/lib/jquery","csui/utils/thumbnail/thumbnail.object","csui/widgets/metadata/general.panels/node/node.general.form.view","hbs!csui/widgets/metadata/general.panels/document/impl/document.general.form","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/general.panels/document/impl/document.general.form"],function(e,t,i,n,o,a){"use strict";return n.extend({"constructor":function(e){n.prototype.constructor.call(this,e),this.thumbnail=this.options.thumbnail||new i({"node":this.options.node}),this.listenTo(this.thumbnail,"loadUrl",this._showImage).listenTo(this.thumbnail,"error",this._showDefaultImage).listenTo(this,"destroy",function(){this.thumbnail.destroy()})},"formTemplate":o,"fieldToRefresh":["modify_date","reserve_info","mime_type","size"],"formTemplateHelpers":function(){var t=this.node.get("type_name"),i=this.node.get("name");return{"showThumbnail":"create"!==this.mode,"title":e.str.sformat(a.openDoc,t),"aria_label":e.str.sformat(a.openDocAria,t,i),"reserved":this.node.get("reserved"),"imgSrc":"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=","imgAlt":a.docPreviewAlt}},"_getBindings":function(){var t=n.prototype._getBindings.apply(this,arguments);return e.extend(t,{"size":".size_section"})},"updateRenderedForm":function(e){if(n.prototype.updateRenderedForm.apply(this,arguments),"create"!==this.mode){this.thumbnail.imgUrl?this._showImage():this.thumbnail.loadUrl()}},"_showImage":function(){var e=this,i=this.$el.find(".img-doc-preview"),n=this.$el.find(".thumbnail_not_loaded");i.attr("src",this.thumbnail.imgUrl),i.prop("tabindex","0"),i.one("load",function(o){o.target.clientHeight>=o.target.clientWidth?i.addClass("cs-form-img-vertical"):i.addClass("cs-form-img-horizontal"),i.addClass("cs-form-img-border"),n.addClass("binf-hidden"),i.removeClass("binf-hidden");var a=t.Event("tab:content:render");e.$el.trigger(a)})},"_showDefaultImage":function(){var i=this.$el.find(".img-doc-preview"),n=this.$el.find(".thumbnail_not_loaded"),o="thumbnail_missing";this.options&&this.options.model.get("data")&&(o=this.options.model.get("data").mimeTypeClassName),!!n.prop("className")&&n.prop("className").split(" ").forEach(e.bind(function(e){0===e.indexOf("mime")&&n.removeClass(e)},n)),n.addClass(o),n.removeClass("thumbnail_empty"),n.removeClass("csui-icon-notification-error"),n.removeClass("binf-hidden"),i.addClass("binf-hidden");var a=t.Event("tab:content:render");this.$el.trigger(a)}})}),csui.define("csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.model",["csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/models/specificnodemodel","csui/models/mixins/syncable.from.multiple.sources/syncable.from.multiple.sources.mixin"],function(e,t,i,n){"use strict";var o=t.extend({"constructor":function(e,i){t.prototype.constructor.apply(this,arguments),this.makeSyncableFromMultipleSources(i)},"_mergeSources":function(t,i){var n=t[0].forms[0],o=i[0].forms[0];e.extend(o.data,n.data),e.extend(o.options.fields,n.options.fields),e.extend(o.schema.properties,n.schema.properties),o.options=e.omit(o.options,"form"),this.set(o)},"sync":function(){var e=new i(this.node.attributes,{"connector":this.connector,"node":this.node,"context":this.options.context}),n=new t(this.node.attributes,{"connector":this.connector,"node":this.options.node,"context":this.options.context}),o=e.fetch(),a=n.fetch(),s={"parse":!1};return this.syncFromMultipleSources([o,a],this._mergeSources,s)}});return n.mixin(o.prototype),o}),csui.define("hbs!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn\r\n    cs-form-leftcolumn">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="typename_section general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.title}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        <div class="shortcut_section general-information"></div>\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_shortcut_impl_shortcut.general.form",n),n}),csui.define("css!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.view",["csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.view","csui/utils/contexts/factories/node","hbs!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form","css!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form"],function(e,t,i,n){"use strict";return t.extend({"constructor":function(e){t.prototype.constructor.call(this,e),e.context&&e.node&&e.node.original&&e.node.original.get("id")>0&&e.context.getModel(i,{"attributes":{"id":e.node.original.get("id")},"node":e.node.original,"temporary":!0})},"formTemplate":n,"_getBindings":function(){var i=t.prototype._getBindings.apply(this,arguments);return e.extend(i,{"original_id":".shortcut_section"})}})}),csui.define("csui/widgets/metadata/general.panels/url/url.general.form.model",["csui/lib/jquery","csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/models/specificnodemodel","csui/models/mixins/syncable.from.multiple.sources/syncable.from.multiple.sources.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,a){"use strict";var s=i.extend({"constructor":function(e,t){i.prototype.constructor.apply(this,arguments),this.makeSyncableFromMultipleSources(t)},"_mergeSources":function(e,i){var n=e[0].forms[0],o=i[0].forms[0];t.extend(o.data,n.data),t.extend(o.options.fields,n.options.fields),t.extend(o.schema.properties,n.schema.properties),o.options=t.omit(o.options,"form"),this.set(o)},"sync":function(){var e=new n(this.node.attributes,{"connector":this.connector,"node":this.node,"context":this.options.context}),t=new i(this.node.attributes,{"connector":this.connector,"node":this.options.node,"context":this.options.context}),o=e.fetch(),a=t.fetch(),s={"parse":!1};return this.syncFromMultipleSources([o,a],this._mergeSources,s)}});return o.mixin(s.prototype),s}),csui.define("hbs!csui/widgets/metadata/general.panels/url/impl/url.general.form",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn\r\n    cs-form-leftcolumn">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="typename_section general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.title}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        <div class="url_section general-information"></div>\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_url_impl_url.general.form",n),n}),csui.define("css!csui/widgets/metadata/general.panels/url/impl/url.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/url/url.general.form.view",["csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.view","hbs!csui/widgets/metadata/general.panels/url/impl/url.general.form","css!csui/widgets/metadata/general.panels/url/impl/url.general.form"],function(e,t,i){"use strict";return t.extend({"constructor":function(e){t.prototype.constructor.call(this,e)},"formTemplate":i,"_getBindings":function(){var i=t.prototype._getBindings.apply(this,arguments);return e.extend(i,{"url":".url_section"})}})}),csui.define("csui/widgets/metadata/metadata.general.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/general.panels/document/document.general.form.model","csui/widgets/metadata/general.panels/document/document.general.form.view","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/widgets/metadata/general.panels/node/node.general.form.view","csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.model","csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.view","csui/widgets/metadata/general.panels/url/url.general.form.model","csui/widgets/metadata/general.panels/url/url.general.form.view","csui/models/mixins/rules.matching/rules.matching.mixin","csui-ext!csui/widgets/metadata/metadata.general.panels"],function(e,t,i,n,o,a,s,r,l,d,c,u){"use strict";var h=t.Model.extend({"defaults":{"sequence":100,"contentModel":null,"contentView":null,"contentViewOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments),this.makeRulesMatching(i)}});c.mixin(h.prototype);var m=t.Collection.extend({"model":h,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)},"findByNode":function(e){return this.find(function(t){return t.matchRules(e,t.attributes)})}}),p=new m([{"equals":{"type":[144,749]},"contentModel":i,"contentView":n,"sequence":100},{"equals":{"type":[1,2]},"contentModel":s,"contentView":r,"sequence":100},{"equals":{"type":140},"contentModel":l,"contentView":d,"sequence":100},{"contentModel":o,"contentView":a,"sequence":1e4}]);return u&&p.add(e.flatten(u,!0)),p}),csui.define("csui/widgets/metadata/property.panels/general/metadata.general.property.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/models/form","csui/controls/form/form.view","csui/widgets/metadata/metadata.general.panels"],function(e,t,i,n,o,a){"use strict";return i.Controller.extend({"constructor":function(e){i.Controller.prototype.constructor.apply(this,arguments)},"getPropertyPanels":function(e){var t=this._getGeneralPanel(),i=new t.model(void 0,{"connector":this.connector,"node":this.options.model,"context":this.options.context});return i.fetch().then(function(){return[{"model":i,"contentView":t.contentView,"contentViewOptions":t.contentViewOptions}]})},"getPropertyPanelsForCreate":function(e){var i=this._getGeneralPanel(),n=t.Deferred(),o=e.forms.findWhere({"id":"general"});if(!o)throw new Error("General form missing.");return o=new i.model(o.attributes,{"connector":this.connector,"node":this.options.model,"parse":!0}),n.resolve([{"model":o,"contentView":i.contentView,"contentViewOptions":i.contentViewOptions}]).promise()},"getPropertyPanelsForMove":function(e){return this._getPropertyPanelsForMoveAndCopy(e)},"getPropertyPanelsForCopy":function(e){return this._getPropertyPanelsForMoveAndCopy(e)},"_getPropertyPanelsForMoveAndCopy":function(e){var t=this._getGeneralPanel(),i=new t.model(void 0,{"connector":this.connector,"node":this.options.model});return i.fetch().then(function(){return i.get("schema").readonly=!0,[{"model":i,"contentView":t.contentView,"contentViewOptions":t.contentViewOptions}]})},"_getGeneralPanel":function(){var e=a.findByNode(this.options.model);return{"model":e.get("contentModel")||n,"contentView":e.get("contentView")||o,"contentViewOptions":e.get("contentViewOptions")}}})}),csui.define("csui/widgets/metadata/metadata.property.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/property.panels/general/metadata.general.property.controller","csui-ext!csui/widgets/metadata/metadata.property.panels"],function(e,t,i,n){var o=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),a=t.Collection.extend({"model":o,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),s=new a([{"sequence":10,"controller":i}]);return n&&(n=e.flatten(n,!0),e.each(n,function(){var e=n.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),s.add(n)),s}),csui.define("hbs!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return'<div class="binf-dropdown">\r\n  <button id="'+this.escapeExpression((o=null!=(o=t.btnId||(null!=e?e.btnId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"btnId","hash":{}}):o))+'" type="button" class="binf-btn binf-dropdown-toggle"\r\n          data-binf-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\r\n          aria-label="'+this.escapeExpression((o=null!=(o=t.addTitleTooltip||(null!=e?e.addTitleTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"addTitleTooltip","hash":{}}):o))+'" title="'+this.escapeExpression((o=null!=(o=t.addTitleTooltip||(null!=e?e.addTitleTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"addTitleTooltip","hash":{}}):o))+'">\r\n    <span class="csui-button-icon icon-toolbarAdd" title="'+this.escapeExpression((o=null!=(o=t.addTitleTooltip||(null!=e?e.addTitleTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"addTitleTooltip","hash":{}}):o))+'"></span>\r\n  </button>\r\n  <ul class="binf-dropdown-menu" role="menu"></ul>\r\n</div>\r\n<div class="csui-loading-parent-wrapper binf-disabled binf-hidden">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_add.properties_add.properties.dropdown.menu",n),n}),csui.define("css!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu",[],function(){}),
csui.define("csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/log","csui/controls/toolbar/toolitem.view","csui/controls/progressblocker/blocker","csui/models/nodes","csui/controls/toolbar/toolitems.filtered.model","csui/utils/commands","csui/behaviors/dropdown.menu/dropdown.menu.behavior","hbs!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu","csui/lib/binf/js/binf"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m){"use strict";return a=a(e.id),o.CompositeView.extend({"className":"metadata-add-properties","template":h,"templateHelpers":function(){return{"btnId":i.uniqueId("addPropertiesButton"),"addTitleTooltip":1===this.collection.length?this.collection.at(0).get("name"):m.addNewProperties}},"childView":s,"childViewContainer":"ul.binf-dropdown-menu","childViewOptions":function(e){return{"role":"menuitem"}},"behaviors":{"DropdownMenuBehavior":{"behaviorClass":u}},"constructor":function(e){e||(e={}),this.context=e.context,this.commands=e.commands||c,this.node=e.node,this.container=e.container,this.formCollection=e.collection,this.originalFormCollection=e.formCollection,this.listenTo(this.formCollection,"reset",this._updateMenuItems),this.originatingView=e.originatingView,e.blockingParentView?r.delegate(this,e.blockingParentView):r.imbue(this);var a={"nodes":new l([e.node]),"container":e.container,"formCollection":this.formCollection,"originalFormCollection":this.originalFormCollection,"context":e.context},s=e.toolbarItems.addPropertiesToolbar;e.collection=new d(s,{"status":a,"commands":this.commands,"delayedActions":e.containerCollection&&e.containerCollection.delayedActions,"mask":e.toolbarItemsMask}),o.CompositeView.prototype.constructor.apply(this,arguments),e.el&&t(e.el).addClass(i.result(this,"className")),this.listenTo(this,"childview:toolitem:action",this._triggerMenuItemAction).listenTo(this.node.actions,"sync update",this._reRender).listenTo(n,"closeToggleAction",this._closeToggle),e.containerCollection&&e.containerCollection.delayedActions&&this.listenTo(e.containerCollection.delayedActions,"sync",this._reRender),this.listenTo(this.node,"sync change",function(){this.node.set("csuiAddPropertiesActionsRetrieved",!1,{"silent":!0})})},"_updateMenuItems":function(){this.collection.refilter()},"_reRender":function(){!this._isRendered||this._isRendering||this.isDestroyed||(this._updateMenuItems(),this.render())},"onRender":function(){this._isRendering||(this._isRendering=!0,this._ensureLazyActionsRetrieved().always(i.bind(function(){this._isRendering=!1},this)).done(i.bind(function(){var e=this.$el.find(".binf-dropdown-toggle");if(this.collection.length<1||!0===this.options.suppressAddProperties)this.$el.addClass("binf-hidden"),e.attr("data-cstabindex","-1");else if(this.$el.find(".binf-dropdown").removeClass("binf-hidden"),this.$el.removeClass("binf-hidden"),e.attr("data-cstabindex","0"),1===this.collection.length){var n=this.collection.at(0).get("name");e.attr({"aria-haspopup":!1,"aria-label":n,"title":n}),e.find(".icon-toolbarAdd").attr("title",n)}this.collection.length>1&&e.binf_dropdown(),this.$el.find(".binf-dropdown").off("click."+this.cid).on("click."+this.cid,i.bind(this._onClickAddButton,this)),e.off("click."+this.cid).on("click."+this.cid,i.bind(this._onClickAddButton,this));var o=this;setTimeout(function(){var e=t.Event("tab:content:render");o.$el.trigger(e)},200)},this)).fail(i.bind(function(){this.$el.addClass("binf-hidden"),this.$el.find(".binf-dropdown-toggle").attr("data-cstabindex","-1")},this)))},"_closeToggle":function(){if(!0!==this.options.suppressAddProperties){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&e.binf_dropdown("toggle",!1)}},"_onClickAddButton":function(e){1===this.collection.length&&(n.trigger("closeToggleAction"),e.preventDefault(),e.stopPropagation(),this._executeAction(this.collection.at(0)))},"_triggerMenuItemAction":function(e,t){this.$el.find(".binf-dropdown-toggle").binf_dropdown("toggle"),this._executeAction(t.toolItem)},"_executeAction":function(e){var t=e.get("signature"),n=this.commands.get(t),o={"action":this.options.action,"node":this.options.node,"collection":this.formCollection,"container":this.options.container,"inheritance":this.options.inheritance,"context":this.options.context,"parentView":this.options.parentView,"addPropertiesCallback":this.options.addPropertiesCallback},s={"context":this.options.context,"nodes":new l([this.node]),"container":this.options.container,"formCollection":this.formCollection,"originalFormCollection":this.originalFormCollection,"originatingView":this.originatingView};try{if(!n)throw new Error('Command "'+t+'" not found.');var r=this.$el.find(".binf-dropdown");r.addClass("binf-disabled"),n.execute(s,o).done(i.bind(function(e){r.removeClass("binf-disabled"),r.closest(".tab-links").find(".tab-links-bar ul li.binf-active a").trigger("focus")},this)).fail(function(e){r.removeClass("binf-disabled"),e&&e.cancelled&&r.find(".binf-btn.binf-dropdown-toggle").trigger("focus")})}catch(e){a.warn('Executing the command "{0}" failed.\n{1}',n.get("signature"),e.message)&&console.warn(a.last)}},"_ensureLazyActionsRetrieved":function(){var e,n=t.Deferred(),o=this.options.node,a=!!o.get("csuiLazyActionsRetrieved"),s=!!o.get("csuiAddPropertiesActionsRetrieved"),r=!o.get("id"),l=o.nonPromotedActionCommands,d=a&&s;if(this.options.toolbarItems&&l)if(a)s||(e=c.getSignatures(this.options.toolbarItems));else{var u=c.getSignatures(this.options.toolbarItems);u.length&&(e=l=o.nonPromotedActionCommands=i.union(u,o.nonPromotedActionCommands))}if(o&&!r&&!d&&e&&e.length){var h=this;this.$el.find(".binf-dropdown").addClass("binf-hidden"),this.$el.find(".csui-loading-parent-wrapper").removeClass("binf-hidden"),function(){return a?s?t.Deferred().reject().promise():o.getAdditionalActionCommands(e,"csuiAddPropertiesActionsRetrieved"):o.setEnabledLazyActionCommands(!0)}().done(function(){setTimeout(function(){h.$el.find(".csui-loading-parent-wrapper").addClass("binf-hidden"),h._updateMenuItems(),n.resolve()},300)}).fail(function(){h.$el.find(".binf-dropdown").removeClass("binf-hidden"),n.reject()})}else n.resolve();return n.promise()}})}),csui.define("csui/widgets/metadata/add.properties.menuitems",["csui/lib/underscore","csui/utils/base","i18n!csui/widgets/metadata/impl/nls/lang","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","csui-ext!csui/widgets/metadata/add.properties.menuitems","csui-ext!csui/widgets/metadata/add.properties/toolbaritems"],function(e,t,i,n,o,a,s){"use strict";function r(t){e.each(t,function(t){e.each(t,function(t,i){var n=l[i];if(!n)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new o(e),n.addItem(e)})})})}var l={"addPropertiesToolbar":new n({"add":[{"signature":"AddCategory","name":i.addNewCategory}]},{"maxItemsShown":0})};return s&&r(s),a&&r(a),l}),csui.define("csui/widgets/metadata/add.properties.menuitems.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,n){"use strict";return i.extend({"constructor":function(){var o=e.config(),a=new n;i.prototype.constructor.call(this,a,{"normalize":!1}),t.each(o,function(e,t){this.extendMask(e)},this),this.storeMask()}})}),csui.define("hbs!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return'<div class="csui-tab-contents-header-content">\r\n  <div class="csui-tab-contents-header-right">\r\n    <div class="required-field-switch binf-hidden">\r\n        <span id="'+this.escapeExpression((o=null!=(o=t.requiredFieldsLabelId||(null!=e?e.requiredFieldsLabelId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"requiredFieldsLabelId","hash":{}}):o))+'" class="only-required-fields-label"\r\n              title="'+this.escapeExpression((o=null!=(o=t.onlyRequiredFieldsLabel||(null!=e?e.onlyRequiredFieldsLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"onlyRequiredFieldsLabel","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.onlyRequiredFieldsLabel||(null!=e?e.onlyRequiredFieldsLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"onlyRequiredFieldsLabel","hash":{}}):o))+'</span>\r\n      <div class="required-fields-switch"></div>\r\n    </div>\r\n  </div>\r\n  <h4>General</h4>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_tab.contents.header_tab.contents.header",n),n}),csui.define("css!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header",[],function(){}),csui.define("csui/widgets/metadata/impl/tab.contents.header/tab.contents.header.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/form/pub.sub","csui/models/version","i18n!csui/widgets/metadata/impl/nls/lang","hbs!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header","css!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header","csui/lib/binf/js/binf"],function(e,t,i,n,o,a,s,r,l){"use strict";return o.ItemView.extend({"tagName":"div","className":"csui-tab-contents-header","template":l,"ui":{"leftTabContentsHeader":".csui-tab-contents-header-content","rightTabContentsHeader":".csui-tab-contents-header-right","tabContentsHeaderTitle":".csui-tab-contents-header-content h4","requiredSwitchEle":".required-field-switch","requiredSwitchIcon":".required-field-switch > div.required-fields-switch"},"events":{"click @ui.requiredSwitchIcon":"onClickRequiredIconDiv","keydown":"onKeyInView"},"constructor":function(){o.ItemView.prototype.constructor.apply(this,arguments),this.pubsubPostFix=(this.options.node instanceof s?"v":"p")+this.options.node.get("id"),this.requiredFieldsLabelId=i.uniqueId("requiredFields");var e="pubsub:tab:contents:header:view:change:tab:title:"+this.pubsubPostFix;a.off(e),this.listenTo(a,e,this._changeTabTitle),this.listenTo(this.collection,"add",function(e){!!e.get("required")&&this._showRequiredSwitch()}),this.listenTo(this.collection,"remove",function(e){this.isRequiredCatPresent()||this._hideRequiredSwitch()}),this.listenTo(this,"metadata:schema:updated",function(e){this.isRequiredCatPresent()?this._showRequiredSwitch():this._hideRequiredSwitch()},this)},"templateHelpers":function(){return{"onlyRequiredFieldsLabel":r.onlyRequiredFieldsLabel,"requiredFieldsLabelId":this.requiredFieldsLabelId}},"_changeTabTitle":function(e){this.$(this.ui.tabContentsHeaderTitle).html(e)},"onRender":function(){this.requiredFieldSwitchModel=new n.Model({"data":!!this.options.node.collection.requireSwitched});var e=this;csui.require(["csui/controls/form/fields/booleanfield.view"],function(t){e.requiredFieldSwitchView=new t({"mode":"writeonly","model":e.requiredFieldSwitchModel,"labelId":e.requiredFieldsLabelId}),e.requiredFieldSwitchView.render(),e.listenTo(e.requiredFieldSwitchView,"field:changed",function(t){var i="pubsub:tab:contents:header:view:switch:"+e.pubsubPostFix;a.trigger(i,{"on":t.fieldvalue}),e.options.node.collection&&(e.options.node.collection.requireSwitched=t.fieldvalue)}),e.$(".required-fields-switch").append(e.requiredFieldSwitchView.$el),e.isRequiredCatPresent()&&e._showRequiredSwitch(),a.off("pubsub:header:rightbar:view:change:switch:status"),e.listenTo(a,"pubsub:header:rightbar:view:change:switch:status",function(t){t?e.requiredFieldSwitchView.curVal&&e.requiredFieldSwitchView.$el.trigger("click"):e.requiredFieldSwitchModel&&void 0!==e.requiredFieldSwitchModel.get("data")&&!e.requiredFieldSwitchModel.get("data")&&e.options.node&&e.options.node.collection&&e.options.node.collection.requireSwitched&&e.requiredFieldSwitchView.$el.trigger("click")})})},"currentlyFocusedElement":function(e){return!this.ui.requiredSwitchEle.hasClass("binf-hidden")&&this.requiredFieldSwitchView?t(this.ui.requiredSwitchIcon.find(":input")):void 0},"onKeyInView":function(e){var n=e||window.event,o=n.target||n.srcElement;32!==n.keyCode&&13!==n.keyCode||!this.ui.requiredSwitchEle.hasClass("binf-hidden")&&this.requiredFieldSwitchView&&(n.preventDefault(),n.stopPropagation(),setTimeout(i.bind(function(){t(o).trigger("click")},this),200))},"onClickRequiredIconDiv":function(e){this.requiredFieldSwitchView.onClickWriteField(e)},"_hideRequiredSwitch":function(){this.ui.tabContentsHeaderTitle.addClass("csui-tab-contents-header-title-full-width"),this.ui.requiredSwitchEle.addClass("binf-hidden"),!!this.requiredFieldSwitchView&&!!this.requiredFieldSwitchView.getValue()&&this.requiredFieldSwitchView.ui.flagWriteField.trigger("click")},"_showRequiredSwitch":function(){this.ui.tabContentsHeaderTitle.removeClass("csui-tab-contents-header-title-full-width"),this.ui.requiredSwitchEle.removeClass("binf-hidden")},"isRequiredCatPresent":function(){if(this.options.hideRequiredFieldsSwitch)return!1;for(var e=!1,t=0;!e&&t<this.collection.models.length;t++)e=!0===this.collection.models[t].get("required");return e}})}),csui.define("csui/widgets/metadata/impl/metadata.properties.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/url","csui/utils/base","csui/controls/tab.panel/tab.panel.view","csui/controls/tab.panel/tab.links.ext.view","csui/controls/tab.panel/tab.links.ext.scroll.mixin","csui/models/form","csui/controls/form/form.view","csui/widgets/metadata/property.panels/categories/impl/category.form.view","csui/models/appliedcategories","csui/widgets/metadata/impl/metadata.forms","csui/dialogs/modal.alert/modal.alert","csui/controls/progressblocker/blocker","csui/models/version","csui/widgets/metadata/impl/metadata.utils","i18n","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/widgets/metadata/general.form.fields/general.form.field.behavior","csui/widgets/metadata/general.action.fields/general.action.field.behavior","i18n!csui/widgets/metadata/impl/nls/lang","csui/widgets/metadata/metadata.property.panels","csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu.view","csui/widgets/metadata/add.properties.menuitems","csui/widgets/metadata/add.properties.menuitems.mask","csui/widgets/metadata/impl/tab.contents.header/tab.contents.header.view","csui/controls/form/pub.sub","csui/widgets/metadata/impl/metadata.tabcontentcollection.view","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p,g,f,w,b,v,_,y,V,T,x,C,I,k,M,F){var A=h.extend({"constructor":function(t,i){h.prototype.constructor.apply(this,arguments),this.options=i||{},e.defaults(this.options,{"urlResource":""})},"url":function(){return o.combine(this.node.urlBase(),this.options.urlResource)},"fetch":function(){return this.node instanceof f||void 0===this.node.get("id")||this.options.action?(this.fetching=!1,this.fetched=!0,t.Deferred().resolve()):h.prototype.fetch.apply(this,arguments)},"parse":function(){return this.node instanceof f?{}:void 0===this.node.get("id")||this.options.action?{"categories_add":"dummy value"}:h.prototype.parse.apply(this,arguments)}}),S=s.extend({"className":function(){var e=(a.isTouchBrowser()?"cs-touch-browser ":"")+"cs-metadata-properties binf-panel binf-panel-default";return e+=this.options&&this.options.topAlignLabel?" csui-top-align-label":""},"rtlEnabled":b.settings.rtl,"contentView":function(t){var i=e.findWhere(this._propertyPanels,{"model":t});return i?i.contentView||c:"categories"===t.get("role_name")?u:c},"contentViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.formMode,"fetchedModels":this.allForms,"displayedModels":this.collection,"originatingView":this,"layoutMode":"doubleCol","metadataView":this.options.metadataView,"generalFormFieldDescriptors":this._generalFormFieldDescriptors,"generalActionFieldDescriptors":this._generalActionFieldDescriptors},n=e.findWhere(this._propertyPanels,{"model":t});return n&&e.extend(i,n.contentViewOptions),i},"isTabable":function(){return!0!==this.options.notTabableRegion},"constructor":function(n){n||(n={});var o;if(o=a.isTouchBrowser()?"category_delete-touch-browser":"category_delete",e.defaults(n,{"tabType":"binf-nav-pills","mode":"spy","extraScrollTopOffset":3,"formMode":"update","toolbar":!0,"toolbarItems":C,"delete_icon":o,"delete_tooltip":V.removeCategoryTooltip,"contentView":this.getContentView,"TabLinkCollectionViewClass":r,"TabContentCollectionViewClass":F,"searchTabContentForTabableElements":!0,"tabContentAccSelectors":"a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[data-cstabindex], *[contenteditable]"}),this.context=n.context,n.toolbarItemsMask||(n.toolbarItemsMask=new I),this.behaviors=e.extend({"PerfectScrolling":{"behaviorClass":v,"contentParent":"> .binf-tab-content","scrollXMarginOffset":30,"scrollYMarginOffset":15}},this.behaviors),n.collection)this.allForms=n.collection;else{var l=n.node,d=l.get("enforcedRequiredAttrsForFolders"),c=l;d&&(c=l.clone(),c.set("type",144)),this.allForms=new m(void 0,{"node":c,"connector":n.node.connector,"container":n.container,"action":n.action,"inheritance":n.inheritance,"autoreset":!0,"formCollection":n.formCollection}),n.collection=new i.Collection}void 0===n.node.newCategories&&(n.node.newCategories=new i.Collection),void 0===n.node.removedCategories&&(n.node.removedCategories=[]),s.prototype.constructor.apply(this,arguments),this.widths=[],this.options.blockingParentView?g.delegate(this,this.options.blockingParentView):g.imbue(this),M.off("pubsub:tab:contents:panel:textarea:scrollupdate"),this.listenTo(M,"pubsub:tab:contents:panel:textarea:scrollupdate",this._updateToTextAreaScrollbar),this.listenTo(this.allForms,"request",this.blockActions).listenTo(this.allForms,"request",this._checkFormFetching).listenTo(this.allForms,"sync",this._syncForms).listenTo(this.allForms,"sync",this.unblockActions).listenTo(this.allForms,"destroy",this.unblockActions).listenTo(this.allForms,"error",this.unblockActions).listenTo(this.collection,"reset",this.render).listenTo(n.node,"change:id",function(){"create"===this.options.formMode||this._fetchingForms||this.isDestroyed||this._fetchForms()}).listenTo(this,"reset:switch",this._resetRequiredSwitchView).listenTo(this,"update:button",e.bind(function(e){this.options.metadataView&&this.options.metadataView.trigger("update:button",{"overlay":e})},this)),this.allForms.fetching&&this.blockActions(),t(window).on("resize",{"view":this},this._onWindowResize),t(window).on("resize.tableview",{"view":this},this._onWindowResize),this.listenTo(this,"render",this.onRendered),this.listenTo(i,"metadata:schema:updated",function(e){this.resolveHasRequiredFields(e),this.has_required_fields=this.collection.filter(function(e){return!0===e.get("required")}),this.tabLinks.trigger("metadata:schema:updated",e),this.tabContentHeader.trigger("metadata:schema:updated",e)},this)},"onBeforeDestroy":function(){t(window).off("resize",this._onWindowResize),t(window).off("resize.tableview",this._onWindowResize),this.addPropertiesView&&(this.cancelEventsToViewsPropagation(this.addPropertiesView),this.addPropertiesView.destroy()),this.contentHeaderRegion&&this.contentHeaderRegion.empty()},"_updateScrollbar":function(){this.trigger("update:scrollbar"),this.$(this.behaviors.PerfectScrolling.contentParent).animate({"scrollTop":0},"fast")},"_updateToTextAreaScrollbar":function(e){this.trigger("update:scrollbar");var t=e.$el.offset().top-this.$(this.behaviors.PerfectScrolling.contentParent).offset().top;this.$(this.behaviors.PerfectScrolling.contentParent).scrollTop()>0&&this.$(this.behaviors.PerfectScrolling.contentParent).animate({"scrollTop":t},"fast")},"_getModelFromCollectionByTitle":function(t){if(t&&e.isString(t)&&this.collection)return this.collection.find({"title":t})},"_getModelIndex":function(e,t){var i=-1;if(this.collection&&this.collection.length>0){var n,o;for(n=0;n<this.collection.length;n++)if(o=this.collection.at(n),e===o.get("id")||t===o.get("title")){i=n;break}}return i},"_activateTab":function(e){var t=this._getModelFromCollectionByTitle(e)||e;if(t&&t instanceof i.Model){var n=this._getModelIndex(t.get("id"),t.get("title"));-1!==n&&this._activateTabByIndex(n)}},"_activateTabByIndex":function(e){this.options.activeTab.set("tabIndex",e),this.tabLinks.children.findByIndex(e).activate(!0)},"_activateSelectedPropertyTab":function(){var e=this._getModelFromCollectionByTitle(this.options.selectedProperty)||this.options.selectedProperty;if(e&&e instanceof i.Model){var t=this._getModelIndex(e.get("id"),e.get("title"));-1!==t&&(this.options.activeTab.set("tabIndex",t),this.tabLinks.children.findByIndex(t).activate())}},"render":function(){var t=!0;if(this.allForms.fetched||this.allForms.error||(t=!1,this._fetchingForms||this._fetchForms()),!1===t||this._fetchingForms)return this;if(1===this.collection.length){var i=this.collection.first(),n=e.clone(i.get("schema"));n.title="",i.set("schema",n)}var o=this;return this.collection.each(function(e,t){o.resolveHasRequiredFields.call(o,e)&&(o.hasRequiredField=!0)}),e.extend(this,{"_":e}),s.prototype.render.apply(this),this._createAddPropertiesView(),this._initializeOthers(),this},"resolveHasRequiredFields":function(e){var t=new w,i=t.AlpacaFormOptionsSchemaHaveRequiredFields(e.get("options"),e.get("schema"),e.get("id"));return e.set("required",i),i},"onDestroy":function(){this._fetchingForms&&this.unblockActions()},"onRendered":function(){this._setTablinksAttributes(),setTimeout(e.bind(this._setTablinksAttributes,this),300),this.tabLinks.stopListening(this.collection,"reset"),this.tabContent.stopListening(this.collection,"reset"),this.tabContentHeader&&(this.tabContentHeader.destroy(),this.$el.find(".csui-tab-contents-header-wrapper").remove()),this.listenTo(this.tabLinks,"childview:delete:tab",e.bind(this._onDeleteCategory,this)),this.tabLinks.$el.addClass("binf-hidden"),this.tabContent.$el.addClass("binf-hidden"),this.blockActions(),this.updateTitle=!0;var i=[],o=this;this.tabContent.children.each(e.bind(function(e){var n=t.Deferred();i.push(n.promise());var o=e.content;o instanceof c&&!o.isRenderFinished()?this.listenTo(o,"render:form",function(e){var t=e.$el.find(".cs-form-singlecolumn")?e.$el.find(".cs-form-singlecolumn"):e.$el.find(".cs-form-doublecolumn");t&&t.length>0?t.html()&&n.resolve():n.resolve()}):n.resolve()},this)),t.when.apply(t,i).done(function(){if(o.unblockActions(),o.tabLinks.$el.removeClass("binf-hidden"),!o.options.hideStickyHeader){var e=o.options.node instanceof f?"v":"p";e="pubsub:tab:contents:header:view:switch:"+e+o.options.node.get("id"),M.off(e),o.listenTo(M,e,o._onRequiredSwitch),o.tabContent.$el.before("<div class='csui-tab-contents-header-wrapper'></div>"),o.contentHeaderRegion=new n.Region({"el":o.$el.find(".csui-tab-contents-header-wrapper")}),o.tabContentHeader=new k(o.options),o.contentHeaderRegion.show(o.tabContentHeader)}if(o.tabContentHeader&&o.options.node.collection.requireSwitched&&o.hasRequiredField&&o._hideNotRequiredFormFields(!0),o.tabContent.$el.removeClass("binf-hidden"),o.addPropertiesView&&o.rightToolbar){var i=o.addPropertiesView.render();n.triggerMethodOn(i,"before:show",i,o),o.rightToolbar.append(i.el),n.triggerMethodOn(i,"show",i,o),o.allFormsRendered=!0}var a,s=o.tabLinks.collection.find(function(e){return!o.tabLinks.children.findByModel(e).$el.hasClass("binf-hidden")});s&&!(a=o.tabLinks.children.findByModel(s)).isActive()&&a.activate(),o._initializeOthers(),o.triggerMethod("render:forms",this),setTimeout(function(){o._computeTablinkWidth(),o._enableToolbarState()},300);var r=t.Event("tab:content:render");if(o.$el.trigger(r),"create"!==o.options.formMode&&o.setFocus(),o.trigger("update:scrollbar"),o.updateTitle){var l=(o.options.node instanceof f?"v":"p")+o.options.node.get("id");l="pubsub:tab:contents:header:view:change:tab:title:"+l,M.trigger(l,a.el.innerText)}}).then(function(){o._activateSelectedPropertyTab()}),this.$el&&!this.$el.is(":visible")&&(this.updateTitle=!1),this.options.metadataView&&this.options.metadataView.metadataHeaderView&&this.options.metadataView.metadataHeaderView.metadataItemNameView.setToggleIconTabIndex()},"onShow":function(){},"setFocus":function(){},"_computeTablinkWidth":function(){var e=this.$el.find(".tab-links-bar"),i=e&&e.find("ul > li");if(e&&e.removeClass("wide-tablink very-wide-tablink"),e&&e.length>0&&i&&i.length>1){var n,o=t(e[0]).width(),a=0,s=0;for(n=0;n<i.length;n++){var r=t(i[n]);r.hasClass("hidden-by-switch")||(a+=r.width(),s++)}var l=s>0?a/s:t(i[0]).width(),d=2*a,c=a+1.3*l;o>d?e.addClass("very-wide-tablink"):o>c?e.addClass("wide-tablink"):e.removeClass("wide-tablink very-wide-tablink")}},"onPanelActivated":function(){setTimeout(e.bind(function(){this._setTablinksAttributes(),this._enableToolbarState()},this),300)},"validateForms":function(){var e=!0;return!!this.allFormsRendered&&(this.tabContent.children.each(function(t){var i=t.content.validate();e=e&&i}),e?this._hideValidationError():this._showValidationError(),e)},"getFormsValues":function(){var t,i,n,o,a={};this.tabContent.children.each(function(t){var i,s,r=t.content.getValues(),l=t.content.model.get("role_name");r&&(l?(n=a.roles||(a.roles={}),o=n[l]||(n[l]={}),"categories"===l?(s=t.model.get("id").toString(),i=o[s]||(o[s]={}),e.isEmpty(r)?i=null:e.extend(i,r)):e.extend(o,r)):e.extend(a,r))}),this.options.node.removedCategories.length>0&&(n=a.roles||(a.roles={}),o=n.categories||(n.categories={}),e.each(this.options.node.removedCategories,function(e){o[e]||(o[e]={})}));var s=this.tabContent.children.find(function(e){return!!e.content.getGeneralFormFieldValues});return s&&(t=s.content.getGeneralFormFieldValues(),i=t.roles||{},delete t.roles,e.extend(a,t),e.each(e.keys(i),function(t){n=a.roles||(a.roles={}),o=n[t]||(n[t]={}),e.extend(o,i[t])})),a},"_addValidationErrorElement":function(){if(0===this.$el.find(".metadata-validation-error").length){this.tabLinks.$el.after('<div class="metadata-validation-error"></div>'),this.validationErrorElem=t(this.$el.find(".metadata-validation-error")[0]),this.validationErrorElem.append('<span class="icon notification_error cs-close-error-icon" alt="'+V.hideValidationErrorMessageIconTooltip+'" title="'+V.hideValidationErrorMessageIconTooltip+'"></span>'),this.validationErrorElem.append('<span class="validation-error-message">'+V.formValidationErrorMessage+"</span>"),this.validationErrorElem.hide();var i=t(this.$el.find(".metadata-validation-error .cs-close-error-icon")[0]);i&&i.on("click",e.bind(function(e){e.preventDefault(),e.stopPropagation(),this._hideValidationError()},this))}},"_showValidationError":function(){void 0===this.validationErrorElem&&this._addValidationErrorElement(),this.tabContent.$el.find(".alpaca-message-notOptional").length>0?(this.tabContent&&this.tabContent.$el.addClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.addClass("show-validation-error"),this.validationErrorElem&&this.validationErrorElem.show()):this._hideValidationError()},"_hideValidationError":function(){this.tabContent&&this.tabContent.$el.removeClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.removeClass("show-validation-error"),this.validationErrorElem&&this.validationErrorElem.hide()},"_clearValidationError":function(){this.tabContent&&this.tabContent.$el.removeClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.removeClass("show-validation-error"),this.validationErrorElem&&(this.validationErrorElem.remove(),delete this.validationErrorElem)},"_checkFormFetching":function(){this._fetchingForms=!0},"_fetchForms":function(){return this.allForms.fetch()},"_syncForms":function(){var t=this;return this.blockActions(),this._clearValidationError(),this._loadPanels().then(e.bind(this._loadGeneralFormFields,this)).then(e.bind(this._loadGeneralActionFields,this)).always(function(){t.unblockActions(),t._fetchingForms=!1}).then(function(){var i=e.pluck(t._propertyPanels,"model"),n=t.allForms.where({"role_name":"categories"});t.panelModelsLength=i.length,t.options.node.newCategories.models.length>0&&(n=e.union(n,t.options.node.newCategories.models));var o=e.sortBy(n,function(e){return e.attributes.title.toLowerCase()});n=i.concat(o),t._normalizeModels(n),t.collection.reset(n),t._checkCategoriesActions()}).fail(function(e){var t=new a.Error(e);p.showError(t.message,V.getPropertyPanelsFailTitle)})},"_loadPanels":function(){var i,n,o=this;"create"===this.options.action?(i="getPropertyPanelsForCreate",n=[{"forms":this.allForms}]):"copy"===this.options.action?(i="getPropertyPanelsForCopy",n=[{"forms":this.allForms}]):"move"===this.options.action?(i="getPropertyPanelsForMove",n=[{"forms":this.allForms}]):(i="getPropertyPanels",n=[{"forms":this.allForms}]);var a=T.chain().map(function(t){var a=t.get("controller"),s=t.get("controllerOptions"),r=new a(e.extend({"context":o.options.context,"model":o.options.node},s)),l=r[i];return l&&l.apply(r,n)}).compact().value();return t.when.apply(t,a).then(function(){o._propertyPanels=e.flatten(arguments)})},"_loadGeneralFormFields":function(){var e=this;return _.getFieldDescriptors({"context":this.options.context,"action":this.options.action,"node":this.options.node,"forms":this.allForms}).then(function(t){e._generalFormFieldDescriptors=t})},"_loadGeneralActionFields":function(){var e=this;return y.getFieldDescriptors({"context":this.options.context,"action":this.options.action,"node":this.options.node,"forms":this.allForms}).then(function(t){e._generalActionFieldDescriptors=t})},"_normalizeModels":function(t){e.each(t,function(e){if(e instanceof d){var t=e.get("schema");t&&t.title&&e.set("title",t.title)}null==e.get("id")&&e.set("id",e.cid),e.collection&&e.collection.remove(e)})},"_checkCategoriesActions":function(){var i=this.options.collection.where({"role_name":"categories"});if(i.length>0){var n=i[0].get("categoryId"),o=new A(void 0,{"node":this.options.node,"action":this.options.action,"urlResource":"categories/"+n+"/actions","autofetch":!0,"autoreset":!0});this.blockActions(),o.fetch().done(e.bind(function(){o.length>0&&o.at(0).get("categories_remove")&&o.at(0).get("categories_remove").length>0&&e.each(i,function(e){e.attributes.removeable=!0,e.trigger("action:updated")}),this.unblockActions(),setTimeout(e.bind(function(){var e=t.Event("tab:content:render");this.$el.trigger(e)},this),300)},this)).fail(e.bind(function(t){var i=this._getRespError(t),o=V.getCategoryActionsFailTitle,a=e.str.sformat(V.getActionsForACategoryFailMessage,n,this.options.node.get("id"),i);p.showError(a,o),this.unblockActions()},this))}},"_initializeOthers":function(){var t={"gotoPreviousTooltip":V.gotoPreviousCategoryTooltip,"gotoNextTooltip":V.gotoNextCategoryTooltip};this._initializeToolbars(t),this._listenToTabEvent(),setTimeout(e.bind(this._enableToolbarState,this),300)},"_onWindowResize":function(e){if(e&&e.data&&e.data.view){var t=e.data.view;t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){t._setTablinksAttributes(),t._computeTablinkWidth(),t._enableToolbarState(),t._updateScrollbar()},200)}},"_setTablinksAttributes":function(){var e,i,n=this.$el.parent();for(e=0;e<5;e++){if(i=n.siblings(".cs-tab-links.binf-dropdown"),i.length>0){var o=t(i[0]).width();if(o>15){var a=o-12,s=a+"px",r=this.rtlEnabled?"margin-right":"margin-left",l=this.$el.find(".tab-links");if(l.css({"width":function(){return"calc(100% - "+s+")"}}),l.length){l.css(r,s);var d=parseInt(l.css("width").replace("px",""),10);d>20&&d<250?l.addClass("csui-mini-tablinks"):l.removeClass("csui-mini-tablinks")}}break}n=n.parent()}},"_createAddPropertiesView":function(){
this.addPropertiesView&&(this.cancelEventsToViewsPropagation(this.addPropertiesView),this.addPropertiesView.destroy());var t=e.extend({"toolbarItems":this.options.toolbarItems,"toolbarItemsMask":this.options.toolbarItemsMask,"parentView":this,"blockingParentView":this.options.blockingParentView,"addPropertiesCallback":this.addPropertiesCallback,"suppressAddProperties":this.options.suppressAddProperties},this.options);this.addPropertiesView=new x(t),this.propagateEventsToViews(this.addPropertiesView)},"addCatAt":function(e,t){for(var i=this.panelModelsLength,n=i;n<e.length;n++){if(e[n].get("title").toLowerCase()>t.get("title").toLowerCase()){i=n;break}i+=1}return i},"addPropertiesCallback":function(e){this.options.action&&this.options.node.newCategories.add(e);var t=1===this.options.collection.models.length?1:this.addCatAt(this.options.collection.models,e);return this.doAddModelProperties(e,t),!1},"doAddModelProperties":function(i,n,o){function a(){var e=t.Event("tab:content:render");s.$el.trigger(e),s._autoScrollTabTo(n,{"animationOff":!0}).done(function(){var e=s.tabLinks.children.findByModel(s.options.collection.findWhere({"id":i.get("id")}));e.activate(),e.$el.find("a.cs-tablink").trigger("focus")})}var s=this;this.tabLinks.$el.find(".binf-active").removeClass("binf-active").removeAttr("aria-selected"),this.options.collection.add(i,e.extend(o||{},{"at":n})),i.collection=this.options.collection,this._listenToTabIdEvent(n);var r=this.tabContent.children.findByModel(this.options.collection.findWhere({"id":i.get("id")})),l=r&&r.content;if(void 0!==l){if(l instanceof c?l.isRenderFinished():l._isRendered)a();else{var d=l instanceof c?"render:form":"dom:refresh";this.listenToOnce(l,d,e.bind(function(){this.trigger("update:button",!1),a()},this))}this._autoScrollTabTo(n,{"animationOff":!0})}else a();this._computeTablinkWidth(),this._enableToolbarState(),this.trigger("reset:switch")},"_resetRequiredSwitchView":function(){M.trigger("pubsub:header:rightbar:view:change:switch:status","reset")},"_onDeleteCategory":function(t){this.tabToDelete=t;var i=t.model.get("title"),n=V.removeCategoryWarningTitle,o=i?e.str.sformat(V.removeCategoryWarningMessage,i):V.removeCategoryWarningMessage;p.confirmWarning(o,n).done(e.bind(this._removeCategory,this)).fail(e.bind(function(e){e||this.tabToDelete.$el.find("a").trigger("focus")},this))},"_removeCategory":function(){if(this.tabToDelete){var t=this.tabToDelete.model.get("id");if(t=e.isNumber(t)?t.toString():t,void 0===this.options.node.get("id")||this.options.action)return this._removeTab(),void(void 0===this.options.node.newCategories.remove(t)&&this.options.node.removedCategories.push(t));var i=o.combine(this.options.node.urlBase(),"categories/"+t),n={"type":"DELETE","url":i};this.blockActions(),this.options.node.connector.makeAjaxCall(n).done(e.bind(function(){this.unblockActions(),this._removeTab()},this)).fail(e.bind(function(t){this.unblockActions();var i=this._getRespError(t),n=this.tabToDelete.model.get("title"),o=V.removeCategoryFailMessageTitle,a=e.str.sformat(V.removeCategoryFailMessage,n,i);p.showError(a,o)},this))}},"_removeTab":function(){if(this.tabToDelete.$el.hasClass("binf-active")){var i=this.tabToDelete._index-1,n=this.tabLinks.children.findByIndex(i);this._autoScrollTabTo(i,{"animationOff":!0}).done(function(){n&&n.activate()})}this.options.collection.remove(this.tabToDelete.model),this.trigger("reset:switch"),setTimeout(e.bind(function(){this._computeTablinkWidth(),this._enableToolbarState();var e=t.Event("tab:content:render");this.$el.trigger(e)},this),300)},"_onRequiredSwitch":function(e){return i.trigger("closeToggleAction"),this._updateScrollbar(),this._hideNotRequiredFormFields(e.on,e),!1},"_hideNotRequiredFormFields":function(i,n){this.tabContent.children.each(function(e){if(e.content.hideNotRequired){var t=e.content.hideNotRequired(i),n=this.tabLinks.children.findByModel(e.model);if(t){var o=i?"addClass":"removeClass";e.$el[o]("binf-hidden hidden-by-switch"),i?this._hideTabLinkByRequiredSwitch(n.$el):this._showTabLinkByRequiredSwitch(n.$el,e.model.get("removeable"))}else this._showTabLinkByRequiredSwitch(n.$el,e.model.get("removeable"))}},this),this.tabLinks.$el.find(".tab-links-first-visible").removeClass("tab-links-first-visible"),this.tabContent.onReorder();for(var o,a=this.tabLinks.children._views,s=Object.keys(a).sort(function(e,t){return a[e]._index-a[t]._index}),r=0;r<s.length;r++)if(!this.tabLinks.children._views[s[r]].$el.hasClass("binf-hidden")){o=this.tabLinks.children._views[s[r]];break}o&&o.$el.addClass("tab-links-first-visible"),o&&!o.isActive()&&o.activate(),setTimeout(e.bind(function(){this._computeTablinkWidth(),this._enableToolbarState();var e=t.Event("tab:content:render");this.$el.trigger(e),n&&(this.currentTabPosition=1)},this),300)},"_getRespError":function(e){var i="";return e&&e.responseJSON&&e.responseJSON.error?i=e.responseJSON.error:a.MessageHelper.hasMessages()&&(i=t(a.MessageHelper.toHtml()).text(),a.MessageHelper.clear()),i}});return e.extend(S.prototype,l),S}),csui.define("csui/widgets/metadata/metadata.properties.view",["module","csui/lib/underscore","csui/widgets/metadata/impl/metadata.properties.view","css!csui/widgets/metadata/impl/metadata"],function(e,t,i){var n=e.config();return t.defaults(n,{"topAlignLabel":!1}),i.extend({"constructor":function(e){e.topAlignLabel=n.topAlignLabel,i.prototype.constructor.apply(this,arguments)},"validateForms":function(){return i.prototype.validateForms.apply(this,arguments)},"getFormsValues":function(){return i.prototype.getFormsValues.apply(this,arguments)}})}),csui.define("csui/widgets/metadata/impl/metadata.properties.content.view",["csui/lib/underscore","csui/lib/marionette","csui/utils/nodesprites","csui/widgets/metadata/metadata.properties.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin"],function(e,t,i,n,o){var a=t.ItemView.extend({"className":"metadata-inner-wrapper","constructor":function(e){this.options=e,t.ItemView.prototype.constructor.call(this,e);var i={"context":this.options.context,"node":this.options.model,"containerCollection":this.options.containerCollection,"metadataView":this.options.metadataView,"blockingParentView":this.options.blockingParentView,"selectedProperty":this.options.selectedProperty,"notTabableRegion":!0};this.childTabPanelView=new n(i),this.propagateEventsToViews(this.childTabPanelView)},"render":function(){this._ensureViewIsIntact(),this.triggerMethod("before:render",this);var e=this.childTabPanelView.render();return t.triggerMethodOn(e,"before:show",e,this),this.$el.append(e.el),t.triggerMethodOn(e,"show",e,this),this.triggerMethod("render",this),this},"onBeforeDestroy":function(){this.childTabPanelView.destroy()},"onPanelActivated":function(){this.childTabPanelView&&this.childTabPanelView.triggerMethod("panel:activated")}});return e.extend(a.prototype,o),a}),csui.define("csui/utils/versions.default.action.items",["csui/lib/underscore","csui/models/actionitems","csui-ext!csui/utils/versions.default.action.items"],function(e,t,i){"use strict";var n=new t([{"type":144,"signature":"VersionOpen","sequence":10}]);return i&&n.add(e.flatten(i,!0)),n}),csui.define("csui/widgets/metadata/impl/versions/metadata.versions.columns",["csui/lib/backbone","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t){var i=e.Model.extend({"idAttribute":"key","defaults":{"key":null,"sequence":0}}),n=e.Collection.extend({"model":i,"comparator":"sequence","getColumnKeys":function(){return this.pluck("key")},"deepClone":function(){return new n(this.map(function(e){return e.attributes}))}});return new n([{"key":"version_number_name","align":"center","title":t.versionColumnVersionNumberTitle,"sequence":10},{"key":"name","sequence":20},{"key":"create_date","sequence":30},{"key":"owner_id","sequence":40},{"key":"file_size","align":"right","title":t.versionColumnSizeTitle,"sequence":50}])}),csui.define("hbs!csui/widgets/metadata/impl/versions/metadata.versions",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="csui-metadata-versions">\r\n  <div class="csui-metadata-versions-rowselection-toolbar-view"></div>\r\n  <div class="csui-table-view"></div>\r\n  <div class="csui-pagination-view"></div>\r\n</div>'}});return i.registerPartial("csui_widgets_metadata_impl_versions_metadata.versions",n),n}),csui.define("css!csui/widgets/metadata/impl/versions/metadata.versions",[],function(){}),csui.define("csui/widgets/metadata/impl/versions/metadata.versions.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/globalmessage/globalmessage","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/toolbar/toolitems.filtered.model","csui/controls/toolbar/toolbar.view","csui/controls/toolbar/delayed.toolbar.view","csui/controls/table/table.view","csui/controls/pagination/nodespagination.view","csui/utils/versions.default.action.items","csui/utils/commands/versions","csui/utils/accessibility","csui/controls/table.rowselection.toolbar/table.rowselection.toolbar.view","csui/controls/toolbar/toolbar.command.controller","csui/models/nodes","csui/models/columns","csui/models/nodeversions","csui/models/version","csui/widgets/metadata/impl/versions/metadata.versions.columns","csui/widgets/metadata/versions.toolbaritems","csui/widgets/metadata/versions.toolbaritems.mask","hbs!csui/widgets/metadata/impl/versions/metadata.versions","css!csui/widgets/metadata/impl/versions/metadata.versions"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p,g,f,w,b,v,_,y,V,T,x,C){"use strict";var I=g.isAccessibleTable(),k=e.config();i.defaults(k,{"defaultPageSize":30,"defaultPageSizes":[30,50,100],"enabled":!0});var M=o.LayoutView.extend({"className":function(){var e="metadata-inner-wrapper";return I&&(e+=" csui-no-animation"),e},"template":C,"ui":{"tableRowSelectionToolbarView":".csui-metadata-versions-rowselection-toolbar-view","tableView":".csui-table-view","childContainer":".csui-table-view","paginationView":".csui-pagination-view"},"regions":{"tableRowSelectionToolbarRegion":"@ui.tableRowSelectionToolbarView","tableRegion":"@ui.tableView","paginationRegion":"@ui.paginationView"},"constructor":function e(t){this.commands=t.commands||p,i.defaults(t,{"pageSize":k.defaultPageSize,"ddItemsList":k.defaultPageSizes,"toolbarItems":T,"originatingView":t.originatingView||t.metadataView}),e.__super__.constructor.call(this,t),this.selectedNodes=new b,this.collection=new _(void 0,{"node":this.options.model,"autoreset":!0,"expand":"user","commands":p.getAllSignatures(),"onlyClientSideDefinedColumns":!0}),this.options.model.fetch({"silent":!0}),this.options.model.versions=this.collection,this.commandController=new w({"commands":this.commands}),this.collection.delayedActions&&this.listenTo(this.collection.delayedActions,"error",function(e,t,i){var n=new a.Error(t);s.showMessage("error",n.message)}),this.defaultActionItems=m,this.options.toolbarItemsMasks||(this.options.toolbarItemsMasks=new x(this.options)),this._setTableView(),this._setTableRowSelectionToolbar({"toolItemFactory":this.options.toolbarItems.tableHeaderToolbar,"toolbarItemsMask":this.options.toolbarItemsMasks,"commands":this.options.commands||p}),this._setTableRowSelectionToolbarEventListeners(),this._setPagination(),this.collection.fetch(),this.propagateEventsToRegions(),this.listenTo(this.collection,"add",this._updateCollection).listenTo(this.collection,"remove",this._updateCollection)},"onRender":function(){this.tableRowSelectionToolbarRegion.show(this._tableRowSelectionToolbarView),this.tableRegion.show(this.tableView),this.paginationRegion.show(this.paginationView)},"_updateCollection":function(){this.collection.fetch()},"_setTableView":function(){this.options||(this.options={});var e=i.extend({"tableColumns":V,"connector":this.model.connector,"collection":this.collection,"columns":this.collection.columns,"columnsWithSearch":[],"orderBy":"version_number_name desc","actionItems":m,"commands":p,"originatingView":this.options.originatingView},this.options);delete e.blockingParentView,i.contains(this.options.ddItemsList,this.options.pageSize)||(this.options.ddItemsList.push(this.options.pageSize),this.options.ddItemsList.sort()),this.tableView=new u(e);var t={"context":this.options.context,"originatingView":this};this.listenTo(this.tableView,"execute:defaultAction",function(e){var i=this.defaultActionItems.find(function(t){if(t.get("type")===e.get("type"))return!0},this),n=p.get(i.get("signature")),o={"nodes":new _([e])};n.execute(o,t)})},"_setTableRowSelectionToolbar":function(e){this._tableRowSelectionToolbarView=new f({"toolItemFactory":e.toolItemFactory,"toolbarItemsMask":e.toolbarItemsMask,"toolbarCommandController":this.commandController,"commands":p,"selectedChildren":this.tableView.selectedChildren,"container":this.collection.node,"context":this.options.context,"originatingView":this.options.originatingView,"collection":this.collection})},"_setTableRowSelectionToolbarEventListeners":function(){this.listenTo(this.tableView.selectedChildren,"reset",function(){this.tableView.selectedChildren.length>0?this.tableRowSelectionToolbarRegion.$el.addClass("csui-metadata-versions-rowselection-toolbar-visible"):this.tableRowSelectionToolbarRegion.$el.removeClass("csui-metadata-versions-rowselection-toolbar-visible")})},"_setPagination":function(){this.paginationView=new h({"collection":this.collection,"pageSize":this.options.pageSize,"defaultDDList":this.options.ddItemsList,"skipPaginationUpdateRequest":!0})}},{"enabled":function(e){return!1!==k.enabled&&(!(e.node instanceof y)&&i.contains([144,736,5574],e.node.get("type")))}});return i.extend(M.prototype,r),M}),csui.define("csui/models/audit/server.adaptor.mixin",["csui/lib/underscore","csui/utils/url"],function(e,t){"use strict";return{"mixin":function(i){return e.extend(i,{"makeServerAdaptor":function(e){return this},"url":function(){var e=new t(this.connector.connection.url).getApiBase(2),i=t.combineQueryString(this.getBrowsableUrlQuery(),{"expand":"audit{id, user_id, agent_id}"});return t.combine(e,"nodes",this.options.node.get("id"),"audit?"+i)},"parse":function(e,t){return this.parseBrowsedState(e,t),this.columns&&this.columns.resetColumnsV2(e,this.options),this.auditEvents.add(e.results.data.audit_event_types),e.results.data.audit},"isFetchable":function(){return!!this.options}})}}}),csui.define("csui/models/audit/audit.collection",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/mixins/connectable/connectable.mixin","csui/models/mixins/fetchable/fetchable.mixin","csui/models/browsable/browsable.mixin","csui/models/browsable/v2.response.mixin","csui/models/browsable/v1.request.mixin","csui/models/audit/server.adaptor.mixin","csui/models/nodechildrencolumn","csui/models/nodechildrencolumns","csui/models/node/node.model"],function(e,t,i,n,o,a,s,r,l,d,c,u){var h={"auditName":"audit_name","auditDate":"audit_date","userIdKey":"user_id","dateType":"-7"},m=d.extend({"constructor":function(e,t){d.prototype.constructor.call(this,e,t)}}),p=c.extend({"model":m,"resetColumnsV2":function(e,t){this.models.length||this.resetCollection(this.getV2Columns(e),t)},"getColumnModels":function(t,i){var n=c.prototype.getColumnModels.call(this,t,i);return e.each(n,function(e){e.column_key===h.auditDate&&(e.sort=!0)}),n},"getV2Columns":function(t){var i=t.results&&t.results[0]&&t.results[0].metadata&&t.results[0].metadata.properties||{};i.audit_name={"filter":!0},i.audit_date={},i.user_id={"filter":!0},i.audit_name.key=h.auditName,i.audit_date.key=h.auditDate,i.user_id.key=h.userIdKey,i.audit_date.type=h.dateType;var n=e.keys(i);return this.getColumnModels(n,i)}}),g=i.Model.extend({}),f=i.Collection.extend({"model":g,"constructor":function(e,t){this.options=t||{},i.Collection.prototype.constructor.call(this,e,t)}}),w=u.extend({}),b=i.Collection.extend({"model":w,"constructor":function(e,t){this.options=t||{},i.Collection.prototype.constructor.call(this,e,t),this.makeConnectable(t).makeFetchable(t).makeBrowsable(t).makeBrowsableV2Response(t).makeBrowsableV1Request(t).makeServerAdaptor(t),this.columns=new p,this.auditEvents=new f}});return n.mixin(b.prototype),o.mixin(b.prototype),a.mixin(b.prototype),s.mixin(b.prototype),r.mixin(b.prototype),l.mixin(b.prototype),b}),csui.define("csui/widgets/metadata/impl/audit/metadata.audit.columns",["csui/lib/backbone","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t){var i=e.Model.extend({"idAttribute":"key","defaults":{"key":null,"sequence":0}}),n=e.Collection.extend({"model":i,"comparator":"sequence","getColumnKeys":function(){return this.pluck("key")},"deepClone":function(){return new n(this.map(function(e){return e.attributes}))}});return new n([{"key":"audit_name","align":"left","title":t.action,"sequence":10},{"key":"audit_date","align":"left","title":t.date,"sequence":20},{"key":"user_id","align":"left","title":t.user,"sequence":30}])}),csui.define("hbs!csui/widgets/metadata/impl/audit/metadata.audit",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="csui-audit-table"></div>\r\n<div class="csui-audit-pagination"></div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_audit_metadata.audit",n),n}),csui.define("css!csui/widgets/metadata/impl/audit/metadata.audit",[],function(){}),csui.define("csui/widgets/metadata/impl/audit/metadata.audit.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/contexts/factories/connector","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/table/table.view","csui/controls/pagination/nodespagination.view","csui/models/audit/audit.collection","csui/widgets/metadata/impl/audit/metadata.audit.columns","csui/models/members","csui/controls/userpicker/impl/user.view","csui/utils/base","hbs!csui/widgets/metadata/impl/audit/metadata.audit","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/audit/metadata.audit"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p){"use strict";var g=e.config();t.defaults(g,{"defaultPageSize":30,"defaultPageSizes":[30,50,100],"enabled":!0});var f=n.LayoutView.extend({"className":"csui-audit","template":m,"ui":{"tableView":".csui-audit-table","paginationView":".csui-audit-pagination"},"regions":{"tableRegion":"@ui.tableView","paginationRegion":"@ui.paginationView"},"constructor":function(e){e||(e={}),n.LayoutView.prototype.constructor.apply(this,arguments),this.collection.fetch(),this.propagateEventsToRegions()},"initialize":function(){t.defaults(this.options,{"pageSize":g.defaultPageSize,"ddItemsList":g.defaultPageSizes}),this.collection=new l(void 0,{"connector":this.options.context.getObject(o),"node":this.options.model,"autoreset":!0}),this._setTableView(),this._setPagination(),this.listenTo(this.tableView,"before:render",function(e){var t=this.tableView.searchBoxes.length&&this.tableView.searchBoxes[0];!t||t.ui.searchBox.hasClass("binf-hidden")||this.eventDropDownOpts.doNotShowDropDown||0!==this.tableView.tableCaptionView.accFocusedColumn||(this.eventDropDownOpts.doNotShowDropDown=!0)})},"onRender":function(){this.tableRegion.show(this.tableView),this.paginationRegion.show(this.paginationView)},"getUserSearchboxOptions":function(){return{"collection":new c(void 0,{"connector":this.options.context.getObject(o),"memberFilter":{"type":[0]},"limit":10,"comparator":function(e){return e.get("name_formatted").toLowerCase()}}),"source":function(e){var t=this;return this.collection.query=e,this.collection.fetch().then(function(){return t.collection.models})},"displayText":function(e){return e.get("name")},"highlighter":function(e){var t=this.collection.findWhere({"name":e});return new u({"model":t,"connector":this.collection.connector,"lightWeight":!1}).render().el},"filter":"user_id"}},"getEventSearchboxOptions":function(){this.eventDropDownOpts={"doNotShowDropDown":!1};var e=this.collection.auditEvents,n=function(e){return e.get("name")},o=function(e){var i=this,n=t.filter(i.collection.models,function(t){return-1!==t.get("name").toLowerCase().indexOf(e.toLowerCase())});return t.sortBy(n,function(e){return e.get("name")})},a=function(e){this.focused||(this.focused=!0,this.options.showHintOnFocus&&!this.options.dropDownOpts.doNotShowDropDown&&this.lookup()),this.options.dropDownOpts.doNotShowDropDown&&(this.options.dropDownOpts.doNotShowDropDown=!1)},s=function(e){return i("<div></div>").text(e).html()},r=function(e){this.options.dropDownOpts&&!this.options.dropDownOpts.doNotShowDropDown&&(this.options.dropDownOpts.doNotShowDropDown=!0);var t=this.options.clearOnSelect?"":h.formatMemberName(e);this.ui.searchBox.val(t),this.trigger(this.valueChangedEventName,{"column":this.options.filter,"keywords":e.get("id")})};return{"collection":e,"source":o,"displayText":n,"filter":"type","showHintOnFocus":!0,"menu":'<ul class="typeahead binf-dropdown-menu" role="listbox" id="event-picker-ul"></ul>',"dropDownOpts":this.eventDropDownOpts,"focus":a,"afterSelect":r,"highlighter":s}},"_setTableView":function(){var e=this.getUserSearchboxOptions(),i=this.getEventSearchboxOptions(),n=t.extend({"connector":this.model.connector,"collection":this.collection,"tableColumns":d,"orderBy":"audit_date desc","columnsWithTypeaheadSearchbox":{"user_id":e,"audit_name":i},"selectColumn":!1,"haveDetailsRowExpandCollapseColumn":!0,"actionItems":this.defaultActionItems,"commands":this.commands,"wfElementID":"","customLabels":{"emptyTableText":p.auditNoResultsPlaceholder}},this.options);this.tableView=new s(n)},"_setPagination":function(){var e={"collection":this.collection,"pageSize":this.options.pageSize,"defaultDDList":this.options.ddItemsList};this.paginationView=new r(e)}},{"enabled":function(e){return!1!==g.enabled&&!!e.node.get("id")}});return t.extend(f.prototype,a),f}),csui.define("csui/widgets/metadata/metadata.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/impl/metadata.properties.content.view","csui/widgets/metadata/impl/versions/metadata.versions.view","csui/widgets/metadata/impl/audit/metadata.audit.view","i18n!csui/widgets/metadata/impl/nls/lang","csui-ext!csui/widgets/metadata/metadata.panels"],function(e,t,i,n,o,a,s){var r=t.Model.extend({"defaults":{"sequence":100,"title":null,"name":"","contentView":null,"contentViewOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),l=t.Collection.extend({"model":r,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),d=new l([{"title":a.properties,"name":"properties","sequence":10,"contentView":i},{"title":a.versions,"name":"versions","sequence":20,"contentView":n},{"title":a.audit,"name":"audit","sequence":20,"contentView":o}]);if(s){d.add(e.flatten(s,!0));var c=1;d.forEach(function(e){e.get("name")||(e.set("name","unnamed_panel"+c,{"silent":!0}),c++)})}return d}),csui.define("hbs!csui/controls/tab.panel/impl/tab.link.dropdown",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return'<a href="#'+this.escapeExpression((o=null!=(o=t.uniqueTabId||(null!=e?e.uniqueTabId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"uniqueTabId","hash":{}}):o))+'" data-binf-toggle="tab">\r\n  <span class="cs-label">'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+"</span>\r\n</a>\r\n"}});return i.registerPartial("csui_controls_tab.panel_impl_tab.link.dropdown",n),n}),csui.define("csui/controls/tab.panel/impl/tab.link.dropdown.view",["csui/lib/underscore","csui/controls/tab.panel/impl/tab.link.view","hbs!csui/controls/tab.panel/impl/tab.link.dropdown","csui/lib/binf/js/binf"],function(e,t,i){"use strict";return t.extend({"template":i,"attributes":function(){var e=this.model.get("title");return{"id":"tablink-"+this.model.get("uniqueTabId"),"role":"menuitem","aria-label":e,"title":e}},"constructor":function(){t.prototype.constructor.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.$el.on("click",">a",e.bind(this._linkClicked,this))},"onBeforeDestroy":function(){this.$el.off("click",">a")},"activate":function(e){this.$el.hasClass("binf-active")||(this.triggerMethod("clear:active:tab"),this.ui.link.binf_tab("show"));var t=this.model.collection.indexOf(this.model);this._parent.options.activeTab&&this._parent.options.activeTab.set("tabIndex",t),this.triggerMethod("activate:tab",this),e||this.triggerMethod("click:link")},"_linkClicked":function(e){e.preventDefault(),e.stopPropagation(),this.activate()}})}),csui.define("hbs!csui/controls/tab.panel/impl/tab.links.dropdown",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <button id="'+this.escapeExpression((o=null!=(o=t.btnId||(null!=e?e.btnId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"btnId","hash":{}}):o))+'" type="button" class="binf-btn binf-btn-default"\r\n          aria-label="'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+'">\r\n    <span class="cs-label">'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+"</span>\r\n  </button>\r\n"},"3":function(e,t,i,n){var o;return'  <button id="'+this.escapeExpression((o=null!=(o=t.btnId||(null!=e?e.btnId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"btnId","hash":{}}):o))+'" type="button" class="binf-btn binf-btn-default binf-dropdown-toggle"\r\n          data-binf-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\r\n          aria-label="'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+'">\r\n    <span class="cs-label">'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+'</span>\r\n    <span class="cs-icon icon-caret-down" title="'+this.escapeExpression((o=null!=(o=t.addToolTipContent||(null!=e?e.addToolTipContent:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"addToolTipContent","hash":{}}):o))+'"></span>\r\n  </button>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o,a;return'<span class="dropdown-label">'+this.escapeExpression((a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"title","hash":{}}):a))+"</span>\r\n"+(null!=(o=t.if.call(e,null!=e?e.single_item:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.program(3,n,0)}))?o:"")+'<ul class="binf-dropdown-menu" role="menu" aria-labelledby="'+this.escapeExpression((a=null!=(a=t.btnId||(null!=e?e.btnId:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"btnId","hash":{}}):a))+'">\r\n</ul>\r\n'}});return i.registerPartial("csui_controls_tab.panel_impl_tab.links.dropdown",n),n}),csui.define("css!csui/controls/tab.panel/impl/tab.links.dropdown",[],function(){}),csui.define("csui/controls/tab.panel/tab.links.dropdown.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/tab.panel/impl/tab.link.dropdown.view","hbs!csui/controls/tab.panel/impl/tab.links.dropdown","csui/controls/tab.panel/behaviors/tab.links.dropdown.keyboard.behavior","csui/behaviors/dropdown.menu/dropdown.menu.behavior","i18n!csui/controls/tab.panel/impl/nls/lang","css!csui/controls/tab.panel/impl/tab.links.dropdown","csui/lib/binf/js/binf"],function(e,t,i,n,o,a,s,r){"use strict";return i.CompositeView.extend({"className":"cs-tab-links binf-dropdown tile-nav","template":o,"templateHelpers":function(){return{"single_item":1===this.collection.length,"addToolTipContent":r.showMore,"btnId":e.uniqueId("cstabBtn")}},"childView":n,"childViewContainer":">ul","ui":{"toggle":">.binf-dropdown-toggle","menuButton":">.binf-btn","selectedLabel":">.binf-btn >.cs-label"},"behaviors":{"TabLinksDropdownKeyboardBehavior":{"behaviorClass":a},"DropdownMenuBehavior":{"behaviorClass":s}},"constructor":function(e){i.CompositeView.prototype.constructor.apply(this,arguments),this.selected=new t.Model;var n=e.activeTab&&e.activeTab.get("tabIndex");if(this.collection&&this.collection.length>0&&void 0!==n&&n<this.collection.length){var o=e.selectedTab&&(e.selectedTab instanceof t.Model&&e.selectedTab.get("title")||e.selectedTab);if(void 0!==o&&o===this.collection.at(n).get("title"))this._setSelection(this.collection.at(n));else{var a=-1;void 0!==o&&-1===(a=this._getModelIndexByPropertyValue(o,this.collection,"title"))&&(a=this._getModelIndexByPropertyValue(o,this.collection,"name")),-1!==a?(this._setSelection(this.collection.at(a)),e.activeTab.set("tabIndex",a)):(this._setSelection(this.collection.at(0)),e.activeTab.set("tabIndex",0))}}this.listenTo(this.collection,"change",this._refreshSelection),this.listenTo(this.selected,"change",this._updateSelection)},"_getModelIndexByPropertyValue":function(e,t,i){var n=-1;return t.some(function(t,o){if(t.get(i)===e)return n=o,!0}),n},"onRender":function(){var e=this.selected.get("title");this.ui.selectedLabel.text(e),this.ui.menuButton.attr("aria-label",e),1!==this.collection.length&&this.ui.toggle.binf_dropdown();for(var t=this.selected.get("id"),i=0;i<this.collection.length;i++)if(t===this.collection.at(i).get("id")){var n=this.$el.find("ul li");n.removeClass("binf-active"),this.$(n.get(i)).addClass("binf-active");break}},"onChildviewClickLink":function(e){this._setSelection(e.model),this.ui.toggle.binf_dropdown("toggle")},"onChildviewClearActiveTab":function(e){this.children.each(function(e){e.$el.hasClass("binf-active")&&e.$el.removeClass("binf-active")})},"_setSelection":function(e){this.selected.set(e.pick("id","title","name"))},"_updateSelection":function(){var e=this.selected.get("title");this.ui.selectedLabel.text(e),this.ui.menuButton.attr("aria-label",e)},"_refreshSelection":function(e){e.get("id")===this.selected.get("id")&&this._setSelection(e)},"activateDropdownTab":function(e,t){this.children.some(function(i){if(i.model.get("name")===e)return i.activate(t),this._setSelection(i.model),!0}.bind(this))}})}),csui.define("csui/widgets/metadata/impl/metadata.dropdowntab.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/controls/tab.panel/tab.panel.view","csui/widgets/metadata/metadata.panels","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/controls/tab.panel/tab.links.dropdown.view","csui/lib/binf/js/binf"],function(e,t,i,n,o,a,s){"use strict";return n.extend({"className":"metadata-content-wrapper binf-panel binf-panel-default","ui":{"dropdownToggle":".binf-dropdown-toggle"},"contentView":function(){return this.options.contentView},"contentViewOptions":function(){return{"context":this.options.context,"model":this.options.node,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"blockingParentView":this.options.blockingParentView,"selectedProperty":this.options.selectedProperty}},"constructor":function(t){this.options=t||(t={}),e.defaults(t,{"TabLinkCollectionViewClass":s,"implementTabContentsDefaultKeyboardHandling":!1,"delayTabContent":!1!==t.delayTabContent}),this.behaviors=e.extend({"PerfectScrolling":{"behaviorClass":a,"contentParent":".binf-dropdown-menu","suppressScrollX":!0,"includePadding":!0}},this.behaviors),t.tabs=this._buildTabs(),n.prototype.constructor.call(this,t),this.listenTo(this.options.node,"change",this._nodeChanged).listenTo(i,"closeToggleAction",this._closeToggle)},"_buildTabs":function(){return o.chain().filter(function(e){
var t=e.get("contentView"),i=t.enabled;return this.options.node.attributes.customProperties?!!e.attributes.executeCommand&&(!i||i({"context":this.options.context,"node":this.options.node})):!i||i({"context":this.options.context,"node":this.options.node})},this).map(function(e){return e.attributes}).value()},"onRender":function(){this.$el.prepend("<div class='csui-metadata-tab-bar'></div>");var e=this;this.$el.find(".binf-dropdown-toggle").on("binf.dropdown.after.show",function(){e.trigger("update:scrollbar")})},"onActivateTab":function(e,t,i){e&&e.triggerMethod("panel:activated")},"_closeToggle":function(){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&(e.length&&e.length>1?e.each(function(e,i){t(i).parent().hasClass("binf-open")&&!t(i).is(":hidden")&&t(i).binf_dropdown("toggle")}):!e.is(":hidden")&&e.binf_dropdown("toggle"))},"_updateTabs":function(){var e=this._buildTabs();this.collection.reset(this._convertCollection({"tabs":e}).models)},"_nodeChanged":function(){(this.options.node.hasChanged("id")||this.options.node.hasChanged("type"))&&this._updateTabs()}})}),csui.define("csui/widgets/metadata/impl/metadata.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","csui/utils/base"],function(e,t,i,n,o){function a(e,t,i){this.status=e||{},this.options=t||{},this.attributes=i||{}}return e.extend(a.prototype,i.Events,{"save":function(e,t){return e.save(t,{"wait":!0,"patch":!0})},"createItem":function(e,t){return e.save(void 0,{"data":t,"wait":!0})}}),a.prototype.get=i.Model.prototype.get,e.extend(a,{"version":"1.0"}),a}),csui.define("csui/widgets/metadata/metadata.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/base","csui/widgets/metadata/impl/header/metadata.header.view","csui/widgets/metadata/impl/metadata.dropdowntab.view","csui/utils/contexts/factories/node","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/controls/mixins/view.state/metadata.view.state.mixin","csui/widgets/metadata/impl/metadata.controller","csui/controls/progressblocker/blocker","csui/utils/commandhelper","csui/widgets/permissions/permissions.view","csui/dialogs/modal.alert/modal.alert","csui/utils/contexts/factories/metadata.factory","csui/utils/contexts/factories/next.node","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p,g,f,w){"use strict";var b=e.config();t.defaults(b,{"showExtraRightActionBar":!1});var v=n.ItemView.extend({"className":"cs-metadata","template":!1,"constructor":function(e){var o=this;if(e||(e={}),e.data||(e.data={}),this.options=e,this.options.showExtraRightActionBar=this.options.showPermissionView||b.showExtraRightActionBar,this.targetView=e.targetView,this.context=e.context,this.thumbnailViewState=e.originatingView&&e.originatingView.thumbnailViewState,this.disableViewState=e.disableViewState,e.model||(e.model=e.context.getModel(r,{"attributes":e.data.id&&{"id":e.data.id},"temporary":!0})),this._isViewStateModelEnabled()&&(this.isMetadataNavigation()||(this.options.showBackIcon=!0,this.listenTo(this,"metadata:close",this._backToPreviousPerspective))),e.model.unset("initialPanel",{"silent":!0}),e.data.initialPanel&&e.model.set("initialPanel",e.data.initialPanel,{"silent":!0}),this.options.showShortcutSwitch=!0,this.options.showRequiredFieldsSwitch=!0,1===this.options.model.get("type")||this.options.model.get("shortcutNode")){if(this.options.model.get("shortcutNode")&&1!==this.options.model.get("type"))this.options.shortcutNode=this.options.model.get("shortcutNode");else{this.options.model.connector.assignTo(this.options.model.original),this.options.shortcutNode=this.options.model;var l=this.options.shortcutNode.getResourceScope();this.options.model.original.setResourceScope(l),this.options.model=this.options.model.original,this.options.model.set("shortcutNode",this.options.shortcutNode,{"silent":!0})}this.options.actionsPromise=this._ensureCompleteNode()}else this.options.actionsPromise=i.Deferred().resolve().promise();this.options.originatingView&&this.options.originatingView.supportOriginatingView&&(this.options.baseOriginatingView=this.options.originatingView,this.options.originatingView=this),n.ItemView.prototype.constructor.call(this,e),u.imbue(this),this.options.showDropdownMenu=!0,this.options.originatingView=this.options.originatingView||this,this.metadataHeaderView=new a(t.extend({"metadataScenario":!0,"originatingView":this},this.options)),this.listenTo(this.metadataHeaderView,"metadata:item:name:save",this._saveItemName).listenTo(this.metadataHeaderView,"metadata:item:before:delete",function(e){o.trigger("metadata:item:before:delete",e)}).listenTo(this.metadataHeaderView,"metadata:item:before:move",function(e){o.trigger("metadata:item:before:move",e)}).listenTo(this.metadataHeaderView,"metadata:item:deleted",function(e){o.trigger("metadata:item:deleted",e)}).listenTo(this.metadataHeaderView,"shortcut:switch",function(e){o.options.model=e.node,o.options.model.set("shortcutNode",o.model.get("shortcutNode"),{"silent":!0}),this._ensureCompleteNode().always(function(){!!o.metadataTabView&&o.metadataTabView.destroy(),o.options.showPermissionView?o.metadataTabView=new m({"model":o.options.model,"originatingView":o.options.originatingView,"context":o.options.context,"showCloseIcon":!o.options.originatingView,"showBackIcon":!!o.options.originatingView,"selectedTab":status.selectedTab,"selectedProperty":o.options.selectedProperty}):o.metadataTabView=new s({"context":o.options.context,"node":o.options.model,"containerCollection":o.options.containerCollection,"originatingView":o.options.originatingView,"metadataView":o,"activeTab":o.options.activeTab,"delayTabContent":o.options.delayTabContent}),o.$el.append(o.metadataTabView.render().$el),o.propagateEventsToViews(o.metadataTabView)})}).listenTo(this.metadataHeaderView,"metadata:close",function(){o.trigger("metadata:close")}).listenTo(this.options.context,"retain:perspective",function(){o._closeMetadata()});var d={"context":this.options.context,"node":this.options.model,"containerCollection":this.options.containerCollection,"originatingView":this.options.originatingView,"metadataView":this,"blockingParentView":this,"activeTab":this.options.activeTab,"selectedTab":this.options.selectedTab||this.getViewStateDropdown(),"selectedProperty":this.options.selectedProperty,"delayTabContent":o.options.delayTabContent};this.options.showPermissionView?this.options.actionsPromise.always(function(){o.metadataTabView=new m({"model":o.options.model,"originatingView":o.options.originatingView,"context":o.options.context,"showCloseIcon":!o.options.originatingView,"showBackIcon":!!o.options.originatingView,"selectedTab":status.selectedTab,"selectedProperty":o.options.selectedProperty}),o.propagateEventsToViews(o.metadataTabView,o.metadataHeaderView)}):(this.metadataTabView=new s(d),this.propagateEventsToViews(this.metadataTabView,this.metadataHeaderView)),this._isViewStateModelEnabled()&&this.listenTo(this.context.viewStateModel,"change:state",this.onViewStateChanged)},"onRender":function(){var e=this.options.model.fetching;if(e)return e.always(t.bind(this.render,this));var i=this.metadataHeaderView.render(),o=this.metadataTabView.render();n.triggerMethodOn(i,"before:show",i,this),n.triggerMethodOn(o,"before:show",o,this),this.$el.append(i.el),this.$el.append(o.el),n.triggerMethodOn(i,"show",i,this),n.triggerMethodOn(o,"show",o,this),this._isViewStateModelEnabled()&&!this.showPermissionView&&this._listenToDropdownSelection()},"_isViewStateModelEnabled":function(){var e=this.context&&this.context.viewStateModel;return!this.disableViewState&&e&&e.get("enabled")},"onViewStateChanged":function(){var e=this.getViewStateDropdown()||this.getDefaultViewStateDropdown(),t=this.metadataTabView.tabLinks;t&&t.selected&&e&&t.selected.get("name")!==e&&t.activateDropdownTab(e,!0)},"_listenToDropdownSelection":function(){var e=this.metadataTabView.tabLinks;if(e&&e.selected){var t=this.getViewStateDropdown();t!==e.selected.get("name")&&this.setViewStateDropdown(e.selected.get("name"),{"default":!t,"title":e.selected.get("title")}),this.listenTo(e.selected,"change",this._onDropDownSelectionChanged)}},"_onDropDownSelectionChanged":function(e){this.setViewStateDropdown(e.get("name"),{"title":e.get("title")})},"onBeforeDestroy":function(){this.cancelEventsToViewsPropagation(this.metadataTabView,this.metadataHeaderView),this.metadataHeaderView.destroy(),this.metadataTabView.destroy(),this.targetView&&this.thumbnailViewState&&this.targetView.thumbnail.resultsView.triggerMethod("metadata:close")},"_saveItemName":function(e){var i,n=this,o=e.sender.getValue(),a={"name":o},s=new c,l=this.options.model;this.options.collection;if(this.options.shortcutNode&&this.options.shortcutNode.original===l){var d=this.options.collection.findWhere({"id":l.get("id")});d?(i=l,l=d):void 0}var u=n.context.getModel(r);u&&u.set("name",o),n._blockActions(),s.save(l,a).done(function(){return l.fetch().then(function(){i&&i.set(l.attributes),e.success&&e.success(),n._unblockActions(),n.options.originatingView&&t.isFunction(n.options.originatingView.unblockActions)&&n.options.originatingView.unblockActions()})}).fail(function(t){n._unblockActions();var i=h._getErrorMessageFromResponse(t);void 0===i&&(i=w.failedToSaveName),e.error&&e.error(i)})},"_ensureCompleteVersionNode":function(){return this._blockActions(),this.options.model.fetch().always(t.bind(this._unblockActions,this)).fail(function(e){var t=new o.Error(e);p.showError(t.message)})},"_ensureCompleteNode":function(){function e(e){var i=n.get(e+"_id");if(i&&!t.isObject(i)&&!t.isObject(n.get(e+"_id_expand")))return n.setExpand("properties",e),!0}var n=this.options.model,a=t.invoke(["original","parent","create_user","modify_user","owner_user","reserved_user"],e);a=t.contains(a,!0);var s=n.actions.length<=1;return a||s?(this._blockActions(),n.fetch().always(t.bind(this._unblockActions,this)).fail(t.bind(function(e){var t=new o.Error(e);p.showError(t.message)},this))):i.Deferred().resolve().promise()},"_backToPreviousPerspective":function(){this.metadataTabView instanceof s&&(this._isViewStateModelEnabled()?this.context.viewStateModel.restoreLastRouter():this._setNextNodeModelFactory(this.options.model.get("id")))},"_setNextNodeModelFactory":function(e){if(this.context&&void 0!==e){var t=this.context.getModel(f);t&&(t.get("id")===e&&t.unset("id",{"silent":!0}),t.set("id",e))}},"_closeMetadata":function(){var e=this.options.model;1===e.get("type")&&e.original&&0===e.original.get("type")?this.trigger("metadata:close"):this.trigger("metadata:close:without:animation")},"_blockActions":function(){var e=this.options.originatingView;e&&e.blockActions&&e.blockActions()},"_unblockActions":function(){var e=this.options.originatingView;e&&e.unblockActions&&e.unblockActions()}});return t.extend(v.prototype,l),t.extend(v.prototype,d),v}),csui.define("csui/widgets/metadata/metadata.action.one.item.properties.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/widgets/metadata/impl/header/metadata.header.view","csui/widgets/metadata/metadata.properties.view","csui/utils/log","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,a,s,r){var l=n.ItemView.extend({"className":"cs-add-item-metadata-form","template":!1,"constructor":function(e){e||(e={}),this.options=e,n.ItemView.prototype.constructor.apply(this,arguments),e.showRequiredFieldsSwitch=!0,this.metadataHeaderView=new o(e),this.listenTo(this.metadataHeaderView,"metadata:item:name:save",this._saveItemName),this.listenTo(this.metadataHeaderView,"update:button",t.bind(function(e){this.trigger("update:button",e)},this)),this.metadataPropertiesView=new a({"node":e.model,"collection":e.collection,"container":e.container,"context":e.context,"hideStickyHeader":!!e.hideStickyHeader,"formMode":"create","action":e.action,"inheritance":e.inheritance,"metadataView":this,"formCollection":e.formCollection,"suppressAddProperties":e.suppressAddProperties}),e.collection||this.listenTo(this.metadataPropertiesView.allForms,"sync",this._updateSchema),this.listenTo(this.metadataPropertiesView,"render:forms",this.setNameFieldFocus),this.propagateEventsToViews(this.metadataHeaderView,this.metadataPropertiesView)},"_updateSchema":function(){var e=this.metadataPropertiesView.allForms.first(),t=e&&e.get("schema"),i=t&&t.properties&&t.properties.name;i?this.metadataHeaderView.metadataItemNameView.updateNameSchema(i):s.warn("Form collection lacks name field in the first form.")&&console.warn(s.last)},"onRender":function(){var e=this.metadataHeaderView.render(),t=this.metadataPropertiesView.render();n.triggerMethodOn(e,"before:show",e,this),n.triggerMethodOn(t,"before:show",t,this),!0!==this.options.suppressHeaderView&&this.$el.append(e.el),this.$el.append(t.el),this.options.suppressHeaderView&&this.$el.addClass("without-header-bar"),this.options.extraViewClass&&this.$el.addClass(this.options.extraViewClass),n.triggerMethodOn(e,"show",e,this),n.triggerMethodOn(t,"show",t,this)},"onBeforeDestroy":function(){this.cancelEventsToViewsPropagation(this.metadataHeaderView,this.metadataPropertiesView),this.metadataHeaderView.destroy(),this.metadataPropertiesView.destroy()},"validate":function(){var e=this.metadataHeaderView.validateName(),t=this.metadataPropertiesView.validateForms();return e&&t},"getValues":function(){var e={};if(this.validate()){e={"name":this.metadataHeaderView.getNameValue(),"type":this.options.model.get("type"),"parent_id":this.options.model.get("parent_id")};var i=this.metadataPropertiesView.getFormsValues();t.extend(e,i)}return e},"setNameFieldFocus":function(){!0!==this.firstFocusCalled&&!0!==this.options.suppressHeaderView&&this.metadataHeaderView.setNameEditModeFocus(),this.firstFocusCalled=!0},"_saveItemName":function(e){var t=e.sender.getValue();this.model.set("name",t,{"silent":!0}),e.success&&e.success()}});return l.version="1.0",t.extend(l.prototype,r),l}),csui.define("csui/widgets/metadata/impl/common/base.metadata.action.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/controls/dialog/dialog.view","csui/controls/progressblocker/blocker","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,a){function s(){}return e.extend(s.prototype,i.Events,{"baseDisplayForm":function(i){if(i||(i={}),this.options=i,this.deferred=t.Deferred(),i.view&&o.imbue(i.view),i.originatingView);else{var s=i.dialogOptions||{},r=s.OkButtonClick||this._cancelAction,l=s.CancelButtonClick||this._cancelAction,d=[{"id":"okButton","default":!0,"label":s.OkButtonTitle?s.OkButtonTitle:a.defaultDialogOkButtonTitle,"click":e.bind(r,this,i)},{"id":"cancel","label":s.CancelButtonTitle?s.CancelButtonTitle:a.defaultDialogCancelButtonTitle,"click":e.bind(l,this),"actionToken":s.CancelButtonActionToken}];this.options.view.model&&(this.options.view.model.get("name")||(d[0].disabled=!0));var c=s.dialogTitle?s.dialogTitle:a.defaultDialogTitle,u=new n({"className":"cs-item-action-metadata","title":c,"buttons":d,"largeSize":!0,"view":i.view});this.dialog=u,this.listenTo(this.dialog,"hide",this._cancelAction).listenTo(this.dialog,"update:button",e.bind(function(e){if(void 0!==e.overlay){var t=this.dialog.footerView.collection.get("okButton"),i=this.dialog.footerView.children.findByModel(t),n=i&&!i.$el.is(":disabled")&&e.overlay?"addClass":"removeClass";i.$el[n]("cs-button-overlay")}else this.dialog.footerView.updateButton("okButton",e)},this)),u.show()}return this.deferred.promise()},"_cancelAction":function(e){!!this.node&&!!this.node.collection&&!!this.node.collection.requireSwitched&&(!!this.node.get("action")||!!this.options.view&&this.options.view.options.action)&&(this.node.collection.requireSwitched=!1),this.options.view&&this.options.view.unblockActions(),this.dialog.destroy(),void 0===e&&(e={"buttonAttributes":{"actionToken":"closeMetadataActionView"}}),this.deferred.reject(e)}}),s.prototype.get=i.Model.prototype.get,e.extend(s,{"version":"1.0"}),s}),csui.define("csui/widgets/metadata/impl/add.properties/metadata.add.categories.view",["require","csui/lib/underscore","csui/lib/jquery","csui/utils/url","csui/utils/log","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/forms","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,a,s,r,l){"use strict";function d(){}return t.extend(d.prototype,a.prototype,{"displayForm":function(e){var t=i.Deferred(),n=this;e||(e={}),this.node=e.model,this.catId=e.catId,this.catName=e.catName;var a=new s([e.catModel]);return a.fetching=!1,a.fetched=!0,csui.require(["csui/widgets/metadata/metadata.action.one.item.properties.view"],function(i){n.metadataAddItemPropView=new i({"model":e.model,"collection":a,"context":e.context,"commands":e.commands,"suppressAddProperties":!0,"suppressHeaderView":!0,"hideStickyHeader":!0,"extraViewClass":"add-category"});var o={};o.callerProcessData=e.callerProcessData,o.originatingView=e.originatingView,o.view=n.metadataAddItemPropView;var s={};s.dialogTitle=e.dialogTitle?e.dialogTitle:r.addNewCategoryDialogTitle,s.OkButtonTitle=e.okButtonTitle?e.okButtonTitle:r.addNewCategoryDialogAddButtonTitle,s.OkButtonClick=n._addCategory,o.dialogOptions=s,n.baseDisplayForm(o).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})},function(e){o.warn("Failed to load MetadataActionOneItemPropertiesView. {0}",e)&&console.log(o.last),t.reject(e)}),t.promise()},"_addCategory":function(e){if(this.metadataAddItemPropView.validate()){this.options.view.$el.find(".cs-formfield-invalid").removeClass("cs-formfield-invalid");var i=this.node.get("id"),o=this.metadataAddItemPropView.getValues(),a={"id":i,"category_id":this.catId};o.roles&&o.roles.categories&&t.each(o.roles.categories,function(e,i){a=t.extend(a,e)});var s=n.combine(this.node.urlBase(),"categories"),d=new FormData,c={"type":"POST","url":s};d.append("body",JSON.stringify(a)),t.extend(c,{"data":d,"contentType":!1,"processData":!1}),this.metadataAddItemPropView.blockActions(),this.node.connector.makeAjaxCall(c).done(t.bind(function(e){this.metadataAddItemPropView.unblockActions(),this.dialog.destroy(),this.deferred.resolve(e)},this)).fail(t.bind(function(e){this.metadataAddItemPropView.unblockActions();var n="";e&&e.responseJSON&&e.responseJSON.error&&(n=e.responseJSON.error);var o=r.addNewCategoryFailTitle,a=t.str.sformat(r.addNewCategoryFailMessage,this.catName,this.node.get("name"),i,n);l.showError(a,o)},this))}else this.options.view.$el.find(".binf-has-error .cs-formfield").addClass("cs-formfield-invalid")}}),t.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/metadata.add.categories.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","csui/utils/base","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/widgets/metadata/impl/metadata.utils","csui/widgets/metadata/impl/add.properties/metadata.add.categories.view","csui/models/appliedcategoryform","csui/dialogs/node.picker/node.picker","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,a,s,r,l,d,c,u){"use strict";function h(){}return e.extend(h.prototype,i.Events,{"AddNewCategory":function(i){var n=t.Deferred();return new c({"startLocation":"category.volume","context":i.context,"selectableTypes":[131],"unselectableNodes":i.collection?i.collection.where({"role_name":"categories"}):[],"selectMultiple":!1,"dialogTitle":a.selectCategoryTitle,"globalSearch":!0,"selectButtonLabel":a.selectCategoryButtonLabel}).show().done(e.bind(function(o){e.reduce(o.nodes,function(t,n){return t.then(e.bind(function(){var e=n.get("id"),t=n.get("name");return void 0===i.node.get("id")||i.action?this._loadNewCategoryForm(i,e,t):this._displayAddCategoryForm(i,e,t)},this))},t.Deferred().resolve(),this).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})},this)).fail(function(e){n.reject(e)}),n.promise()},"_displayAddCategoryForm":function(e,i,n){var o=t.Deferred(),a=this;return this._getCategoryModel(e,i,n).done(function(t){var s={"model":e.node,"context":e.context,"commands":u,"catId":i,"catName":n,"catModel":t.catModel};(new l).displayForm(s).done(function(t){a._loadNewCategoryForm(e,i,n,"update").done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})}).fail(function(e){o.reject(e)})}).fail(function(e){o.reject(e)}),o.promise()},"_loadNewCategoryForm":function(i,n,o,r){if(n&&i.collection.get(n)){var l=a.addNewCategoryFailTitle,d=e.str.sformat(a.categoryExistsMessage,o);return s.showError(d,l),t.Deferred().reject({})}var c=t.Deferred();return this._getCategoryModel(i,n,o,r).done(e.bind(function(e){c.resolve(e)},this)).fail(function(e){c.reject(e)}),c.promise()},"_getCategoryModel":function(i,o,l,c){var u=!0;c||(c="create",void 0===i.action&&(u=!1));var h,m=t.Deferred(),p=i.node&&i.node.connector||i.container&&i.container.connector,g=i.node.get("id");if(i.container&&(i.node.pId=i.container.get("id")),void 0===i.node.get("id")&&"create"===i.action)h=n.combine(p.connection.url,"forms/nodes/create?parent_id="+i.container.get("id")+"&type="+i.node.get("type")+"&category_id="+o);else if("copy"===i.action||"move"===i.action){var f=0;"destination"===i.inheritance?f=1:"merged"===i.inheritance&&(f=2),h=n.combine(p.connection.url,"forms/nodes/"+i.action+"?id="+g+"&parent_id="+i.container.get("id")+"&inheritance="+f+"&category_id="+o)}else h=n.combine(p.connection.url,"forms/nodes/categories/"+c+"?id="+g+"&category_id="+o);var w={"type":"GET","url":h};return i.parentView&&(i.parentView.blockActions(),i.parentView.trigger("update:button",!0)),p.makeAjaxCall(w).done(e.bind(function(t){i.parentView&&i.parentView.unblockActions();var n,a,s,c;if("create"===i.action||"copy"===i.action||"move"===i.action?t.forms.length>1&&(n=e.find(t.forms,function(e){return"categories"===e.role_name}))&&(a=n.data[o]||{},s=n.options.fields[o]||{},c=n.schema.properties[o]||{}):(n=t&&t.forms&&t.forms[0],a=n&&n.data||{},s=n.options||{},c=n.schema||{}),n){s.form&&(s=e.omit(s,"form")),void 0===c.title&&l&&(c.title=l);var h=new r,p=h.AlpacaFormOptionsSchemaHaveRequiredFields(s,c),g=new d({"id":o,"title":l||s&&s.fields&&s.fields.category_id&&s.fields.category_id.label,"allow_delete":u,"removeable":u,"required":p,"data":a,"schema":e.omit(c,"description"),"options":s,"role_name":"categories"},{"node":i.node,"categoryId":o,"action":"none","parse":!0});m.resolve({"catModel":g})}else m.reject({})},this)).fail(e.bind(function(t){i.parentView&&(i.parentView.unblockActions(),i.parentView.trigger("update:button",!1));var n=this._getRespError(t),o=a.loadNewCategoryFailTitle,r=e.str.sformat(a.loadNewCategoryFailMessage,l,i.node.get("name"),g,n);s.showError(r,o),m.reject(t)},this)),m.promise()},"_getRespError":function(e){var i="";return e&&e.responseJSON&&e.responseJSON.error?i=e.responseJSON.error:o.MessageHelper.hasMessages()&&(i=t(o.MessageHelper.toHtml()).text(),o.MessageHelper.clear()),i}}),e.extend(h,{"version":"1.0"}),h}),csui.define("csui/widgets/metadata/metadata.add.item.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/widgets/metadata/impl/metadata.controller","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/utils/commandhelper","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/nodesprites","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,a,s,r,l){function d(){}return e.extend(d.prototype,t.prototype,{"displayForm":function(t,i){var s=o.getAtLeastOneNode(t),d=s.length>0?s.models[0]:null,c=d.get("type_name")?r.findTypeByNode(d):a.addItemMetadataDialogTitleGeneric;this.node=d,this.metadataController=i.metadataController;var u=this.metadataAddItemPropView=new n({"model":d,"container":t.container,"id":i.id,"context":t.context||i&&i.context,"commands":l,"action":"create","inheritance":i.inheritance,"collection":i.completeFormCollection,"formCollection":i.formCollection}),h={};h.callerProcessData=i.callerProcessData,h.originatingView=i.originatingView,h.view=u;var m={};m.dialogTitle=i.dialogTitle?i.dialogTitle:e.str.sformat(a.addItemMetadataDialogTitle1,c),m.OkButtonTitle=i.addButtonTitle?i.addButtonTitle:a.addItemMetadataDialogButtonAddTitle,m.OkButtonClick=this._addItem,m.CancelButtonActionToken=i.cancelButtonActionToken,h.dialogOptions=m;var p=this.baseDisplayForm(h);return this.listenTo(this.metadataAddItemPropView,"update:button",e.bind(function(e){this.dialog&&this.dialog.trigger("update:button",e)},this)),p},"_addItem":function(t){function n(e,t){e&&e.footerView&&e.footerView.getButtons().forEach(function(e){e.updateButton(t)})}if(t.view.metadataPropertiesView.allFormsRendered){var o=!1;!0!==t.callerProcessData&&(n(this.dialog,{"disabled":!0}),o=!0);if(this.metadataAddItemPropView.validate()){var r=this.metadataAddItemPropView.getValues();if(!0===t.callerProcessData)this.dialog.destroy(),this.deferred.resolve({"data":r});else{var l=this.metadataController||new i;this.metadataAddItemPropView.blockActions(),o=!1,l.createItem(this.node,r).done(e.bind(function(e){this.listenToOnce(this.dialog,"hide",function(){this.metadataAddItemPropView.unblockActions(),n(this.dialog,{"disabled":!1})}),this.dialog.destroy(),this.deferred.resolve({"name":r.name})},this)).fail(e.bind(function(e){this.metadataAddItemPropView.unblockActions();var t=a.failedToCreateItem;e&&(e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:e.responseText&&(t=e.responseText),s.showError(t)),n(this.dialog,{"disabled":!1})},this))}}o&&n(this.dialog,{"disabled":!1})}}}),e.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.keyboard.behavior",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/log","csui/lib/marionette"],function(e,t,i,n,o){"use strict";var a={"none":-1,"header":0,"list":1};return o.Behavior.extend({"constructor":function(e,n){o.Behavior.prototype.constructor.apply(this,arguments),n.keyboardBehavior=this,this.tabableElements=[];var s=this;this.listenTo(n,"show",function(){s.refreshTabableElements(n)}),this.listenTo(n,"click:item",function(e){var t=n.selectedIndex,i=n.selectedIndexElem(t);i&&i.prop("tabindex","-1"),n.currentTabPosition=a.list,n.selectedIndex=n.collection.indexOf(e.model)}),t.extend(n,{"_focusHeader":function(){if(!0===this.headerFocusable&&this.headerElement)return this.currentTabPosition=a.header,i(this.ui.header)},"_focusList":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.currentTabPosition=a.list,this.getSelectedItem().$el},"_setFocus":function(){return!0===this.headerFocusable&&this.headerElement?this._focusHeader():this._focusList()},"_headerIsInFocus":function(){return this.$(this.ui.header).is(":focus")},"_listIsInFocus":function(){var e,t=!1;for(e=0;e<this.collection.length;e++){var i=this.selectedIndexElem(e);if(i&&i.is(":focus")){t=!0;break}}return t},"_checkFocusAndSetCurrentTabPosition":function(){this._headerIsInFocus()?this.currentTabPosition=a.header:this._listIsInFocus()?this.currentTabPosition=a.list:this.currentTabPosition=a.none},"_setFirstAndLastFocusable":function(){!0===this.headerFocusable&&i(this.ui.header).prop("tabindex","0"),this.getSelectedItem()&&this.getSelectedItem().$el.prop("tabindex","0")},"currentlyFocusedElement":function(e){return this._checkFocusAndSetCurrentTabPosition(),this._setFirstAndLastFocusable(),e&&e.shiftKey?this._focusList():this.currentTabPosition===a.header?this._focusHeader():this.currentTabPosition===a.list?this._focusList():this._setFocus()},"_resetFocusedListElem":function(){var e,t;e=this.selectedIndex,t=this.selectedIndexElem(e),t&&t.prop("tabindex","-1"),e=this.getSelectedIndex(),t=this.selectedIndexElem(e),t&&(t.prop("tabindex","0"),this.selectedIndex=e),i(this.ui.header).prop("tabindex","0")},"_moveTo":function(e,i,n){e.preventDefault(),e.stopPropagation(),setTimeout(t.bind(function(){n&&n.prop("tabindex","-1"),i.prop("tabindex","0"),i.trigger("focus")},this),50)},"onKeyInView":function(e){this._checkFocusAndSetCurrentTabPosition(),9===e.keyCode?e.shiftKey?this.currentTabPosition===a.list&&!0===this.headerFocusable&&this.headerElement&&i(this.ui.header).is(":visible")&&(this._moveTo(e,this._focusHeader()),this._resetFocusedListElem()):this.currentTabPosition===a.header?this.$el.find(">.cs-content").is(":visible")&&this._moveTo(e,this._focusList()):setTimeout(t.bind(function(){this._resetFocusedListElem()},this),50):32!==e.keyCode&&13!==e.keyCode||(this.currentTabPosition===a.header?(e.preventDefault(),e.stopPropagation(),this.clickBack()):this.currentTabPosition===a.list&&(e.preventDefault(),e.stopPropagation(),this.selectAt(this.selectedIndex)))},"onKeyDown":function(e){if(this._checkFocusAndSetCurrentTabPosition(),this.currentTabPosition!==a.list)return void this.onKeyInView(e);var t=this.selectedIndex;(t<0||void 0===t)&&(t=this.getSelectedIndex());var i=this.selectedIndexElem(t);switch(e.which){case 33:this._moveTo(e,this._selectFirst(),i);break;case 34:this._moveTo(e,this._selectLast(),i);break;case 38:this._moveTo(e,this._selectPrevious(),i);break;case 40:this._moveTo(e,this._selectNext(),i);break;default:return void this.onKeyInView(e)}},"_selectFirst":function(){return this.selectedIndex=0,this.selectedIndexElem(this.selectedIndex)},"_selectLast":function(){return this.selectedIndex=this.collection.length-1,this.selectedIndexElem(this.selectedIndex)},"_selectNext":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.selectedIndex<this.collection.length-1&&this.selectedIndex++,this.selectedIndexElem(this.selectedIndex)},"_selectPrevious":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.selectedIndex>0&&this.selectedIndex--,this.selectedIndexElem(this.selectedIndex)},"selectAt":function(e){if(!(e>=this.collection.length||e<0)){var t=this.selectedIndexElem(e);t&&t.trigger("click")}}})},"refreshTabableElements":function(e){n.debug("MetadataNavigationListKeyboardBehavior::refreshTabableElements "+e.constructor.name)&&console.log(n.last),e.options.data.back_button&&(this.view.headerFocusable=!0,this.view.headerElement=e.ui.header),this.view.currentTabPosition=a.none,this.view.selectedIndex=-1}})}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.view",["csui/lib/underscore","csui/lib/jquery","csui/controls/list/simplelist.view","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/widgets/metadata/impl/metadata.navigation.list.keyboard.behavior","csui/controls/node-type.icon/node-type.icon.view","csui/models/version","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,a,s,r){return i.extend({"childViewOptions":function(e){return{"templateHelpers":function(){var e=this.options.nameAttribute||"name";return{"enableIcon":!0,"name":this.model.get(e)}},"nameAttribute":this.options.data.nameAttribute}},"events":{"keydown":"onKeyDown"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":n,"initialActivationWeight":100},"MetadataNavigationListKeyboardBehavior":{"behaviorClass":o}},"constructor":function(t){this.options=t||{},this.events=e.extend({},i.prototype.events,this.events),i.apply(this,arguments),this.listenTo(this,"childview:render",this.onRenderItem),this.listenTo(this,"childview:before:destroy",this.onBeforeDestroyItem)},"onRenderItem":function(e){if(e.model instanceof s){var i=e.model.get("version_number_name");t(e.$(".csui-type-icon").get(0)).append("<span title='"+i+"' class='list-item-version'>"+i+"</span>")
}else this.options&&this.options.isThumbnailView||this.options.originatingView&&this.options.originatingView.thumbnailView?(this.$el.addClass("csui-metadata-navigation-thumbnail"),e.model.attributes.image_url=e.model.get("csuiThumbnailImageUrl")):this.$el.find(".csui-metadata-navigation-thumbnail").removeClass("csui-metadata-navigation-thumbnail"),e._nodeIconView=new a({"el":e.$(".csui-type-icon").get(0),"node":e.model}),e._nodeIconView.render();var n=this.options.data&&!0===this.options.data.show_required,o=e.model&&e.model.options&&!0===e.model.options.enforcedRequiredAttrs;if(n&&o){var l=e.$(".list-item-title").get(0);if(l){var d,c;!0===e.model.validated?(d="cs-icon-required category_required_done",c=r.requiredPassedTooltip):(d="cs-icon-required category_required",c=r.requiredTooltip),t(l).before("<span class='"+d+"' aria-label='"+c+"' title='"+c+"'></span>")}}},"onBeforeDestroyItem":function(e){e._nodeIconView&&e._nodeIconView.destroy()}})}),csui.define("hbs!csui/widgets/metadata/impl/common/metadata.action.multiple.items",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="metadata-wrapper binf-col-md-12">\r\n  <div class="metadata-navigation">\r\n    <div class="metadata-sidebar"></div>\r\n    <div class="metadata-content"></div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_common_metadata.action.multiple.items",n),n}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette"],function(e,t,i,n){"use strict";return n.Behavior.extend({"constructor":function(t,o){n.Behavior.prototype.constructor.apply(this,arguments),e.extend(o,{"onBeforeShow":function(){this._showChildViews()},"onShow":function(){this._showScrollPosition()},"onBeforeDestroy":function(){this.mdv&&this.mdv.internal&&this.mdv.destroy(),this.mdn&&this.mdn.destroy()},"_showChildViews":function(){this.navigationRegion.show(this.mdn),this.contentRegion.show(this.mdv)},"_showScrollPosition":function(){if(this.initiallySelected instanceof i.Model){var e=this.mdn.collection.findIndex({"id":this.initiallySelected.get("id")});return(e<0||e>this.mdn.collection.length-1)&&(e=0),this.mdn.setSelectedIndex(e)}if(this.initiallySelected&&this.initiallySelected.length>0){var t=this.initiallySelected.models[0],n=this.mdn.collection.indexOf(t);-1===n&&(n=this.mdn.collection.findIndex({"id":t.get("id")})),this.mdn.setSelectedIndex(n)}else this.mdn.collection.models.length>0&&this.mdn.setSelectedIndex(0)}})}})}),csui.define("css!csui/widgets/metadata/impl/common/metadata.action.multiple.items",[],function(){}),csui.define("csui/widgets/metadata/impl/common/metadata.action.multiple.items.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/impl/metadata.navigation.list.view","csui/widgets/metadata/metadata.action.one.item.properties.view","hbs!csui/widgets/metadata/impl/common/metadata.action.multiple.items","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/widgets/metadata/impl/metadata.navigation.list.behavior","csui/lib/jsonpath","css!csui/widgets/metadata/impl/common/metadata.action.multiple.items"],function(e,t,i,n,o,a,s,r,l){var d=i.LayoutView.extend({"className":"cs-metadata-add-items","template":a,"regions":{"navigationRegion":".metadata-sidebar","contentRegion":".metadata-content"},"behaviors":{"MetadataNavigationListBehavior":{"behaviorClass":r}},"constructor":function(e){e||(e={}),this.options=e,i.LayoutView.prototype.constructor.apply(this,arguments),this.collection=e.collection,this.container=e.container,this.context=e.context,this.originatingView=e.originatingView,this.initiallySelected=this.options.selected,this.commonCategories=e.commonCategories,this.initialFormData=e.initialFormData,this.requiredFields=[];var t=this._getInitiallySelectedModel();e.applyFlag&&t.set("applyFlag",e.applyFlag),this.mdv=new o({"model":t,"container":this.container,"context":this.context,"commands":e.commands,"originatingView":this.originatingView,"action":e.action,"inheritance":e.inheritance}),this.mdv.internal=!0,this._subscribeToMetadataViewEvents(),this.mdn=new n({"collection":e.collection,"data":{"back_button":!1,"title":"","show_required":!0}}),e.applyFlag&&this.setInitialCategories(),this.listenTo(this.mdn,"click:item",this.onClickItem),this.listenTo(this.mdn,"click:back",this.onClickBack),this.listenTo(this.mdn,"show:node",function(e){this._showNode(e.model)}),this.propagateEventsToRegions()},"_getInitiallySelectedModel":function(){return this.initiallySelected&&this.initiallySelected.length>0?this.initiallySelected.models[0]:this.collection&&this.collection.length>0?this.collection.models[0]:null},"onClickItem":function(e){this.validateAndSetValuesToNode()?this._showNode(e.model):e.cancelClick=!0},"setInitialCategories":function(){var t=this;e.each(this.mdn.collection.models,function(i){var n={};void 0!==i.get("data")||144!==i.get("type")&&void 0!==i.get("type")?(0===i.get("type")||i.get("container"))&&(n.name=i.get("newName")||i.get("name"),n.type=i.get("type")||0,n.container=i.get("container")||!0,n.parent_id=this.mdv.options.container.get("id"),e.extend(n,JSON.parse(JSON.stringify(t.commonCategories)))):(n.advanced_versioning=!1,n.name=i.get("newName")||i.get("name"),n.mime_type=i.get("mime_type"),n.type=i.get("type")||144,n.parent_id=this.mdv.options.container.get("id"),e.extend(n,JSON.parse(JSON.stringify(t.commonCategories)))),i.set("data",n)},this)},"getRequiredFields":function(){var t={},i=this;i.requiredFields=[],this.initialFormData&&this.initialFormData.models&&e.each(this.initialFormData.models,function(n,o){var a,s=n.get("data"),r=n.get("role_name"),d=n.get("options"),c=n.get("schema");if(s&&r&&(a=t.roles||(t.roles={}),a[r]||(a[r]={}),"categories"===r)){var u=l(c,"$..[?(@.required===true)]",{"resultType":"PATH"}),h=l(d,"$..[?(@.validate===false)]",{"resultType":"PATH"}),m=[];e.each(h,function(e){var t=e.toString().match(/(\'[\w]*\')/g);t&&m.push(t[t.length-1].replace(/'/g,""))});var p=[];e.each(u,function(e){var t=e.toString().match(/(\'[\w]*\')/g);t&&p.push(t[t.length-1].replace(/'/g,""))}),p=p.filter(function(e){return-1===m.indexOf(e)}),p.length>0&&i.requiredFields.push(p)}})},"validateAndSetValuesToAllNode":function(){var t=this,i=!0,n=!0;return this.getRequiredFields(),e.each(this.mdn.collection.models,e.bind(function(o){var a=o.get("data");e.each(a.roles.categories,function(e){i=i&&t._checkForAlpacaRequiredFields(o,e)}),o.validated=i,n=n&&i},this)),n},"_checkForAlpacaRequiredFields":function(t,i){var n=!0,o=[];if(this.requiredFields){var a=!1;e.each(this.requiredFields,function(t){if(o=l(i,"$.."+t.toString(),{"resultType":"PATH"}.toArray),e.each(o,function(t){var i=function(t){if(t instanceof Array&&(null!==t||""!==t))e.each(t,function(e){i(e)});else if(null===t||""===t)return void(a=!0)};if(a)return void(n=!1);i(t)}),a)return void(n=!1)})}return n},"validateAndSetValuesToNode":function(){var t=this.mdn.getSelectedItem();if(this.mdv.validate()){var i=this.mdv.getValues();return t.model.newCategories.models.length>0&&e.each(t.model.newCategories.models,function(t){var n=t.get("id"),o=t.get("role_name"),a={};i&&i.roles&&i.roles[o]&&(a=i.roles[o]),!1===e.isEmpty(a[n])&&e.each(t.attributes.data,function(i,o){e.has(a[n],o)&&(t.attributes.data[o]=a[n][o])})}),t.model.validated=!0,t.model.set("data",i),!0}return this.mdv.metadataPropertiesView.allFormsRendered&&(t.model.validated=!1,t.model.trigger("change",t.model)),!1},"onClickBack":function(){this.trigger("metadata:close",{"sender":this})},"onItemNameChanged":function(e){var t=this.mdn.getSelectedItem(),i=this.mdn.getSelectedIndex();t.render(),this.mdn.setSelectedIndex(i)},"_showNode":function(e){this.mdv&&this.mdv.internal&&this.mdv.destroy(),e.set("applyFlag",this.options.applyFlag),this.mdv=new o({"model":e,"container":this.container,"context":this.context,"originatingView":this.originatingView,"action":this.options.action,"inheritance":this.options.inheritance}),this.mdv.internal=!0,this._subscribeToMetadataViewEvents(),this.contentRegion.show(this.mdv)},"_subscribeToMetadataViewEvents":function(){this.listenTo(this.mdv,"metadata:close",e.bind(function(){this.trigger("metadata:close",{"sender":this})},this)),this.listenTo(this.mdv,"item:name:changed",e.bind(this.onItemNameChanged,this))}});return e.extend(d.prototype,s),d}),csui.define("csui/widgets/metadata/impl/add.items/metadata.add.multiple.items.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/node/node.model","csui/controls/dialog/dialog.view","csui/widgets/metadata/impl/common/metadata.action.multiple.items.view","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","css!csui/widgets/metadata/impl/metadata","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,a,s,r){function l(){}return e.extend(l.prototype,t.prototype,{"displayForm":function(t,i){var n=!1,s=this._getCommonCategories(i);i.initialFormData&&i.initialFormData.models&&i.initialFormData.models.length>1&&(n=!0),this.metadataAddItems=new o({"container":i.container,"collection":t.nodes,"selected":t.nodes,"action":"create","originatingView":i.originatingView,"context":i.context,"commands":r,"commonCategories":s,"applyFlag":n,"initialFormData":i.initialFormData}),this.listenTo(this.metadataAddItems,"metadata:add",e.bind(function(){this.deferred.resolve()},this));var l={};l.originatingView=i.originatingView,l.view=this.metadataAddItems;var d={};return d.dialogTitle=i.dialogTitle?i.dialogTitle:a.addItemsMetadataDialogTitle,d.OkButtonTitle=i.addButtonTitle?i.addButtonTitle:a.addDocumentMetadataDialogAddButtonTitle,d.OkButtonClick=this._addItems,l.dialogOptions=d,this.baseDisplayForm(l)},"_getCommonCategories":function(t){var i={};return t.initialFormData&&t.initialFormData.models&&e.each(t.initialFormData.models,function(t,n){var o,a,s,r=t.get("data"),l=t.get("role_name");t.get("options"),t.get("schema");if(r&&l&&(o=i.roles||(i.roles={}),a=o[l]||(o[l]={}),"categories"===l)){var d=t.get("id").toString();s=a[d]||(a[d]={}),e.isEmpty(r)?s=null:(r=JSON.parse(JSON.stringify(r).replace(/null/g,'""')),e.extend(s,r))}}),i},"_addItems":function(t){if(t.view.mdv&&t.view.mdv.metadataPropertiesView&&t.view.mdv.metadataPropertiesView.allFormsRendered){if(this.metadataAddItems.validateAndSetValuesToNode()){this.options.view.$el.find(".cs-formfield-invalid").removeClass("cs-formfield-invalid");var i=!0;if(this.metadataAddItems.validateAndSetValuesToAllNode(),this.metadataAddItems.collection.forEach(function(e){i=i&&!!e.validated}),i)this.metadataAddItems.collection.forEach(function(t){console.log(t);var i=t.get("data"),n=t.get("itemObject")||t.get("fileObject"),o=t.get("extended_data");if(i&&n){var a={};n.set("newName",i.name),void 0!==i.description&&(a.description=i.description),void 0!==i.advanced_versioning&&(a.advanced_versioning=i.advanced_versioning),i.roles&&(a.roles=e.deepClone(i.roles)),!1===e.isEmpty(a)&&e.extend(o,a)}}),this.dialog.destroy(),this.deferred.resolve();else{var n=a.defaultDialogTitle,o=a.missingRequiredMetadataForObjects;s.showError(o,n)}}else this.options.view.$el.find(".binf-has-error .cs-formfield").addClass("cs-formfield-invalid")}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/impl/add.items/metadata.add.item.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/metadata.add.item.controller","csui/widgets/metadata/impl/metadata.utils","csui/widgets/metadata/impl/add.items/metadata.add.multiple.items.controller","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,a,s,r,l){"use strict";function d(){}return e.extend(d.prototype,i.Events,{"addItemsRequiredMetadata":function(i,n){if(!0!==n.openMetadata&&"original"===n.inheritance)return t.Deferred().resolve();var o=t.Deferred(),a=e.find(i,function(e){return void 0===e.get("newVersion")})||i[0],r=i.length>0?i[0].get("name"):"temp_name",l={"action":"create","name":r,"items":i,"container":n.container,"context":n.container.context,"collection":n.collection,"docParentId":i.length>0?a.get("id"):null,"addableType":144},d=new s,c=t.grep(i,function(e){return void 0===e.get("newVersion")});return d.ContainerHasEnforcedEmptyRequiredMetadata(l).done(e.bind(function(e){if(!0===e.hasRequiredMetadata){var a=t.Deferred();c&&1===c.length?a=this._addOneItemWithRequiredMetadata(c,n):c&&c.length>1?(e.initialFormData&&(n.initialFormData=e.initialFormData),a=this._addMultipleItemsWithRequiredMetadata(c,n)):i.length?o.resolve():o.reject(),a.done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})}else o.resolve({})},this)).fail(function(e){o.reject(e)}),o.promise()},"_addOneItemWithRequiredMetadata":function(i,n){var o=t.Deferred(),a=this._makeNodeCollectionFromItems(i,n),s={"nodes":a,"container":n.container,"context":n.context};return n=n||{},e.extend(n,{"callerProcessData":!0,"cancelButtonActionToken":"cancelAddOneItemWithRequiredMetadata","dialogTitle":a.models[0].get("fileObject")?l.addDocumentMetadataDialogTitle:l.addFolderMetadataDialogTitle,"addButtonTitle":l.addItemMetadataDialogButtonUploadTitle}),this.displayForm(s,n).done(function(t){if(n.callerProcessData){var s=a.models[0],r=s.get("itemObject")||s.get("fileObject");if(r.set("newName",t.data.name),r){var l={};r.set("newName",t.data.name),void 0!==t.data.description&&(l.description=t.data.description),void 0!==t.data.advanced_versioning&&(l.advanced_versioning=t.data.advanced_versioning),t.data.roles&&(l.roles=e.deepClone(t.data.roles)),!1===e.isEmpty(l)&&r.set("extended_data",l)}o.resolve(i)}else o.resolve.apply(o,arguments)}).fail(function(){o.reject.apply(o,arguments)}),o.promise()},"_addMultipleItemsWithRequiredMetadata":function(i,n){i=this._makeNodeCollectionFromItems(i,n);for(var o=0,a=0,s=i.length,d={"nodes":i},c=t.Deferred(),u=0;u<s;u++)i.models[u].get("fileObject")?a++:o++;return e.extend(n,{"dialogTitle":a===s?l.addDocumentsMetadataDialogTitle:o===s?l.addFoldersMetadataDialogTitle:l.addItemsMetadataDialogTitle,"addButtonTitle":l.addItemMetadataDialogButtonUploadTitle}),(new r).displayForm(d,n).done(function(e){c.resolve(i)}).fail(function(){c.reject()}),c.promise()},"_makeNodeCollectionFromItems":function(t,i){var a,s=new n;return t&&t.length>0&&e.each(t,function(t){var n=t.get("file");a=n?new o({"name":t.get("newName")||n.name,"type":t.get("type")||144,"size":n.size,"mime_type":n.type,"fileObject":t,"parent_id":i.container.get("id"),"extended_data":t.get("extended_data")},{"connector":i.container.connector}):new o({"container":!0,"name":t.get("newName")||t.get("name"),"type":t.get("type")||t.get("subType"),"type_name":t.get("type_name")||"Folder","itemObject":t,"parent_id":i.container.get("id"),"extended_data":t.get("extended_data"),"enforcedRequiredAttrsForFolders":t.get("enforcedRequiredAttrsForFolders")},{"connector":i.container.connector}),e.extend(a.options,{"enforcedRequiredAttrs":!0}),s.add(a,{"silent":!0})},this),s},"displayForm":function(e,t){return(new a).displayForm(e,t)}}),d.prototype.get=i.Model.prototype.get,e.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/impl/add.items/metadata.add.multiple.docs.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/node/node.model","csui/controls/dialog/dialog.view","csui/widgets/metadata/impl/common/metadata.action.multiple.items.view","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","css!csui/widgets/metadata/impl/metadata","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,a,s,r){function l(){}return e.extend(l.prototype,t.prototype,{"displayForm":function(t,i){var n=!1,s=this._getCommonCategories(i);i.initialFormData&&i.initialFormData.models&&i.initialFormData.models.length>1&&(n=!0),this.metadataAddItems=new o({"container":i.container,"collection":t.nodes,"selected":t.nodes,"action":"create","originatingView":i.originatingView,"context":i.context,"commands":r,"commonCategories":s,"applyFlag":n,"initialFormData":i.initialFormData}),this.listenTo(this.metadataAddItems,"metadata:add",e.bind(function(){this.deferred.resolve()},this));var l={};l.originatingView=i.originatingView,l.view=this.metadataAddItems;var d={};return d.dialogTitle=i.dialogTitle?i.dialogTitle:a.addDocumentMetadataDialogTitle,d.OkButtonTitle=i.addButtonTitle?i.addButtonTitle:a.addDocumentMetadataDialogAddButtonTitle,d.OkButtonClick=this._addItems,l.dialogOptions=d,this.baseDisplayForm(l)},"_getCommonCategories":function(t){var i={};return t.initialFormData&&t.initialFormData.models&&e.each(t.initialFormData.models,function(t,n){var o,a,s,r=t.get("data"),l=t.get("role_name");t.get("options"),t.get("schema");if(r&&l&&(o=i.roles||(i.roles={}),a=o[l]||(o[l]={}),"categories"===l)){var d=t.get("id").toString();s=a[d]||(a[d]={}),e.isEmpty(r)?s=null:(r=JSON.parse(JSON.stringify(r).replace(/null/g,'""')),e.extend(s,r))}}),i},"_addItems":function(t){if(t.view.mdv&&t.view.mdv.metadataPropertiesView&&t.view.mdv.metadataPropertiesView.allFormsRendered){if(this.metadataAddItems.validateAndSetValuesToNode()){this.options.view.$el.find(".cs-formfield-invalid").removeClass("cs-formfield-invalid");var i=!0;if(this.metadataAddItems.validateAndSetValuesToAllNode(),this.metadataAddItems.collection.forEach(function(e){i=i&&!!e.validated}),i)this.metadataAddItems.collection.forEach(function(t){var i=t.get("data"),n=t.get("fileObject"),o=t.get("extended_data");if(i&&n){n.set("newName",i.name);var a={};void 0!==i.description&&(a.description=i.description),void 0!==i.advanced_versioning&&(a.advanced_versioning=i.advanced_versioning),i.roles&&(a.roles=e.deepClone(i.roles)),!1===e.isEmpty(a)&&e.extend(o,a)}}),this.dialog.destroy(),this.deferred.resolve();else{var n=a.addDocumentMetadataDialogTitle,o=a.missingRequiredMetadataForDocuments;s.showError(o,n)}}else this.options.view.$el.find(".binf-has-error .cs-formfield").addClass("cs-formfield-invalid")}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/metadata.add.document.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/impl/add.items/metadata.add.item.controller","csui/widgets/metadata/impl/metadata.utils","csui/widgets/metadata/impl/add.items/metadata.add.multiple.docs.controller","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,a,s,r,l){"use strict";function d(){}return e.extend(d.prototype,i.Events,{"addItemsRequiredMetadata":function(i,n){if(!0!==n.openMetadata&&"original"===n.inheritance)return t.Deferred().resolve();var o=t.Deferred(),a=i.models,r=e.find(i.models,function(e){return void 0===e.get("newVersion")})||a[0],l=a.length>0?r.get("file").name:"temp_name",d={"action":"create","addableType":n.addableType,"name":l,"container":n.container,"docParentId":a.length>0?r.get("id"):null},c=new s,u=t.grep(i.models,function(e){return void 0===e.get("newVersion")});return c.ContainerHasEnforcedEmptyRequiredMetadata(d).done(e.bind(function(e){if(!0===e.hasRequiredMetadata){var a=t.Deferred();u&&1===u.length?a=this._addOneItemWithRequiredMetadata(u,n):u&&u.length>1?(e.initialFormData&&(n.initialFormData=e.initialFormData),a=this._addMultipleItemsWithRequiredMetadata(u,n)):i.length?o.resolve():o.reject(),a.done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})}else o.resolve({})},this)).fail(function(e){o.reject(e)}),o.promise()},"_makeNodeCollectionFromItems":function(t,i){var a=new n;return t&&t.length>0&&e.each(t,function(t){var n=t.get("file"),s=new o({"name":t.get("newName")||n.name,"type":t.get("type")||144,"size":n.size,"mime_type":n.type,"fileObject":t,"parent_id":i.container.get("id"),"extended_data":t.get("extended_data")},{"connector":i.container.connector});e.extend(s.options,{"enforcedRequiredAttrs":!0}),a.add(s,{"silent":!0})},this),a},"_addOneItemWithRequiredMetadata":function(i,n){var o=t.Deferred(),s=this._makeNodeCollectionFromItems(i,n),r={"nodes":s,"container":n.container,"context":n.context},d={"callerProcessData":!0,"dialogTitle":l.addDocumentMetadataDialogTitle,"addButtonTitle":l.addDocumentMetadataDialogAddButtonTitle,"cancelButtonActionToken":"cancelAddOneItemWithRequiredMetadata"};return(new a).displayForm(r,d).done(function(t){var n=i[0];n.set("newName",t.data.name);var a={};void 0!==t.data.description&&(a.description=t.data.description),void 0!==t.data.advanced_versioning&&(a.advanced_versioning=t.data.advanced_versioning),t.data.roles&&(a.roles=e.deepClone(t.data.roles)),!1===e.isEmpty(a)&&n.set("extended_data",a),o.resolve()}).fail(function(e){var t,i=e&&e.error?e.error:void 0;e&&e.buttonAttributes&&("cancelAddOneItemWithRequiredMetadata"===e.buttonAttributes.actionToken?t="cancelAddOneItemWithRequiredMetadata":"closeMetadataActionView"===e.buttonAttributes.actionToken&&(t="closeMetadataActionView")),o.reject({"error":i,"userAction":t})}),o.promise()},"_addMultipleItemsWithRequiredMetadata":function(e,i){var n=t.Deferred(),o=this._makeNodeCollectionFromItems(e,i),a={"nodes":o};return(new r).displayForm(a,i).done(function(e){n.resolve()}).fail(function(){n.reject()}),n.promise()}}),d.prototype.get=i.Model.prototype.get,e.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.one.item.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/widgets/metadata/impl/metadata.controller","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/utils/commandhelper","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,a,s,r){function l(){}return e.extend(l.prototype,t.prototype,{"displayForm":function(e,t){var i=o.getAtLeastOneNode(e),s=i.length>0?i.models[0]:null;this.node=s;var l=this.metadataAddItemPropView=new n({"model":s,"container":e.container,"originatingView":t.originatingView,"context":t.context,"commands":r,"action":t.action,"inheritance":t.inheritance}),d={};d.callerProcessData=t.callerProcessData,d.originatingView=t.originatingView,d.view=l;var c={};return c.dialogTitle=t.dialogTitle?t.dialogTitle:a.defaultDialogTitle,c.OkButtonTitle=t.okButtonTitle?t.okButtonTitle:a.defaultDialogOkButtonTitle,c.OkButtonClick=this._CopyMoveItem,d.dialogOptions=c,this.baseDisplayForm(d)},"_CopyMoveItem":function(t){if(t.view.metadataPropertiesView&&t.view.metadataPropertiesView.allFormsRendered){if(this.metadataAddItemPropView.validate()){var n=this.metadataAddItemPropView.getValues();if(!0===t.callerProcessData)this.dialog.destroy(),this.deferred.resolve({"data":n});else{(new i).createItem(this.node,n).done(e.bind(function(e){this.dialog.destroy(),this.deferred.resolve({"name":n.name})},this)).fail(function(e){var t=a.failedToCreateItem;e&&(e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:e.responseText&&(t=e.responseText),s.showError(t))})}}}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.multiple.items.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/node/node.model","csui/controls/dialog/dialog.view","csui/widgets/metadata/impl/common/metadata.action.multiple.items.view","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","css!csui/widgets/metadata/impl/metadata","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,a,s){function r(){}return e.extend(r.prototype,t.prototype,{"displayForm":function(t,i){this.metadataAddItems=new o({"container":i.container,"collection":t.nodes,"selected":t.nodes,"originatingView":i.originatingView,"context":i.context,"action":i.action,"inheritance":i.inheritance}),this.listenTo(this.metadataAddItems,"metadata:add",e.bind(function(){this.deferred.resolve()},this));var n={};n.originatingView=i.originatingView,n.view=this.metadataAddItems;var s={};return s.dialogTitle=i.dialogTitle?i.dialogTitle:a.defaultDialogTitle,s.OkButtonTitle=i.okButtonTitle?i.okButtonTitle:a.defaultDialogOkButtonTitle,s.OkButtonClick=this._CopyMoveItems,n.dialogOptions=s,this.baseDisplayForm(n)},"_CopyMoveItems":function(t){if(t.view.mdv&&t.view.mdv.metadataPropertiesView&&t.view.mdv.metadataPropertiesView.allFormsRendered){if(this.metadataAddItems.validateAndSetValuesToNode()){var i=!0;if(this.metadataAddItems.collection.forEach(function(e){var t=!0!==e.options.enforcedRequiredAttrs||!!e.validated;i=i&&t}),i)this.metadataAddItems.collection.forEach(function(t){var i=t.get("data"),n=t.get("itemObject");if(i&&n){n.newName=i.name;var o={};void 0!==i.description&&(o.description=i.description),void 0!==i.advanced_versioning&&(o.advanced_versioning=i.advanced_versioning),i.roles&&(o.roles=e.deepClone(i.roles)),!1===e.isEmpty(o)&&(n.extended_data=o)}}),this.dialog.destroy(),this.deferred.resolve();else{var n=a.defaultDialogTitle,o=a.missingRequiredMetadataForObjects;s.showError(o,n)}}}}}),e.extend(r,{"version":"1.0"}),r}),csui.define("csui/widgets/metadata/metadata.copy.move.items.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/impl/metadata.utils","csui/models/actions","csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.one.item.controller","csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.multiple.items.controller","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,a,s,r,l,d){function c(){}return e.extend(c.prototype,i.Events,{"CopyMoveItemsWithMetadata":function(t,i){return this.CopyMoveItemsRequiredMetadata(t,e.extend(i,{"openMetadata":!0}))},"_copyMoveItemsWithMetadata":function(e,i){var n=t.Deferred(),o=t.Deferred();return e&&e.length>0&&(i.id||(i.id=e[0].id),i.container||(i.container=i.targetFolder)),e&&1===e.length?o=this._copyMoveOneItemWithRequiredMetadata(e,i):e&&e.length>1?o=this._copyMoveMultipleItemsWithRequiredMetadata(e,i):n.reject(),o.done(function(e){n.resolve()}).fail(function(e){n.reject(e)}),n.promise()},"CopyMoveItemsRequiredMetadata":function(i,n){if(!i||i.length<1)return t.Deferred().reject();if(!0!==n.openMetadata&&"original"===n.inheritance)return t.Deferred().resolve();if(!0!==n.openMetadata&&i.length>1&&"merged"===n.inheritance)return t.Deferred().resolve();var o=t.Deferred(),s={"action":n.action,"inheritance":n.inheritance,"items":i,"container":n.targetFolder,"context":n.context};return(new a).ContainerHasEnforcedEmptyRequiredMetadataOnNodes(s).done(e.bind(function(t){t.requiredMetadata&&t.enforcedItems&&t.enforcedItems.length>0||!0===n.openMetadata?(t.requiredMetadata&&(s=e.extend(s,{"enforcedItems":t.enforcedItems})),this._copyMoveItemsWithMetadata(i,s).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})):o.resolve()},this)).fail(function(e){o.reject(e)}),o.promise()},"_makeNodeCollectionFromItems":function(t,i){var a=new n;return t&&t.length>0&&e.each(t,function(t){var n=void 0!==e.find(i.enforcedItems,function(e){return e.id===t.id}),r=new o({"id":t.id,"name":t.newName||t.name,"container":t.container,"mime_type":t.mime_type,"original_id":t.original_id,"type":t.type,"type_name":t.type_name,"action":i.action,"inheritance":i.inheritance,"itemObject":t,"size":t.size,"size_formatted":144===t.type||749===t.type||736===t.type||30309===t.type?t.size_formatted:void 0},{"connector":i.container.connector});140===t.type&&(r.attributes.url=t.url),e.extend(r.options,{"original":t.original,"enforcedRequiredAttrs":n}),r.original=t.original||r.original,r.actions=t.actions||new s,a.add(r,{"silent":!0})},this),a},"_copyMoveOneItemWithRequiredMetadata":function(i,n){var o,a,s=t.Deferred(),l=this._makeNodeCollectionFromItems(i,n),c={"nodes":l,"container":n.container};"copy"===n.action?(o=d.copyOneItemMetadataDialogTitle,a=d.copyItemsMetadataDialogButtonTitle):"move"===n.action&&(o=d.moveOneItemMetadataDialogTitle,a=d.moveItemsMetadataDialogButtonTitle),o=this._extendDialogTitle(o,n.inheritance);var u={"callerProcessData":!0,"action":n.action,"context":n.context,"inheritance":n.inheritance,"originatingView":n.originatingView,"dialogTitle":o,"okButtonTitle":a};return(new r).displayForm(c,u).done(function(t){i[0].newName=t.data.name;var n={};void 0!==t.data.description&&(n.description=t.data.description),void 0!==t.data.advanced_versioning&&(n.advanced_versioning=t.data.advanced_versioning),t.data.roles&&(n.roles=e.deepClone(t.data.roles)),!1===e.isEmpty(n)&&(i[0].extended_data=n),s.resolve()}).fail(function(e){s.reject(e)}),s.promise()},"_copyMoveMultipleItemsWithRequiredMetadata":function(i,n){var o,a,s=t.Deferred();"copy"===n.action?(o=e.str.sformat(d.copyMultipleItemsMetadataDialogTitle,i.length),a=d.copyItemsMetadataDialogButtonTitle):"move"===n.action&&(o=e.str.sformat(d.moveMultipleItemsMetadataDialogTitle,i.length),a=d.moveItemsMetadataDialogButtonTitle),o=this._extendDialogTitle(o,n.inheritance);var r=this._makeNodeCollectionFromItems(i,n),c={"nodes":r},u={"action":n.action,"inheritance":n.inheritance,"container":n.container,"context":n.context,"originatingView":n.originatingView,"dialogTitle":o,"okButtonTitle":a};return(new l).displayForm(c,u).done(function(e){s.resolve()}).fail(function(e){s.reject(e)}),s.promise()},"_extendDialogTitle":function(e,t){var i=e;return"original"===t?i=e+" "+d.inheritanceOriginalProperties:"destination"===t?i=e+" "+d.inheritanceDestinationProperties:"merged"===t&&(i=e+" "+d.inheritanceMergedProperties),i}}),c.prototype.get=i.Model.prototype.get,e.extend(c,{"version":"1.0"}),c}),csui.define("hbs!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="metadata-wrapper binf-col-md-12">\r\n  <div class="metadata-navigation">\r\n    <div class="metadata-sidebar"></div>\r\n    <div class="metadata-content"></div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_metadatanavigation_impl_metadatanavigation",n),n}),csui.define("csui/widgets/metadata/impl/metadatanavigation/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata/impl/metadatanavigation/impl/nls/root/lang",{"dialogTitle":"Favorites","searchPlaceholder":"Search Favorites","versionsTitle":"Versions"}),csui.define("css!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation",[],function(){}),csui.define("csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/widgets/metadata/impl/metadata.navigation.list.behavior","csui/widgets/metadata/impl/metadata.navigation.list.view","csui/widgets/metadata/metadata.view","csui/controls/progressblocker/blocker","hbs!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/mixins/view.state/metadata.view.state.mixin","csui/utils/contexts/factories/next.node","i18n!csui/widgets/metadata/impl/metadatanavigation/impl/nls/lang","css!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation"],function(e,t,i,n,o,a,s,r,l,d,c,u,h){"use strict";var m=i.LayoutView.extend({"className":"cs-metadata","template":l,"regions":{"navigationRegion":".metadata-sidebar","contentRegion":".metadata-content"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":n,"initialActivationWeight":100},
"MetadataNavigationListBehavior":{"behaviorClass":o}},"constructor":function(t){t||(t={}),r.imbue(this),i.LayoutView.prototype.constructor.apply(this,arguments),this._addUrlParametersSupport(t.context),this.collection=t.collection,this.container=t.container,this.containerCollection=t.containerCollection,this.context=t.context,this.originatingView=t.originatingView,this.showCloseIcon=t.showCloseIcon,this.initiallySelected=this.options.selected,this.selectedTab=t.selectedTab||this.getViewStateDropdown(),this.selectedProperty=t.selectedProperty||this.getViewStateSelectedProperty(),this.isThumbnailView=t.isThumbnailView||this.getThumbnailViewState(),this.showPermissionView=t.showPermissionView,this.thumbnailViewState=t.originatingView&&t.originatingView.thumbnailViewState,this.collection.inMetadataNavigationView=t.originatingView&&t.originatingView.isTabularView,this.disableViewState=t.disableViewState,!this.options.toolbarItems&&this.originatingView&&this.originatingView.options&&this.originatingView.options.toolbarItems&&(this.options.toolbarItems=this.originatingView.options.toolbarItems);var n=this._getInitiallySelectedModel();this.mdv=this.options.data&&this.options.data.contentView?this.options.data.contentView:new s({"model":n,"container":this.container,"containerCollection":this.containerCollection,"collection":this.collection,"context":this.context,"originatingView":this,"metadataNavigationView":this,"isExpandedView":!!this.options.isExpandedView,"showCloseIcon":void 0!==this.showCloseIcon&&this.showCloseIcon,"selectedTab":this.selectedTab,"selectedProperty":this.selectedProperty,"showPermissionView":this.showPermissionView,"disableViewState":this.options.disableViewState}),this.options.data&&this.options.data.contentView||(this.mdv.internal=!0),this._subscribeToMetadataViewEvents(),this.mdn=new a({"collection":t.collection,"containerCollection":this.containerCollection,"data":{"back_button":!(!this.originatingView&&!this.containerCollection),"title":this._getBackButtonTitle(t),"nameAttribute":t.nameAttribute},"originatingView":t.originatingView,"isThumbnailView":this.isThumbnailView}),this.listenTo(this.mdn,"click:item",this.onClickItem),this.listenTo(this.mdn,"click:back",this.onClickBack),this.listenTo(this.mdn,"show:node",function(e){this._showNode(e.model)}),this.listenTo(this.mdv,"disable:active:item",function(e){this.mdn.$el.find(".binf-active").addClass("active-item-disable")}).listenTo(this.mdv,"enable:active:item",function(){this.mdn.$el.find(".active-item-disable").removeClass("active-item-disable")}),!this.options.originatingView||e.isFunction(this.options.originatingView.cascadeDestroy)&&!this.options.originatingView.cascadeDestroy()||this.listenTo(this.options.originatingView,"before:destroy",function(){this._closeMetadata()}),this.propagateEventsToRegions(),this.showPermissionView&&(this.disableViewState=!0),this._isViewStateModelEnabled()&&this.listenTo(this.model,"change:id",this._modelIdChanged)},"_getBackButtonTitle":function(e){var t=e.container?e.container.get("name"):"";if(!t&&e.collection.length>0&&e.collection.models[0].collection.title&&(t=e.collection.models[0].collection.title),"NodeVersionCollection"===Object.getPrototypeOf(e.collection).constructor.name&&(t=h.versionsTitle),!t){var i=e.context&&e.context.viewStateModel;if(i){var n=i.get("metadata_container");n&&(t=n.name)}}return t},"_isViewStateModelEnabled":function(){var e=this.context&&this.context.viewStateModel;return!this.disableViewState&&e&&e.get("enabled")},"_getInitiallySelectedModel":function(){if(this.initiallySelected instanceof t.Model){var e=this.collection.findIndex({"id":this.initiallySelected.get("id")});return e<0||e>this.collection.length-1?null:this.collection.at(e)}return this.initiallySelected&&this.initiallySelected.length>0?this.initiallySelected.models[0]:this.collection&&this.collection.length>0?this.collection.models[0]:null},"onClickItem":function(e){this._isViewStateModelEnabled()&&this.getViewStateId()!==e.model.get("id")?this.setViewStateId(e.model.get("id"),{"model":e.model}):this._showNode(e.model)},"onClickBack":function(){this._closeMetadata()},"onItemNameChanged":function(e){var t=this.mdn.getSelectedItem(),i=this.mdn.getSelectedIndex();t.render(),this.mdn.setSelectedIndex(i)},"_moveToNextItemAfterDeleteOrMove":function(){if(0===this.mdn.collection.length)this._closeMetadata();else{var e=this.indexOfItemDeleteOrMove;e===this.mdn.collection.length&&e--,this.mdn.selectAt(e)}},"onItemBeforeDelete":function(e){this.indexOfItemDeleteOrMove=this.mdn.getSelectedIndex()},"onItemDeleted":function(e){this._moveToNextItemAfterDeleteOrMove()},"onItemBeforeMove":function(t){this.indexOfItemDeleteOrMove=this.mdn.getSelectedIndex(),this.listenToOnce(this.containerCollection,"remove",e.bind(this.onItemMoved,this))},"onItemMoved":function(e){this.mdn.collection.remove(e),this._moveToNextItemAfterDeleteOrMove()},"_showNode":function(e){var t=this.getViewStateDropdown()||(this.mdv.metadataTabView.tabLinks?this.mdv.metadataTabView.tabLinks.selected:this.mdv.options.selectedTab?this.mdv.options.selectedTab:""),i=this.mdv.metadataTabView.options.activeTab?this.mdv.metadataTabView.options.activeTab:this.mdv.options.activeTab?this.mdv.options.activeTab:"";this.mdv&&this.mdv.internal&&this.mdv.destroy(),this.mdv=new s({"model":e,"container":this.container,"containerCollection":this.containerCollection,"collection":this.collection,"context":this.context,"originatingView":this,"metadataNavigationView":this,"showCloseIcon":void 0!==this.showCloseIcon&&this.showCloseIcon,"activeTab":i,"selectedTab":t,"showPermissionView":this.showPermissionView}),this.mdv.internal=!0,this._subscribeToMetadataViewEvents(),this.contentRegion.show(this.mdv)},"_modelIdChanged":function(){var e=this.model.get("id");e&&this.setSelectedElementByModelId(e)},"setSelectedElementByModelId":function(e){var t=this.getItemByModelId(e);t&&(this.mdn.setSelectedElement(t),this._showNode(t.model))},"getItemByModelId":function(e){var t;return this.mdn.children.some(function(i){if(i.model.get("id")===e)return t=i,!0}),t},"onMetadataClose":function(){this._closeMetadata()},"onDestroy":function(){this.thumbnailViewState&&this.originatingView.thumbnail&&this.originatingView.thumbnail.resultsView.triggerMethod("metadata:close")},"_closeMetadata":function(){if(this.trigger("metadata:close",{"sender":this}),!this.originatingView)if(this._isViewStateModelEnabled()&&!this.showPermissionView)this.context.viewStateModel.restoreLastRouter();else{var e=this._getCommonContainerId();e&&this._setNextNodeModelFactory(e)}},"_getCommonContainerId":function(){var e;return this.containerCollection&&(this.containerCollection.node?e=this.containerCollection.node.get("id"):this.containerCollection.models.length>0&&(e=this.containerCollection.models[0].get("parent_id"),this.containerCollection.models.some(function(t){if(t.get("parent_id")!==e)return e=void 0,!0}))),e},"_setNextNodeModelFactory":function(e){if(this.context&&void 0!==e){var t=this.context.getModel(u);t&&(t.get("id")===e&&t.unset("id",{"silent":!0}),t.set("id",e))}},"_subscribeToMetadataViewEvents":function(){this.listenTo(this.mdv,"metadata:close",e.bind(function(){this._closeMetadata()},this)),this.listenTo(this.mdv,"metadata:close:without:animation",e.bind(function(){this.trigger("metadata:close:without:animation",{"sender":this})},this)),this.listenTo(this.mdv,"item:name:changed",e.bind(this.onItemNameChanged,this)),this.listenTo(this.mdv,"metadata:item:before:delete",e.bind(function(e){this.onItemBeforeDelete(e)},this)),this.listenTo(this.mdv,"metadata:item:deleted",e.bind(function(e){this.onItemDeleted(e)},this)),this.listenTo(this.mdv,"metadata:item:before:move",e.bind(function(e){this.onItemBeforeMove(e)},this))},"_addUrlParametersSupport":function(e){var t=e&&e.viewStateModel;t&&t.addUrlParameters(["dropdown"],e)}});return e.extend(m.prototype,d),e.extend(m.prototype,c),m}),csui.define("csui/widgets/metadata.navigation/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata.navigation/impl/nls/root/lang",{"FetchNodeFailTitle":"Error","FetchNodeFailMessage":'Failed to fetch node "{0}". \n\n{1}'}),csui.define("css!csui/widgets/metadata.navigation/impl/metadata.navigation",[],function(){}),csui.define("csui/widgets/metadata.navigation/metadata.navigation.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/progressblocker/blocker","csui/utils/contexts/factories/node","csui/utils/contexts/factories/children","csui/utils/contexts/factories/children2","csui/widgets/nodestable/nodestable.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view","csui/behaviors/default.action/impl/defaultaction","csui/dialogs/modal.alert/modal.alert","csui/utils/contexts/factories/metadata.factory","csui/utils/contexts/perspective/plugins/node/node.extra.data","i18n!csui/widgets/metadata.navigation/impl/nls/lang","css!csui/widgets/metadata.navigation/impl/metadata.navigation"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p,g,f,w){"use strict";var b=e.config();c.useV2RestApi&&(l=d);var v=o.ItemView.extend({"className":"cs-metadata-navigation-wrapper","template":!1,"constructor":function(e){e=t.defaults(e,b),e.data||(e.data={}),e.showCloseIcon=!1,this.options=e,this.defaultActionController=new m,this.options.originatingView&&this.options.originatingView.supportOriginatingView&&(this.options.baseOriginatingView=this.options.originatingView,this.options.originatingView=this),o.ItemView.prototype.constructor.call(this,e),s.imbue(this)},"onRender":function(){var e=this._ensureCompleteData();if(e)return e.done(t.bind(this.render,this));this.metadataNavigationView&&this.metadataNavigationView.destroy();var i=this.metadataNavigationView=new h(this.options);this.propagateEventsToViews(this.metadataNavigationView),this.metadataNavigationView.render(),o.triggerMethodOn(i,"before:show",i,this),this.$el.append(i.el),o.triggerMethodOn(i,"show",i,this)},"onBeforeDestroy":function(){this.metadataNavigationView&&(this.cancelEventsToViewsPropagation(this.metadataNavigationView),this.metadataNavigationView.destroy())},"_ensureCompleteData":function(){var e=this.options;if(!(e.model&&e.collection&&e.containerCollection))return this._loadingDataByMetadata()},"_loadingDataByMetadata":function(){function e(){n._loadCollection().always(function(){n.unblockActions()}).done(function(e){t&&t.resolve(e)}).fail(function(e){t&&t.reject(e)})}var t,n=this,o=this.options;return o.model&&(o.collection||o.containerCollection)||(t=i.Deferred()),o.model?o.collection&&o.containerCollection||(o.selected=o.model,n.blockActions(),e()):(o.model=o.context.getModel(r,{"attributes":o.data.id&&{"id":o.data.id},"temporary":!0}),o.selected=o.model,n.blockActions(),e()),t&&t.promise()},"_loadCollection":function(){function e(){s.findWhere({"id":a.model.get("id")})||s.add(a.model,{"at":0,"silent":!0})}function t(){a.collection||(a.collection=s),a.containerCollection||(a.containerCollection=s)}var n=this,o=i.Deferred(),a=this.options,s=a.collection||a.containerCollection;if(!s){var d=a.context.getModel(g);if(d){var c=d.get("metadata_info"),u=c&&c.collection;if(u&&u.length>0)return s=u,e(),t(),delete a.context.viewStateModel.get("state").collection,o.resolve().promise()}}return s?o.resolve().promise():(a.model.ensureFetched().done(function(i){a.model.set("csuiLazyActionsRetrieved",!0,{"silent":!0}),a.model.set("csuiAddPropertiesActionsRetrieved",!0,{"silent":!0}),a.container=a.context.getModel(r,{"attributes":{"id":a.model.get("parent_id")},"temporary":!0}),a.container.ensureFetched().done(function(i){s=a.context.getCollection(l,{"options":{"node":a.container,"commands":n.defaultActionController.commands,"defaultActionCommands":n.defaultActionController.actionItems.getAllCommandSignatures(n.defaultActionController.commands),"delayRestCommands":!!a.delayRestCommands}}),s.setFields(f.getModelFields()),s.ensureFetched().done(function(i){s.forEach(function(e){e.set("csuiLazyActionsRetrieved",!0,{"silent":!0}),e.set("csuiAddPropertiesActionsRetrieved",!0,{"silent":!0})}),e(),t(),o.resolve(i)}).fail(function(e){n._showFetchNodeFailMessage(e,a.container.get("id")),o.reject(e)})}).fail(function(e){n._showFetchNodeFailMessage(e,a.container.get("id")),o.reject(e)})}).fail(function(e){n.unblockActions(),n._showFetchNodeFailMessage(e,a.model.get("id")),o&&o.reject(e)}),o.promise())},"_showFetchNodeFailMessage":function(e,i){var n=new a.Error(e),o=w.FetchNodeFailTitle,s=t.str.sformat(w.FetchNodeFailMessage,i,n.message);p.showError(s,o)}});return t.extend(v.prototype,u),v}),csui.define("csui/widgets/document.overview/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/document.overview/impl/nls/root/lang",{"ToolbarItemOpen":"Open","ToolbarItemDownload":"Download","ToolbarItemEdit":"Edit","ToolbarItemProperties":"Properties","location":"Location","docPreviewImgAlt":"Document Preview","name":"Name","description":"Description","created":"Created","createdBy":"Created by","type":"Type","modified":"Modified","ownedBy":"Owned by","size":"Size"}),csui.define("hbs!csui/widgets/document.overview/impl/document.overview",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){return'      <div class="overview-page-backbutton icon arrow_back cs-go-back csui-acc-focusable-active"\r\n           aria-label="Go back" title="Go back" role="link" tabindex="0">\r\n      </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o,a;return'<div class="cs-content-wrapper">\r\n\r\n  <div class="cs-content-header">\r\n'+(null!=(o=t.if.call(e,null!=e?e.back_button:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.noop}))?o:"")+'    <div class="title-container"></div>\r\n    <div class="actions-container">\r\n      <div class="commentRegion"></div>\r\n      <div class="favoriteRegion"></div>\r\n    </div>\r\n\r\n  </div>\r\n  <div class="cs-content-container">\r\n    <div class="description-container cs-content">\r\n      <div class="created_by_section general-information"></div>\r\n      <div class="modified_section general-information"></div>\r\n      <div class="type_section general-information"></div>\r\n      <div class="size_section general-information"></div>\r\n      <div class="reserve_info general-information"></div>\r\n      <div class="location-container general-information">\r\n        <div class="alpaca-container-item">\r\n          <div class="binf-form-group alpaca-field alpaca-field-text alpaca-optional\r\n              alpaca-readonly">\r\n            <label class="binf-control-label alpaca-control-label binf-col-sm-3">\r\n              '+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.location:o,e))+'\r\n            </label>\r\n            <div id="location" class="binf-col-sm-9 location-view">\r\n\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="description_section general-information">\r\n\r\n      </div>\r\n    </div>\r\n    <div class="binf-col-md-4 thumbnail-container binf-hidden binf-text-left cs-content">\r\n      <div class="metadata-tab">\r\n        <div class="thumbnail_section metadata-preview preview-section" title="'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemOpen:o,e))+'">\r\n          <img src="'+this.escapeExpression((a=null!=(a=t.imgSrc||(null!=e?e.imgSrc:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"imgSrc","hash":{}}):a))+'" class="img-doc-preview binf-hidden" alt="'+this.escapeExpression((a=null!=(a=t.imgAlt||(null!=e?e.imgAlt:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{"name":"imgAlt","hash":{}}):a))+'" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class="cs-top-fadeout-container"></div>\r\n  <div class="cs-fadeout-container"></div>\r\n  <div class="cs-content-footer">\r\n    <button class="binf-btn primary-btn command-btn" type="button"\r\n            data-signature="Open">'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemOpen:o,e))+'</button>\r\n    <button class="binf-btn default-btn command-btn" type="button"\r\n            data-signature="Download">'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemDownload:o,e))+'</button>\r\n    <button class="binf-btn default-btn command-btn edit-btn" type="button"\r\n            data-signature="Edit">'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemEdit:o,e))+'</button>\r\n    <button class="binf-btn default-btn command-btn" type="button"\r\n            data-signature="Properties">'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemProperties:o,e))+"</button>\r\n  </div>\r\n</div>\r\n\r\n"}});return i.registerPartial("csui_widgets_document.overview_impl_document.overview",n),n}),csui.define("css!csui/widgets/document.overview/impl/document.overview",[],function(){}),csui.define("csui/widgets/document.overview/document.overview.view",["module","csui/lib/underscore","csui/lib/marionette","csui/lib/jquery","csui/utils/log","csui/widgets/metadata/impl/header/item.name/metadata.item.name.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/controls/form/form.view","csui/utils/nodesprites","csui/controls/node-type.icon/node-type.icon.view","csui/controls/table/cells/parent/parent.view","csui/utils/contexts/factories/node","csui/utils/thumbnail/thumbnail.object","csui/widgets/metadata/general.panels/document/document.general.form.model","csui/controls/tableheader/comment/comment.button.view","csui/widgets/favorites/favorite.star.view","csui/controls/toolbar/toolbar.command.controller","csui/models/nodes","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/utils/commands","i18n!csui/widgets/document.overview/impl/nls/lang","hbs!csui/widgets/document.overview/impl/document.overview","css!csui/widgets/document.overview/impl/document.overview"],function(e,t,i,n,o,a,s,r,l,d,c,u,h,m,p,g,f,w,b,v,_,y){"use strict";o=o(e.id);var V=r.extend({"constructor":function(e){e||(e={}),e.data||(e.data={}),e.node||(e.node=e.context.getModel(u,{"attributes":e.data.id&&{"id":e.data.id},"temporary":!0})),this.options=e,this._createModel(),r.prototype.constructor.call(this,this.options),this.listenTo(this.options.node,"change",this.updateForm),this._createMetadataItemNameView(),this.commandController=new f({"commands":e.commands||v}),this.commands=this.commandController.commands,this.reloadWidget=!1,this.parentNode=void 0,this.supportOriginatingView=!0},"fieldToRefresh":"modify_date","_createMetadataItemNameView":function(){this.metadataItemNameView&&(this.cancelEventsToViewsPropagation(this.metadataItemNameView),this.metadataItemNameView.destroy());var e=this.metadataItemNameView=new a({"model":this.options.node,"container":this.options.node.parent,"containerCollection":this.options.containerCollection,"collection":this.options.collection,"context":this.options.context,"nameSchema":{},"commands":this.commands,"originatingView":this,"showDropdownMenu":!0,"showPropertiesCommand":!0});this.listenTo(e,"metadata:item:name:save",this._saveItemName),this.listenTo(e,"metadata:item:before:delete",t.bind(function(e){this.trigger("metadata:item:before:delete",e)},this)),this.listenTo(e,"metadata:item:before:move",t.bind(function(e){this.trigger("metadata:item:before:move",e)},this)),this.listenTo(e,"metadata:item:deleted",t.bind(function(e){this.trigger("metadata:item:deleted",e)},this)),this.propagateEventsToViews(this.metadataItemNameView)},"reloadWidget":!1,"formTemplate":y,"className":"cs-form csui-general-form cs-document-overview-wrapper","ui":{"location":".location-view","back":".cs-go-back"},"events":{"click .command-btn":"_handleClickButton","click .thumbnail_section":"_handleClickThumbnail","click @ui.back":"onBackButton","keydown":"onKeyInView"},"behaviors":{"PerfectScrolling":{"behaviorClass":b,"contentParent":".cs-content-container","suppressScrollX":!0}},"onKeyInView":function(e){var t=e||window.event,i=t.target||t.srcElement;13!==t.keyCode&&32!==t.keyCode||(t.preventDefault(),t.stopPropagation(),n(i).trigger("click"))},"onBackButton":function(){history.back()},"_saveItemName":function(e){var i=this,n=e.sender.getValue(),o={"name":n},a=this.options.model;a.setFields("versions.element(0)","owner_id"),a.set(o,{"silent":!0});var s=t.clone(a.attributes);return a.save(s,{"data":o,"wait":!0,"silent":!0}).then(function(){a.fetch({"silent":!0}).done(function(){i._updateFieldsToRefersh(),i.metadataItemNameView._toggleEditMode(!1,!1)})})},"_handleClickThumbnail":function(e){e.stopImmediatePropagation(),this._executeCommand("Open")},"_handleClickButton":function(e){e.stopImmediatePropagation();var t=n(e.target).data("signature");this._executeCommand(t)},"_executeCommand":function(e){var t=this.commands.get(e),i=this;i.collection=new w([this.options.node]);var n={"nodes":new w([this.options.node]),"container":this.options.node,"originatingView":i},a={"context":this.options.context};try{if(!t)throw new Error('Command "'+e+'" not found.');t.execute(n,a)}catch(e){o.warn('Executing the command "{0}" failed.\n{1}',t.get("signature"),e.message)&&console.warn(o.last)}},"_createModel":function(){var e=this.options.node;this.options.model=new m({"data":{"name":e.get("name"),"description":e.get("description"),"create_date":e.get("create_date"),"create_user_id":e.get("create_user_id"),"type":e.get("type"),"type_name":e.get("type_name"),"mime_type":l.findTypeByNode(e),"modify_date":e.get("modify_date"),"owner_user_id":e.get("owner_user_id"),"size":e.get("size_formatted"),"reserved_user_id":e.get("reserved_user_id")},"schema":{"properties":{"name":{"maxLength":248,"minLength":1,"readonly":!0,"required":!0,"title":"Name","type":"string"},"description":{"readonly":!0,"required":!1,"title":"Description","type":"string"},"create_date":{"readonly":!0,"required":!1,"title":"Created","type":"string","format":"datetime"},"create_user_id":{"readonly":!0,"required":!1,"title":"Created By","type":"otcs_user_picker"},"type":{"readonly":!0,"required":!1,"title":"Type","type":"integer"},"type_name":{"readonly":!0,"required":!1,"title":"Type","type":"string"},"modify_date":{"readonly":!0,"required":!1,"title":"Modified","type":"string","format":"datetime"},"owner_user_id":{"readonly":!0,"required":!1,"title":"Owned By","type":"otcs_user_picker"},"size":{"hidden":!1,"readonly":!0,"title":"Size","type":"string","tooltip":"838,049 bytes"},"mime_type":{"hidden":!1,"readonly":!0,"title":"Type","type":"string"}},"type":"object","title":"General"},"options":{"fields":{"name":{"hidden":!1,"hideInitValidationError":!0,"label":_.name,"readonly":!0,"type":"text"},"description":{"hidden":!1,"rows":5,"hideInitValidationError":!0,"label":_.description,"readonly":!0,"type":"textarea","placeholder":"Add description"},"create_date":{"hidden":!1,"hideInitValidationError":!0,"label":_.created,"readonly":!0,"type":"datetime","placeholder":"n/a"},"create_user_id":{"hidden":!1,"hideInitValidationError":!0,"label":_.createdBy,"readonly":!0,"type":"otcs_user","type_control":{"name":"Admin"},"placeholder":"n/a"},"type":{"hidden":!0,"hideInitValidationError":!0,"label":_.type,"readonly":!0,"type":"integer"},"type_name":{"hidden":!1,"hideInitValidationError":!0,"label":_.type,"readonly":!0,"type":"text"},"modify_date":{"hidden":!1,"hideInitValidationError":!0,"label":_.modified,"readonly":!0,"type":"datetime","placeholder":"n/a"},"owner_user_id":{"hidden":!1,"hideInitValidationError":!0,"label":_.ownedBy,"readonly":!0,"type":"otcs_user","type_control":{"name":"Admin"},"placeholder":"n/a"},"size":{"hidden":!1,"readonly":!0,"label":_.size,"placeholder":"n/a","type":"text"},"mime_type":{"hidden":!1,"readonly":!0,"label":_.type,"placeholder":"n/a","type":"text"}}}},this.options),this.options.model._addReserveInfo(this.options.model.attributes)},"_updateModel":function(){var e=this.options.node;t.extend(this.model.attributes.data,{"name":e.get("name"),"description":e.get("description"),"create_date":e.get("create_date"),"create_user_id":e.get("create_user_id"),"type":e.get("type"),"type_name":e.get("type_name"),"mime_type":l.findTypeByNode(e),"modify_date":e.get("modify_date"),"owner_user_id":e.get("owner_user_id"),"size":e.get("size_formatted"),"reserved_user_id":e.get("reserved_user_id")}),this.model._addReserveInfo(this.model.attributes)},"_getLayout":function(){var e=this.alpaca.data,t=this.options&&this.options.context,i=t&&t.viewStateModel,n=i&&i.getLastRouterInfo();return e.name=this.model.get("data").name,{"parent":"bootstrap-csui","layout":{"template":this.getOption("formTemplate").call(this,{"data":e,"mode":this.mode,"lang":_,"back_button":n,"imgSrc":"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=","imgAlt":_.docPreviewImgAlt}),"bindings":this._getBindings()}}},"_getBindings":function(){var e={"name":"name_section","create_user_id":".created_by_section","modify_date":".modified_section","mime_type":".type_section","description":".description_section","size":".size_section","status":"status_section"};return this.model&&this.model.node&&this.model.node.get("reserved")&&(e=t.extend(e,{"reserve_info":".reserve_info"})),e},"updateForm":function(e){this._updateModel(),this._createModel(),r.prototype.constructor.call(this,this.options),this.metadataItemNameView=new a({"model":this.options.node,"container":this.options.node.parent,"containerCollection":this.options.containerCollection,"collection":this.options.collection,"context":this.options.context,"nameSchema":{},"commands":this.commands,"originatingView":this,"showDropdownMenu":!0,"showPropertiesCommand":!0}),this.listenTo(this.metadataItemNameView,"metadata:item:name:save",this._saveItemName),this.propagateEventsToViews(this.metadataItemNameView),r.prototype.updateForm.apply(this,arguments)},"updateRenderedForm":function(e){r.prototype.updateRenderedForm.apply(this,arguments),this._showNodeIcon(),this._showMetadataItemName(),this._showThumbnail(),this._addLocationView(),this._addCommentView(),this._addFavoriteView(),this._checkDescriptionContent(),this._checkEditPermission(),this._overrideDefaultScroll()},"_validateAndSave":function(){var e=this.metadataItemNameView.getValue().trim(),i=this.metadataItemNameView.getInputBoxValue();i=i.trim(),0!==i.length&&e===i||this.metadataItemNameView.ItemNameBehavior.validateInputName(i).done(t.bind(function(e){if(!e)return!1;this.metadataItemNameView.setInputBoxValue(i),this.metadataItemNameView.setValue(i),this.metadataItemNameView.modelHasEmptyName=!1,this.metadataItemNameView.trigger("metadata:item:name:save",{"sender":this.metadataItemNameView})},this))},"_showThumbnail":function(){if(this.thumbnail=this.options.thumbnail||new h({"node":this.options.node}),this.listenTo(this.thumbnail,"loadUrl",this._showImage),this.listenTo(this.thumbnail,"error",this._showDefaultImage),this.listenTo(this,"destroy",t.bind(this._destroyThumbnail,this)),"create"!==this.mode&&!this.thumbnailSet){this.thumbnailSet=!0,this.thumbnail.hasOwnProperty("imgUrl")&&this.thumbnail.imgUrl?this._showImage():this.thumbnail.loadUrl()}},"_showImage":function(){this.$el.addClass("cs-document-overview-wrapper-with-thumbnail"),this.$el.find(".thumbnail-container").removeClass("binf-hidden"),this.trigger("thumbnail:show:image");var e=this,t=this.$el.find(".img-doc-preview");t.attr("src",this.thumbnail.imgUrl),t.prop("tabindex","0"),t.one("load",function(i){i.target.clientHeight>=i.target.clientWidth?t.addClass("cs-form-img-vertical"):t.addClass("cs-form-img-horizontal"),t.addClass("cs-form-img-border"),t.removeClass("binf-hidden");var o=n.Event("tab:content:render");e.$el.trigger(o)})},"_showDefaultImage":function(){console.error("error while loading thumbnail image in document overview page")},"_showNodeIcon":function(){this._nodeIconView||(this._nodeIconView=new d({"el":this.$el.find(".csui-type-icon").get(0),"node":this.options.node}),this._nodeIconView.render())},"_showMetadataItemName":function(){var e=this.metadataItemNameView.render();i.triggerMethodOn(e,"before:show",e,this),this.$el.find(".title-container").append(e.el),i.triggerMethodOn(e,"show",e,this)},"_addLocationView":function(){var e=this,t=function(){new c({"model":e.options.node,"context":e.options.context,"nameEdit":!1,"el":e.$el.find(e.ui.location)}).render()};this.options.node.get("parent_id_expand")?t():(this.options.node.setExpand("properties",["parent_id","reserved_user_id"]),this.options.node.fetch({"silent":!0}).then(function(){t()},e))},"_addCommentView":function(){var e=this.options;e.model=this.options.node;var t=new p(e);new i.Region({"el":this.$el.find(".commentRegion")}).show(t)},"_checkDescriptionContent":function(){var e=this.$el.find(".description_section");this.options.model.get("description")?(e.removeClass("binf-hidden"),e.find(".btn-container > button").removeAttr("title")):e.addClass("binf-hidden")},"_addFavoriteView":function(){var e=this.options;e.model=this.options.node,e.popoverAtBodyElement=!0;var t=new g(e);new i.Region({"el":this.$el.find(".favoriteRegion")}).show(t)},"_checkEditPermission":function(){var e=this.commands.findWhere({"signature":"Edit"}),t={"nodes":new w([this.options.node]),"container":this.options.node.parent},i={"context":this.options.context};e&&e.enabled(t,i)||this.$el.find(".edit-btn").addClass("binf-hidden")},"_destroyForm":function(){r.prototype._destroyForm.apply(this,arguments),this._destroyThumbnail()},"_destroyThumbnail":function(){this.thumbnail&&(this.thumbnail.destroy(),this.thumbnail=void 0),this.thumbnailSet=!1},"_updateFieldsToRefersh":function(){var e=this.$el.alpaca("get");if(e){var t=this.options.model.attributes,i=e.childrenByPropertyId[this.fieldToRefresh],n=t[this.fieldToRefresh];i&&i.getValue()!==n&&(i.setValue(n),i.refresh())}},"_overrideDefaultScroll":function(){var e=this.$el.parent();e.length&&e.css({"margin-top":"7.5px","height":"calc((100vh - 102px)","overflow-y":"hidden","padding-top":"32px"})}});return t.extend(V.prototype,s),V}),csui.define("json!csui/widgets/document.overview/document.overview.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{widgetTitle}}","description":"{{widgetDescription}}","kind":"fullpage","schema":{"type":"object","properties":{"id":{"title":"{{idTitle}}","description":"{{idDescription}}","type":"integer"}},"required":["id"]},"options":{"fields":{"id":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[144]}}}}}}),csui.define("json!csui/widgets/metadata/metadata.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{widgetTitle}}","description":"{{widgetDescription}}","kind":"fullpage","schema":{"type":"object","properties":{"id":{"title":"{{idTitle}}","description":"{{idDescription}}","type":"integer"},"initialPanel":{"title":"{{initialPanelTitle}}","description":"{{initialPanelDescription}}","type":"string"}},"required":["id"]},"options":{"fields":{"id":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[]}}}}},"actions":[{"toolItems":"csui/widgets/metadata/header.dropdown.menu.items","toolItemMasks":"csui/widgets/metadata/header.dropdown.menu.items.mask","toolbars":[{"id":"dropdownMenuList","title":"{{dropdownMenuTitle}}","description":"{{dropdownMenuDescription}}"}]},{"toolItems":"csui/widgets/metadata/add.properties.menuitems","toolItemMasks":"csui/widgets/metadata/add.properties.menuitems.mask","toolbars":[{"id":"addPropertiesToolbar","title":"{{addPropertiesTitle}}","description":"{{addPropertiesDescription}}"}]}]}),csui.define("json!csui/widgets/metadata.navigation/metadata.navigation.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{widgetTitle}}","description":"{{widgetDescription}}","kind":"fullpage","schema":{
"type":"object","properties":{"id":{"title":"{{idTitle}}","description":"{{idDescription}}","type":"integer"},"initialPanel":{"title":"{{initialPanelTitle}}","description":"{{initialPanelDescription}}","type":"string"}},"required":["id"]},"options":{"fields":{"id":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[]}}}}}}),csui.define("csui/widgets/document.overview/impl/nls/document.overview.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/document.overview/impl/nls/root/document.overview.manifest",{"widgetTitle":"Document Overview","widgetDescription":"Shows basic information about a document and offers the most often actions for it.","idTitle":"Document","idDescription":"A document to show the overview for"}),csui.define("csui/widgets/metadata/impl/nls/metadata.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata/impl/nls/root/metadata.manifest",{"widgetTitle":"Object Information","widgetDescription":"Shows information about an object and offers the most important actions for it.","idTitle":"Object","idDescription":"An object to show the information for","initialPanelTitle":"Object information","initialPanelDescription":"An object to show the information for","dropdownMenuTitle":"Object Context Menu","dropdownMenuDescription":"Context menu, which is displayed when clicking on the arrow on the right side of the name of the opened object.","addPropertiesTitle":"Add Feature Menu","addPropertiesDescription":"Drop-down menu, which is displayed when clicking on the plus on the right side of the property tabs."}),csui.define("csui/widgets/metadata.navigation/impl/nls/metadata.navigation.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata.navigation/impl/nls/root/metadata.navigation.manifest",{"widgetTitle":"Object Information","widgetDescription":"Shows information about an object and offers the most important actions for it.","idTitle":"Object","idDescription":"An object to show the information for","initialPanelTitle":"Object information","initialPanelDescription":"An object to show the information for"}),csui.define("bundles/csui-metadata",["csui/controls/tableheader/comment/comment.button.view","csui/widgets/metadata/versions.toolbaritems","csui/widgets/metadata/impl/metadata.tabcontentcollection.view","csui/widgets/metadata/impl/header/rightbar/toolbaritems","csui/widgets/metadata/impl/header/rightbar/toolbaritems.masks","csui/widgets/metadata/metadata.view","csui/widgets/metadata/metadata.properties.view","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/widgets/metadata/metadata.add.categories.controller","csui/widgets/metadata/metadata.add.document.controller","csui/widgets/metadata/impl/add.items/metadata.add.item.controller","csui/widgets/metadata/metadata.add.item.controller","csui/widgets/metadata/metadata.copy.move.items.controller","csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view","csui/widgets/metadata.navigation/metadata.navigation.view","csui/widgets/document.overview/document.overview.view","csui/widgets/metadata/impl/add.items/metadata.add.multiple.items.controller","json!csui/widgets/document.overview/document.overview.manifest.json","json!csui/widgets/metadata/metadata.manifest.json","json!csui/widgets/metadata.navigation/metadata.navigation.manifest.json","i18n!csui/widgets/document.overview/impl/nls/document.overview.manifest","i18n!csui/widgets/metadata/impl/nls/metadata.manifest","i18n!csui/widgets/metadata.navigation/impl/nls/metadata.navigation.manifest","csui/widgets/metadata/add.properties.menuitems","csui/widgets/metadata/add.properties.menuitems.mask","csui/widgets/metadata/header.dropdown.menu.items","csui/widgets/metadata/header.dropdown.menu.items.mask","csui/widgets/metadata/versions.toolbaritems.mask","csui/widgets/metadata/metadata.general.action.fields"],{}),csui.require(["require","css"],function(e,t){t.styleLoad(e,"csui/bundles/csui-metadata",!0)});
//# sourceMappingURL=csui-metadata.js.map