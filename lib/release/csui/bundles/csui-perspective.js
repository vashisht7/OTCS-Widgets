csui.define("csui/perspective.manage/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/impl/nls/root/lang",{"layoutTabTitle":"Change page layout","widgetTabTitle":"Add widget","expandTab":"Expand tab","collapseTab":"Collapse tab","noTitle":"Title not available","goBackTooltip":"Go back","templateMessage":"Drag and Drop tile in position","changePageLayoutConfirmatonText":"All your previously added and configured widgets will be lost!","proceedButton":"Proceed","changeLayoutCancelButton":"Cancel","FlowLayoutTitle":"Flow layout","LcrLayoutTitle":"Left center right layout","perspectiveSaveSuccess":"Perspective has been updated successfully.","personalizationSaveSuccess":"Changes saved successfully.","saveConfirmMsg":"Please be aware this action will update all perspective overrides using this layout configuration. If you do not want this to happen, you should create a new perspective.","saveConfirmTitle":"Save perspective","addWidget":"Add widget","save":"Save","close":"Close","cancel":"Cancel","reset":"Reset","resetConfirmMsg":"Page will be reset to default page configured by the administrator.","configNotSupported":"This widget cannot be configured with edit page.","resetSuccessful":"Reset to original page was successful."}),csui.define("hbs!csui/perspective.manage/impl/options.form.wrapper",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="csui-pman-form-header">\r\n    <div class="csui-pman-form-title">'+this.escapeExpression((n=null!=(n=i.title||(null!=e?e.title:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"title","hash":{}}):n))+'</div>\r\n    <div class="csui-pman-form-description">'+this.escapeExpression((n=null!=(n=i.description||(null!=e?e.description:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"description","hash":{}}):n))+'</div>\r\n    <div class="csui-pman-config-unsupported">\r\n        <div class="csui-state">\r\n            <span class="csui-state-icon csui-icon csui-icon-notification-error-white"></span>\r\n        </div>\r\n        <div class="csui-error-message">\r\n            <span>'+this.escapeExpression((n=null!=(n=i.configNotSupported||(null!=e?e.configNotSupported:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"configNotSupported","hash":{}}):n))+'</span>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="csui-pman-form-content cs-formview-wrapper"></div>\r\n'}});return t.registerPartial("csui_perspective.manage_impl_options.form.wrapper",s),s}),csui.define("css!csui/perspective.manage/impl/options.form",[],function(){}),csui.define("csui/perspective.manage/impl/options.form.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/lib/alpaca/js/alpaca","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/controls/form/form.view","i18n!csui/perspective.manage/impl/nls/lang","hbs!csui/perspective.manage/impl/options.form.wrapper","csui/utils/perspective/perspective.util","css!csui/perspective.manage/impl/options.form"],function(e,i,t,s,n,o,a,r,c,p,l){var d=s.LayoutView.extend({"template":p,"className":"csui-pman-form-wrapper","regions":{"bodyRegion":".csui-pman-form-content"},"behaviors":{"PerfectScrolling":{"behaviorClass":a,"scrollYMarginOffset":1}},"templateHelpers":function(){return{"title":this.options.manifest.title,"description":this.options.manifest.description,"configNotSupported":c.configNotSupported}},"ui":{"unSupportedConfig":".csui-pman-config-unsupported","description":".csui-pman-form-description"},"constructor":function(e){this.options=e||{},this.manifest=this.options.manifest,s.LayoutView.prototype.constructor.apply(this,arguments)},"_createForm":function(e){this.widgetOptionsFormView=new u({"context":this.options.context,"model":e,"mode":"create"}),this.listenToOnce(this.widgetOptionsFormView,"render:form",function(){this.trigger("render:form")}.bind(this)),this.listenTo(this.widgetOptionsFormView,"change:field",function(e){this.trigger("change:field",e)}.bind(this))},"_hasSchema":function(){return!(!(this.manifest&&this.manifest.schema&&this.manifest.schema.properties)||e.isEmpty(this.manifest.schema.properties))},"refresh":function(e){this.widgetOptionsFormView?this.widgetOptionsFormView.refresh(e):e()},"onRender":function(){if(this.ui.unSupportedConfig.hide(),!this._hasSchema())return void this.trigger("render:form");var e=this._prepareFormModel();this.hasValidSchema=d._normalizeOptions(e.attributes.schema.properties,e.attributes.options.fields,e.attributes.data),this.hasValidSchema?(this._createForm(e),this.bodyRegion.show(this.widgetOptionsFormView)):(this.ui.description.hide(),this.ui.unSupportedConfig.show(),this.trigger("render:form"))},"onPopoverShow":function(e){this._hasSchema()&&!this.hasValidSchema&&(e.find(".binf-popover-content").addClass("invalid-options"),e.find(".binf-arrow").addClass("invalid-options"))},"getValues":function(){if(this._hasSchema())return this.hasValidSchema?this.widgetOptionsFormView.getValues():this._getOptionsData()},"validate":function(){if(!this._hasSchema())return!0;if(!this.hasValidSchema){var i=!0;if(l.hasRequiredFields(this.manifest)){var t=this._getOptionsData(),s=this.manifest.schema.required;e.each(s,function(e){t[e]||(i=!1)})}return i}return this.widgetOptionsFormView.validate()},"_isPreviewWidget":function(){return"csui/perspective.manage/widgets/perspective.widget"===this.options.widgetConfig.type},"_prepareFormModel":function(){var e=this._getOptionsData(),i=JSON.parse(JSON.stringify(this.manifest.schema)),s=JSON.parse(JSON.stringify(this.manifest.options||{}));return s||(s={}),s.fields||(s.fields={}),this._addWidgetSizePropertyIfSupported(i,s,e),new t.Model({"schema":i,"options":s,"data":e})},"_getOptionsData":function(){var e=this.options.widgetConfig.options||{};return this._isPreviewWidget()&&(e=e.options||{}),e},"_addWidgetSizePropertyIfSupported":function(i,t,s){if(this.options.perspectiveView.getSupportedWidgetSizes){var n=this.options.perspectiveView.getSupportedWidgetSizes(this.manifest,this.options.widgetView);if(n&&0!==n.length){var o={"title":c.widgetSizeTitle,"description":c.widgetSizeDescription,"type":"string","enum":e.map(n,function(e){return e.kind})},a={"type":"select","optionLabels":e.map(n,function(e){return e.label}),"removeDefaultNone":!0},r=e.find(n,function(e){return e.selected});r&&(s[d.widgetSizeProperty]=r.kind);var p={};p[d.widgetSizeProperty]=o,i.properties=e.extend(p,i.properties);var l={};l[d.widgetSizeProperty]=a,t.fields=e.extend(l,t.fields),i.required=i.required||[],i.required.push(d.widgetSizeProperty)}}}},{"widgetSizeProperty":"__widgetSize","_resolveOptionsType":function(e,i){var t=e.type;return t||(t=n.getSchemaType(i)),t||(t=i&&n.isArray(i)?"array":"object"),e&&e.enum?e.enum.length>3?"select":"radio":n.defaultSchemaFieldMapping[t]},"_normalizeOptions":function(i,t,s){var o=!0;return e.each(i,function(i,a){var r=t[a],c=s[a];r||(t[a]=r={});var p=r.type;switch(!p&&i.type&&(p=d._resolveOptionsType(i,c)),n.getFieldClass(p)||(o=!1),i.type){case"array":if(r.fields||e.defaults(r,{"fields":{"item":{}}}),r.items&&(r.fields.item=r.items),"object"===i.items.type){r.fields.item.type&&!n.getFieldClass(r.fields.item.type)&&(o=!1),r.fields.item.fields||(r.fields.item.fields={}),c&&0!==c.length||(s[a]=c=[{}]);d._normalizeOptions(i.items.properties,r.fields.item.fields,c[0])||(o=!1)}c||(s[a]=[null]);break;case"object":c||(s[a]=c={}),r.fields||(r.fields={});d._normalizeOptions(i.properties,r.fields,c)||(o=!1);break;default:e.isUndefined(c)&&(s[a]=i.default||null)}}),o}}),u=r.extend({"className":function(){return r.prototype.className.call(this)+" perspective-widget-form"},"constructor":function(e){r.apply(this,arguments)},"refresh":function(e){this.form&&this.form.refresh(e)},"_modifyModel":function(){r.prototype._modifyModel.apply(this,arguments),this.alpaca.options.hideInitValidationError=!1}});return e.extend(u.prototype,o),d}),csui.define("hbs!csui/perspective.manage/impl/widget.item",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"1":function(e,i,t,s,n,o){var a;return'        <div>\r\n          <div class="csui-widget-item icon-draggable-handle"\r\n               title="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.attributes:e)?a.title:a,e))+'" '+(null!=(a=i.if.call(e,null!=o[1]?o[1].draggable:o[1],{"name":"if","hash":{},"fn":this.program(2,s,0,n,o),"inverse":this.noop}))?a:"")+">\r\n            <span>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.attributes:e)?a.title:a,e))+'</span>\r\n            <div class="csui-layout-icon '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.attributes:e)?a.icon:a,e))+'"></div>\r\n          </div>\r\n        </div>\r\n'},"2":function(e,i,t,s){return' draggable="true"'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s,n,o){var a;return'<div class="csui-accordion-header" title="'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'">\r\n  <div class="csui-accordion-header-title">'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'</div>\r\n  <div class="csui-button-icon cs-icon icon-expandArrowDown"></div>\r\n  <div class="csui-button-icon cs-icon icon-expandArrowUp"></div>\r\n</div>\r\n<div class="csui-accordion-content">\r\n  <div class="cs-content csui-list-pannel">\r\n    <div class="cs-list-group">\r\n'+(null!=(a=i.each.call(e,null!=e?e.widgets:e,{"name":"each","hash":{},"fn":this.program(1,s,0,n,o),"inverse":this.noop}))?a:"")+"    </div>\r\n  </div>\r\n</div>"},"useDepths":!0});return t.registerPartial("csui_perspective.manage_impl_widget.item",s),s}),csui.define("hbs!csui/perspective.manage/impl/widget.drag.template",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="csui-widget-template">\r\n  <div class="csui-template-header">'+this.escapeExpression(this.lambda(null!=e?e.header:e,e))+'</div>\r\n  <div class="csui-template-body">'+this.escapeExpression(this.lambda(null!=e?e.body:e,e))+"</div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_impl_widget.drag.template",s),s}),csui.define("csui/perspective.manage/impl/widget.list.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/perspective.manage/impl/options.form.view","i18n!csui/perspective.manage/impl/nls/lang","csui/models/widget/widget.collection","hbs!csui/perspective.manage/impl/widget.item","hbs!csui/perspective.manage/impl/widget.drag.template"],function(e,i,t,s,n,o,a,r,c,p,l,d){"use strict";var u=e.config();i.defaults(u,{"dragImageOffsetTop":50,"dragImageOffsetLeft":50});var g=n.ItemView.extend({"constructor":function(e){n.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","className":"csui-module-group","template":l,"templateHelpers":function(){var e=new s.Collection(this.model.attributes.widgets),i=t(".perspective-editing .csui-dnd-container"),n=0===i.length;return{"widgets":e.models,"draggable":n}},"ui":{"accordionHeader":".csui-accordion-header","accordionContent":".csui-accordion-content","accordionHeaderIcon":".csui-accordion-header .cs-icon","widget":".csui-widget-item"},"events":{"click @ui.accordionHeader":"toggle","dragstart @ui.widget":"onDragStart","dragend @ui.widget":"onDragEnd"},"toggle":function(){var e=this.ui.accordionHeader.hasClass("csui-accordion-expand");this.ui.accordionHeader.toggleClass("csui-accordion-expand"),this.options.parentView.$el.find(".csui-module-group").removeClass("csui-accordion-visible").find(".csui-accordion-header").removeClass("csui-accordion-expand"),e||(this.$el.addClass("csui-accordion-visible"),this.ui.accordionHeader.addClass("csui-accordion-expand")),o.onTransitionEnd(this.ui.accordionContent,function(){this.trigger("widgets:expanded")},this)},"onRender":function(){if(t(".perspective-editing .csui-dnd-container").length)this._makeWidgetSortable();else{var e="function"==typeof document.createElement("span").dragDrop;!this._hasNativeDragImageSupport()&&e&&this.ui.widget.on("mousedown",this._handleDragImageForIE.bind(this))}},"_makeWidgetSortable":function(){var e=this,i=this.$el.find(".csui-widget-item").parent();i.data("pman.widget",this.model.get("widgets")),i.sortable({"connectWith":[".perspective-editing .csui-dnd-container",".perspective-editing .pman-trash-area"],"containment":".perspective-editing ","helper":function(i,t){var s=t.parent().index();return e.widgetDragTemplate=new h({"title":e.model.get("widgets")[s].get("title"),"newWidget":e.model.get("widgets")[s]}),e.widgetDragTemplate.render(),e.widgetDragTemplate.$el.width("220px"),e.widgetDragTemplate.$el.height("220px"),e.widgetDragTemplate.$el.css({"opacity":.75}),e.widgetDragTemplate.$el.appendTo(e.options.parentView.$el.closest(".pman-pannel-wrapper")),e.widgetDragTemplate.$el},"tolerance":"pointer","cursorAt":{"top":u.dragImageOffsetTop,"left":u.dragImageOffsetLeft},"start":function(i,t){t.item.css("display","block"),t.placeholder.css("display","block"),e.dragStart()},"stop":function(){e.dragEnd()}})},"_handleDragImageForIE":function(e){var s=e.originalEvent,n=t(".csui-template-wrapper").clone(),o=this.model.get("widgets")[t(e.currentTarget).parent().index()];n.find(".csui-template-header").text(o.get("title")),n.css({"top":Math.max(0,s.pageY-u.dragImageOffsetTop)+"px","left":Math.max(0,s.pageX-u.dragImageOffsetLeft)+"px","position":"absolute","pointerEvents":"none"}).appendTo(document.body),setTimeout(function(){n.remove()}),n.on("dragstart",i.bind(function(i){var s=this.model.get("widgets")[t(e.currentTarget).parent().index()];i.originalEvent.dataTransfer.setData("text",JSON.stringify(s.toJSON())),this.dragStart()},this)),n.on("dragend",i.bind(function(e){this.dragEnd()},this)),n[0].dragDrop()},"onDragStart":function(e){var i=this.model.get("widgets")[t(e.currentTarget).parent().index()],s=e.originalEvent.dataTransfer,n=t(".csui-template-wrapper");n.find(".csui-template-header").text(i.get("title")),this._hasNativeDragImageSupport()&&(s.setData("text",JSON.stringify(i.toJSON())),s.setDragImage(n[0],u.dragImageOffsetLeft,u.dragImageOffsetTop)),this.dragStart()},"_hasNativeDragImageSupport":function(){return"setDragImage"in(window.DataTransfer||window.Clipboard).prototype},"onDragEnd":function(e){this.dragEnd()},"dragStart":function(){this.$el.closest(".csui-pman-panel").addClass("csui-pman-drag-start"),t(document.body).addClass("csui-pman-dnd-active")},"dragEnd":function(){this.$el.closest(".csui-pman-panel").removeClass("csui-pman-drag-start"),t(document.body).removeClass("csui-pman-dnd-active")}}),h=n.ItemView.extend({"constructor":function(e){n.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","className":"csui-template-wrapper","template":d,"templateHelpers":function(){return{"header":this.options&&this.options.title,"body":c.templateMessage}},"onRender":function(){this.$el.data("pman.widget",this.options.newWidget)}});return n.ItemView.extend({"tagName":"div","template":l,"constructor":function(e){e||(e={}),e.data||(e.data={}),n.ItemView.call(this,e);var i=this;this.allWidgets=new p,this.allWidgets.fetch().done(function(){i.collection=i._groupWidgetsByModule(),i.render(),i.trigger("items:fetched")})},"initialize":function(){i.bindAll(this,"renderItem")},"className":"cs-module-list","render":function(){this.collection&&this.collection.each(this.renderItem)},"renderItem":function(e){var s=this,n=new g({"model":e,"parentView":s});n.render(),this.listenTo(n,"widgets:expanded",i.bind(this.trigger,this,"dom:refresh",this)),t(this.el).append(n.el)},"_groupWidgetsByModule":function(){var e=new s.Collection,t=this.allWidgets.filter(function(e){var t=e.get("manifest");if(!t||!i.has(t,"title")||!i.has(t,"description")||t.deprecated)return!1;var s=JSON.parse(JSON.stringify(t.schema||{})),n=JSON.parse(JSON.stringify(t.options||{}));return!!r._normalizeOptions(s.properties,n.fields||{},{})});return i.each(t,function(e){var i=e.get("manifest");e.set("title",i&&i.title||c.noTitle)}),i.each(i.groupBy(t,function(e){return e.serverModule.id}),function(t,s){var n=i.first(t).serverModule.get("title");n=n?n.replace(/OpenText /,""):c.noTitle,e.add({"id":s,"title":n,"widgets":t})}),e},"_sanitiseWidgetLibrary":function(){},"onInitWidgets":function(){this.$el.empty(),this.render()}})}),csui.define("csui/perspective.manage/impl/perspectivelayouts",["csui/lib/underscore","i18n!csui/perspective.manage/impl/nls/lang","csui-ext!perspective.manage/impl/perspectivelayouts"],function(e,i,t){var s=[{"title":i.LcrLayoutTitle,"type":"left-center-right","icon":"csui-layout-lcr"},{"title":i.FlowLayoutTitle,"type":"flow","icon":"csui-layout-flow"}];return t&&(s=e.union(s,t)),s}),csui.define("hbs!csui/perspective.manage/impl/pman.panel",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="csui-tab-pannel">\r\n  <div class="csui-layout-tab" title="'+this.escapeExpression(this.lambda(null!=e?e.layoutTabTitle:e,e))+'">\r\n    '+this.escapeExpression(this.lambda(null!=e?e.layoutTabTitle:e,e))+'\r\n  </div>\r\n  <div class="csui-AddWidget-tab" title="'+this.escapeExpression(this.lambda(null!=e?e.widgetTabTitle:e,e))+'">\r\n    '+this.escapeExpression(this.lambda(null!=e?e.widgetTabTitle:e,e))+'\r\n  </div>\r\n  <div class="csui-widget-tab"></div>\r\n</div>\r\n<div class="csui-list-pannel"></div>\r\n<div class="csui-template-overlay"></div>\r\n<div class="csui-template-wrapper">\r\n  <div class="csui-widget-template">\r\n    <div class="csui-template-header"></div>\r\n    <div class="csui-template-body">'+this.escapeExpression(this.lambda(null!=e?e.templateMessage:e,e))+"</div>\r\n  </div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_impl_pman.panel",s),s}),csui.define("hbs!csui/perspective.manage/impl/list.item",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="'+this.escapeExpression(this.lambda(null!=e?e.className:e,e))+'" title="'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'"\r\n     draggable='+this.escapeExpression(this.lambda(null!=e?e.draggable:e,e))+">\r\n  <span>"+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'</span>\r\n  <div class="csui-layout-icon '+this.escapeExpression(this.lambda(null!=e?e.iconClass:e,e))+'"></div>\r\n</div>'}});return t.registerPartial("csui_perspective.manage_impl_list.item",s),s}),csui.define("hbs!csui/perspective.manage/impl/list",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="cs-header binf-panel-heading cs-header-with-go-back" tabindex="0" role="link"\r\n     aria-label="'+this.escapeExpression((n=null!=(n=i.goBackAria||(null!=e?e.goBackAria:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"goBackAria","hash":{}}):n))+'">\r\n  <span class="icon circular arrow_back cs-go-back" title="'+this.escapeExpression((n=null!=(n=i.goBackTooltip||(null!=e?e.goBackTooltip:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"goBackTooltip","hash":{}}):n))+'"></span>\r\n</div>\r\n<div class="cs-content">\r\n  <div class="cs-list-group"></div>\r\n</div>\r\n'}});return t.registerPartial("csui_perspective.manage_impl_list",s),s}),csui.define("css!csui/perspective.manage/impl/pman.panel",[],function(){}),csui.define("csui/perspective.manage/impl/pman.panel.view",["require","module","csui/lib/jquery","csui/lib/backbone","csui/lib/underscore","csui/lib/marionette","csui/controls/progressblocker/blocker","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/perspective.manage/impl/widget.list.view","csui/perspective.manage/impl/perspectivelayouts","i18n!csui/perspective.manage/impl/nls/lang","hbs!csui/perspective.manage/impl/pman.panel","hbs!csui/perspective.manage/impl/list.item","hbs!csui/perspective.manage/impl/list","hbs!csui/perspective.manage/impl/widget.drag.template","css!csui/perspective.manage/impl/pman.panel"],function(e,i,t,s,n,o,a,r,c,p,l,d,u,g,h){"use strict";var m=o.ItemView.extend({"tagName":"div","template":d,"events":{"click @ui.layoutTab":"onTabClicked"},"ui":{"tabPannel":".csui-tab-pannel","listPannel":".csui-list-pannel","layoutTab":".csui-layout-tab","widgetTab":".csui-widget-tab","template":".csui-widget-template"},"className":"csui-pman-panel","behaviors":{"PerfectScrolling":{"behaviorClass":r,"contentParent":".csui-tab-pannel","suppressScrollX":!0,"scrollYMarginOffset":8}},"templateHelpers":function(){return{"layoutTabTitle":l.layoutTabTitle,"widgetTabTitle":l.widgetTabTitle,"templateMessage":l.templateMessage}},"onPanelOpen":function(){this.accordionView.triggerMethod("init:widgets"),this.trigger("ensure:scrollbar")},"onRender":function(){this.ui.widgetTab.hide(),this.ui.layoutTab.hide(),this.accordionRegion=new o.Region({"el":this.ui.widgetTab}),this.accordionView=new c,this.accordionRegion.show(this.accordionView),this.blockActions(),this.listenTo(this.accordionView,"items:fetched",function(){this.unblockActions(),this.ui.layoutTab.show(),this.ui.widgetTab.show()}),this.listenTo(this.accordionView,"dom:refresh",function(){this.trigger("dom:refresh")})},"constructor":function(e){this.options=e||{},o.ItemView.prototype.constructor.apply(this,arguments),a.imbue(this),this.listenTo(this,"reset:items",function(){this.listView&&this.listView.destroy()})},"onTabClicked":function(e){var i=e.data?e:{"data":{"items":p}};i.draggable=!!i.data.draggable,i.itemClassName="csui-layout-item",i.pmanView=this.options.pmanView,this.ui.tabPannel.addClass("binf-hidden"),this.listregion=new o.Region({"el":this.ui.listPannel}),this.listView=new f(i),this.listregion.show(this.listView),this.listenTo(this.listView,"before:destroy",function(){this.ui.tabPannel.removeClass("binf-hidden")}).listenTo(this.listView,"click:back",function(){this.listView.destroy()})}}),v=o.ItemView.extend({"constructor":function(e){o.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","template":u,"templateHelpers":function(){return{"draggable":!!this.options.draggable,"className":this.options.itemClassName,"iconClass":this.model.get("icon")}},"events":{"click .csui-layout-item:not(.binf-active)":n.debounce(function(){this.trigger("change:layout")},200,!0)},"onRender":function(){this.model.get("type")===this.options.pmanView.perspective.get("perspective").type&&this.trigger("set:active")}}),f=o.CompositeView.extend({"constructor":function(e){if(e||(e={}),e.data||(e.data={}),this.behaviors&&n.any(this.behaviors,function(e,i){return e.behaviorClass===r})||(this.behaviors=n.extend({"PerfectScrolling":{"behaviorClass":r,"contentParent":".csui-pman-list","suppressScrollX":!0,"scrollYMarginOffset":15}},this.behaviors)),o.CompositeView.call(this,e),this.options.data&&this.options.data.items){if(!this.collection){var i=s.Collection.extend({"model":s.Model.extend({"idAttribute":null})});this.collection=new i}this.collection.add(this.options.data.items)}},"ui":{"back":".cs-go-back"},"className":"csui-pman-list","events":{"click @ui.back":"onClickBack"},"childEvents":{"change:layout":"onChangeLayout","set:active":"setActive"},"template":g,"templateHelpers":function(){return{"goBackTooltip":l.goBackTooltip}},"childViewContainer":".cs-list-group","childView":v,"childViewOptions":function(){return this.options},"onClickBack":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("click:back")},"setActive":function(e){this.$el.find(".csui-layout-item").removeClass("binf-active"),e.$el.find(".csui-layout-item").addClass("binf-active")},"onChangeLayout":function(e){var i=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(t){t.confirmWarning(l.changePageLayoutConfirmatonText,l.layoutTabTitle,{"buttons":{"showYes":!0,"labelYes":l.proceedButton,"showNo":!0,"labelNo":l.changeLayoutCancelButton}}).done(function(t){t&&(i.setActive(e),i.options.pmanView.trigger("change:layout",e.model.get("type")))})})}});return m}),csui.define("hbs!csui/perspective.manage/impl/pman",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"1":function(e,i,t,s){return'        <li>\r\n          <button class="binf-btn icon-reset" title="'+this.escapeExpression(this.lambda(null!=e?e.reset:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.reset:e,e))+"</button>\r\n        </li>\r\n"},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="pman-backdrop"></div>\r\n<div class="pman-header">\r\n  <div class="pman-header-backdrop"></div>\r\n  <div class="pman-tools-container">\r\n    <div class="pman-left-tools">\r\n      <ul>\r\n        <li class="pman-toolitem">\r\n          <button class="icon icon-toolbarAdd" title="'+this.escapeExpression(this.lambda(null!=e?e.addWidget:e,e))+'"></button>\r\n        </li>\r\n      </ul>\r\n      <div class="pman-pannel-wrapper"></div>\r\n    </div>\r\n    <div class="pman-right-tools">\r\n      <ul>\r\n'+(null!=(n=i.if.call(e,null!=e?e.personalizeMode:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:"")+'        <li>\r\n          <button class="binf-btn icon-save" title="'+this.escapeExpression(this.lambda(null!=e?e.save:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.save:e,e))+'</button>\r\n        </li>\r\n        <li>\r\n          <button class="binf-btn cancel-edit" title="'+this.escapeExpression(this.lambda(null!=e?e.cancel:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.cancel:e,e))+'</button>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n  <div class="pman-trash-area">\r\n    <div class="pman-trash-banner"></div>\r\n  </div>\r\n</div>'}});return t.registerPartial("csui_perspective.manage_impl_pman",s),s}),csui.define("css!csui/perspective.manage/impl/pman",[],function(){}),csui.define("csui/perspective.manage/behaviours/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/behaviours/impl/nls/root/lang",{"deleteConfirmMsg":"Widget will be removed from the page.","deleteConfirmTitle":"Remove Widget","replaceConfirmMsg":"Do you want to replace this widget?","replaceConfirmTitle":"Replace Widget","widgetSizeTitle":"Widget size","widgetSizeDescription":"Determines how much space the widget occupies. Note that widgets are re-sized automatically to display optimally on smaller screens.","removeWidget":"Remove widget","replace":"Replace","remove":"Remove","cancel":"Cancel","configNeeded":"Configuration needed.","hideWidget":"Hide","showWidget":"Display"}),csui.define("hbs!csui/perspective.manage/behaviours/impl/widget.masking",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"1":function(e,i,t,s){var n;return'    <div class="csui-pman-widget-error">\r\n      <div class="csui-pman-widget-error-heading"> '+this.escapeExpression((n=null!=(n=i.widgetTitle||(null!=e?e.widgetTitle:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetTitle","hash":{}}):n))+'</div>\r\n      <div class="csui-pman-widget-error-body">\r\n        <div class="csui-pman-widget-error-icon"></div>\r\n        <div class="csui-pman-widget-error-message"> '+this.escapeExpression((n=null!=(n=i.configNeeded||(null!=e?e.configNeeded:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"configNeeded","hash":{}}):n))+'</div>\r\n      </div>\r\n    </div>\r\n    <div class="csui-pman-widget-close clear-icon" title="'+this.escapeExpression((n=null!=(n=i.removeWidget||(null!=e?e.removeWidget:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"removeWidget","hash":{}}):n))+'"></div>\r\n'},"3":function(e,i,t,s){var n;return'    <div class="csui-pman-widget-personalize-mask">\r\n      <button class="binf-btn csui-pman-personalize-btn csui-pman-hide-widget"\r\n              title="'+this.escapeExpression((n=null!=(n=i.hideWidget||(null!=e?e.hideWidget:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"hideWidget","hash":{}}):n))+'">'+this.escapeExpression((n=null!=(n=i.hideWidget||(null!=e?e.hideWidget:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"hideWidget","hash":{}}):n))+'</button>\r\n      <button class="binf-btn csui-pman-personalize-btn csui-pman-show-widget"\r\n              title="'+this.escapeExpression((n=null!=(n=i.showWidget||(null!=e?e.showWidget:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"showWidget","hash":{}}):n))+'">'+this.escapeExpression((n=null!=(n=i.showWidget||(null!=e?e.showWidget:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"showWidget","hash":{}}):n))+"</button>\r\n    </div>\r\n"},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="csui-pman-widget-masking">\r\n'+(null!=(n=i.if.call(e,null!=e?e.isEditMode:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.program(3,s,0)}))?n:"")+'</div>\r\n<div class="csui-pman-popover-right csui-pman-popover-holder"></div>\r\n<div class="csui-pman-popover-left csui-pman-popover-holder"></div>\r\n'}});return t.registerPartial("csui_perspective.manage_behaviours_impl_widget.masking",s),s}),csui.define("css!csui/perspective.manage/behaviours/impl/widget.masking",[],function(){}),csui.define("csui/perspective.manage/behaviours/pman.widget.config.behaviour",["require","i18n","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/base","csui/lib/backbone","csui/utils/log","csui/models/widget/widget.model","csui/perspective.manage/impl/options.form.view","i18n!csui/perspective.manage/behaviours/impl/nls/lang","hbs!csui/perspective.manage/behaviours/impl/widget.masking","csui/utils/perspective/perspective.util","css!csui/perspective.manage/behaviours/impl/widget.masking"],function(e,i,t,s,n,o,a,r,c,p,l,d,u){"use strict";var g={"removeConfirmMsg":l.deleteConfirmMsg,"removeConfirmTitle":l.deleteConfirmTitle,"configNeededMessage":l.configNeeded,"confirmOnRemove":!0,"allowReplace":!0,"notifyUpdatesImmediatly":!1,"perspectiveMode":"edit"},h=n.ItemView.extend({"template":d,"className":function(){var e=[h.className],i=u.isHiddenWidget(this.options.widgetConfig),s=i?"hidden":"shown";return e.push("csui-pman-widget-mode-"+this.options.perspectiveMode),e.push("csui-pman-widget-state-"+s),t.unique(e).join(" ")},"templateHelpers":function(){return{"removeWidget":this.options.removeConfirmTitle,"widgetTitle":this.manifest&&this.manifest.title,"configNeeded":this.options.configNeededMessage,"isEditMode":this.isEditPage(),"hideWidget":l.hideWidget,"showWidget":l.showWidget}},"ui":{"delete":".csui-pman-widget-close","masking":".csui-pman-widget-masking","widgetTitle":".csui-pman-widget-error-heading","hideWidgetBtn":".csui-pman-hide-widget","showWidgetBtn":".csui-pman-show-widget"},"configureEvents":{"click @ui.masking":"_showCallout","click @ui.delete":"onDeleteClick"},"events":function(){var e={};switch(this.options.perspectiveMode){case"edit":e=t.extend(e,this.configureEvents),this.options.allowReplace&&(e=t.extend(e,{"drop":"onDrop","dragover":"onDragOver","dragenter":"onDragEnter","dragleave":"onDragLeave"}));break;case"personalize":e=t.extend(e,{"click @ui.hideWidgetBtn":"_onHideWidget","click @ui.showWidgetBtn":"_onShowWidget"}),this.options.personalizable&&(e=t.extend(e,this.configureEvents))}return e},"constructor":function(e){e=t.defaults(e,g),n.ItemView.apply(this,arguments),this.dropCounter=0,this.manifest=e.manifest,this.perspectiveView=e.perspectiveView,this.widgetView=e.widgetView,this.widgetConfig=e.widgetConfig,this.perspectiveMode=e.perspectiveMode,this.listenTo(this.widgetView,"refresh:mask",this._doRefreshMask),this.listenTo(this.widgetView,"reposition:flyout",function(){
this.$popoverEl&&this.$popoverEl.data("binf.popover")&&this.$popoverEl.binf_popover("show")})},"_isConfigurable":function(){return!!this.widgetConfig&&!t.isEmpty(this.widgetConfig)&&this.widgetConfig.type!==h.placeholderWidget&&"csui/widgets/error"!==this.widgetConfig.type},"isEditPage":function(){return this.perspectiveMode===u.MODE_EDIT_PERSPECTIVE},"onRender":function(){if(this._isConfigurable()){var e=this;this._loadManifest().done(function(i){e.ui.widgetTitle.text(i.title),e.manifest.selfConfigurable?e._adoptToSelfConfigurableWidget():e.isEditPage()||e.options.personalizable?e._createOptionsForm(function(){if(!this.isDestroyed){var t=!!e.widgetConfig.options&&(e.widgetConfig.options.___pman_isdropped||e.widgetConfig.options.___pman_opencallout),s=e._updateWidgetOptions(!1,!0);e.optionsFormView.refresh(function(){e.$el.addClass("cs-pman-callout-ready"),e.$el.addClass("cs-pman-config-ready"),t&&!s&&e._showOptionsCallout(i,!0)})}}):e.$el.addClass("cs-pman-config-ready")})}},"onDestroy":function(){this.optionsFormView&&this.optionsFormView.destroy()},"_adoptToSelfConfigurableWidget":function(){(u.isEmptyPlaceholder(this.widgetConfig,this.perspectiveMode)||this.perspectiveMode!==u.MODE_PERSONALIZE||u.isPersonalWidget(this.widgetConfig))&&(this.$el.addClass("csui-has-editing-capability"),delete this.widgetConfig.options.___pman_isdropped,this.listenTo(this.widgetView,"update:widget:options",function(e){delete this.widgetConfig.options.___pman_isdropped,this._notifyConfigChanges(e,e.isValid,!1)}),this.listenTo(this.widgetView,"remove:widget",this._doDeleteWidget),this.listenTo(this.widgetView,"replace:widget",this.onDrop))},"_doRefreshMask":function(e){this.options=t.extend({},this.options,g,e),this.ui.delete.attr("title",this.options.removeConfirmTitle)},"_showCallout":function(e){this.isDestroyed||this._isConfigurable()&&(e.preventDefault(),e.stopPropagation(),this.ui.delete.is(e.target)||this._loadManifest().done(function(e){this._showOptionsCallout(e)}.bind(this)))},"_showOptionsCallout":function(e,i){if(!this.isDestroyed){if(o.isIE11()&&document.activeElement&&document.activeElement.blur(),this.$popoverEl&&this.$popoverEl.data("binf.popover"))return void this.$popoverEl.binf_popover("destroy");this.$el.closest(".cs-perspective").find(".binf-popover").length&&(this._closePopover(),!i)||(this._calculatePopoverPlacement(),this.optionsFormView?this._showPopover():this._createOptionsForm())}},"_closePopover":function(){this.$el.closest(".cs-perspective").find("."+h.className+" .csui-pman-popover-holder").binf_popover("destroy")},"_createOptionsForm":function(e){this.optionsFormView=new p(t.defaults({"context":this.perspectiveView.options.context,"manifest":this.manifest},this.options)),e&&this.optionsFormView.listenToOnce(this.optionsFormView,"render:form",e),this.optionsFormView.render(),this.optionsFormView.listenTo(this.optionsFormView,"change:field",this._onChangeField.bind(this))},"_calculatePopoverPlacement":function(){var e=this._determineCalloutPlacement();this.$popoverEl=this.$el.find(".csui-pman-popover-"+e.placement),e.mirror&&(e.placement="right"==e.placement?"left":"right"),this.placement=e.placement,this.$popoverContainer=s('<div class="binf-popover pman-widget-popover pman-ms-popover" role="tooltip"><div class="binf-arrow"></div><h3 class="binf-popover-title"></h3><div class="binf-popover-content"></div></div>'),this.$popoverContainer.css("max-width",e.availableSpace+"px")},"_showPopover":function(){var e={"html":!0,"content":this.optionsFormView.el,"trigger":"manual","viewport":{"selector":this.options.perspectiveSelector,"padding":15},"placement":this.placement,"template":this.$popoverContainer,"animation":!1};this.$popoverEl.binf_popover(e),this.$popoverEl.off("hidden.binf.popover").on("hidden.binf.popover",this._handleCalloutHide.bind(this)),this.$popoverEl.binf_popover("show"),this.optionsFormView.onPopoverShow(this.$popoverContainer),this.optionsFormView.$el.find(".cs-formview-wrapper").trigger("refresh:setcontainer");var i=this.$popoverEl.next(".binf-popover"),s=i.find(".alpaca-container-item-first");if(s.length){s=s.first();var n=s.find("input:visible, textarea:visible, button.binf-dropdown-toggle:visible");n.length&&n.trigger("focus")}this._registerPopoverEvents(),this.optionsFormView.trigger("ensure:scrollbar");var o=t.uniqueId("popoverLabelId"),a=i.find(">.binf-popover-title");a&&(a.attr("id",o),a.html(this.manifest.title),i.attr("aria-labelledby",o))},"_hideCallout":function(){this.$popoverEl&&this.$popoverEl.binf_popover("destroy")},"_registerPopoverEvents":function(){s(".perspective-editing .cs-perspective-panel").off("click."+this.cid).on("click."+this.cid,{"view":this},this._documentClickHandler),s(".pman-container").off("click."+this.cid).on("click."+this.cid,{"view":this},this._documentClickHandler),s(window).off("click."+this.cid).on("resize."+this.cid,{"view":this},this._windowResizeHandler)},"_windowResizeHandler":function(e){e.data.view._hideCallout()},"_unregisterPopoverEvents":function(){s(".perspective-editing .cs-perspective-panel").off("click."+this.cid,this._documentClickHandler),s(".pman-container").off("click."+this.cid,this._documentClickHandler),s(window).off("resize."+this.cid,this._windowResizeHandler)},"_handleCalloutHide":function(){this._validateWidgetConfig(),this._unregisterPopoverEvents(),delete this.widgetConfig.options.___pman_opencallout,this._updateWidgetOptions(!0),this._enableorDisableSaveButton()},"_validateWidgetConfig":function(){var e=this.optionsFormView.getValues(),i=this.optionsFormView.validate();t.isFunction(this.widgetView.validateConfiguration)&&(i=i&&this.widgetView.validateConfiguration(e));var s=i?"removeClass":"addClass";this.$el[s]("binf-perspective-has-error")},"_enableorDisableSaveButton":function(){var e=s(".perspective-editing .pman-header .icon-save"),i=s(".perspective-editing").find(".binf-perspective-has-error").length>0;e.prop("disabled",i)},"_updateWidgetOptions":function(e,i){var s=this.optionsFormView.validate(),n=this.optionsFormView.getValues();i=t.isUndefined(i)?!e:i;var o=this._notifyConfigChanges(n,s,e,i);return this._enableorDisableSaveButton(),o},"_notifyConfigChanges":function(e,i,s,n){e=e||{};var o=this.widgetConfig.options||{},a=t.isEqual(o,e);if(this.perspectiveView.trigger("update:widget:options",{"widgetView":this.widgetView,"isValid":i,"options":e,"softUpdate":n}),!a&&i&&!this.manifest.callback&&(s||o.___pman_isdropped)){var r=this.widgetConfig.type;if(this._isPreviewWidget()){r=this.widgetConfig.options.widget.id}o.___pman_isdropped&&(e=t.extend({"___pman_opencallout":o.___pman_isdropped},e));var c={"type":r,"kind":this.widgetConfig.kind,"options":e};return this.perspectiveView.trigger("replace:widget",this.widgetView,c),!0}},"_documentClickHandler":function(e){var i=e.data.view;if(!s(e.target).closest(".binf-popover").length)return n.isNodeAttached(e.target)?void(i.$el.is(e.target)||i.$el.has(e.target).length&&!i.ui.delete.is(e.target)||i.widgetView.$el.is(e.target)||i.widgetView.$el.has(e.target).length||(i._unregisterPopoverEvents(),i._hideCallout())):void i.widgetView.trigger("reposition:flyout")},"_onChangeField":function(e){e.name===p.widgetSizeProperty?(this.perspectiveView.trigger("update:widget:size",this.options.widgetView,e.value),this.$popoverEl.binf_popover("destroy")):this.options.notifyUpdatesImmediatly&&(this._updateWidgetOptions(!1,!1),this.widgetView.trigger("reposition:flyout"))},"_evalRequiredFormWidth":function(){this.optionsFormView.$el.addClass("pman-prerender-form"),this.optionsFormView.$el.addClass("pman-widget-popover"),this.optionsFormView.$el.appendTo(document.body),this.optionsFormView.$el.find(".cs-formview-wrapper").trigger("refresh:setcontainer");var e=this.optionsFormView.$el.width();return this.optionsFormView.$el.find(".csui-scrollablecols").length>0&&(e+=this.optionsFormView.$el.find(".csui-scrollablecols")[0].scrollWidth-this.optionsFormView.$el.find(".csui-scrollablecols")[0].offsetWidth),this.optionsFormView.$el.removeClass("pman-widget-popover"),e},"_calculateSpaceAroundWidget":function(){var e=(this.$el.width(),s(document).width()),i=this.$el.find(".csui-pman-popover-left").offset().left,t=e-this.$el.find(".csui-pman-popover-right").offset().left;return{"right":{"placement":"right","mirror":!1,"availableSpace":t},"rightFlip":{"placement":"right","mirror":!0,"availableSpace":e-t},"left":{"placement":"left","mirror":!1,"availableSpace":i},"leftFlip":{"placement":"left","mirror":!0,"availableSpace":e-i}}},"_determineCalloutPlacement":function(){var e,t,s,n=i&&i.settings.rtl,o=this._evalRequiredFormWidth()+20,a=this._calculateSpaceAroundWidget(),r=n?[a.rightFlip,a.leftFlip,a.left,a.right]:[a.right,a.left,a.leftFlip,a.rightFlip];for(e=0;e<r.length;e++){var c=r[e];if(o<c.availableSpace){t=c;break}(!s||c.availableSpace>s.availableSpace)&&(s=c)}return t||(t=s),t.availableSpace-=20,t},"_isPreviewWidget":function(){return this.widgetConfig.type===h.perspectiveWidget},"_loadManifest":function(){if(void 0!==this.manifest)return s.Deferred().resolve(this.manifest);if(this._isPreviewWidget())return this.manifest=this.widgetConfig.options.widget.get("manifest"),this._loadManifest();var e=s.Deferred(),i=this,t=new c({"id":this.widgetConfig.type});return t.fetch().then(function(){i.manifest=t.get("manifest"),e.resolve(i.manifest)},function(i){e.reject(i)}),e.promise()},"onDeleteClick":function(e){if(this._closePopover(),e.preventDefault(),this.options.confirmOnRemove){var i=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(e){e.confirmQuestion(i.options.removeConfirmMsg,i.options.removeConfirmTitle,{"buttons":{"showYes":!0,"labelYes":l.remove,"showNo":!0,"labelNo":l.cancel}}).done(function(e){e&&i._doDeleteWidget()})})}else this._doDeleteWidget()},"_doDeleteWidget":function(){this.perspectiveView.trigger("delete:widget",this.widgetView),this._enableorDisableSaveButton()},"_doReplaceWidget":function(e){var i=e.get("manifest")||{},s={"type":e.id,"kind":i.kind};u.isEligibleForLiveWidget(i)||(s={"type":h.perspectiveWidget,"kind":i.kind,"options":{"options":{},"widget":e}}),s.options=t.extend({"___pman_isdropped":!0},s.options),this.perspectiveView.trigger("replace:widget",this.widgetView,s)},"onDragOver":function(e){e.preventDefault()},"onDragEnter":function(e){e.preventDefault(),this.dropCounter++,this.$el.siblings(".csui-perspective-placeholder").addClass("csui-widget-drop")},"onDragLeave":function(){0===--this.dropCounter&&this.$el.siblings(".csui-perspective-placeholder").removeClass("csui-widget-drop")},"_extractWidgetToDrop":function(e){var i=e.originalEvent.dataTransfer.getData("text");if(i)try{return new c(JSON.parse(i))}catch(e){return!1}},"onDrop":function(e){e.preventDefault(),this.onDragLeave();var i=this._extractWidgetToDrop(e);if(i)if(this.widgetConfig.type===h.placeholderWidget)this._doReplaceWidget(i);else{var t=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(e){e.confirmQuestion(l.replaceConfirmMsg,l.replaceConfirmTitle,{"buttons":{"showYes":!0,"labelYes":l.replace,"showNo":!0,"labelNo":l.cancel}}).done(function(e){e&&t._doReplaceWidget(i)})})}},"_updateStyles":function(){var e=t.result(this,"className");this.$el.attr("class",e)},"_onHideWidget":function(){this.perspectiveView.trigger("before:hide:widget",this.widgetView),u.setWidgetHidden(this.widgetConfig,!0),this._notifyConfigChanges(this.widgetConfig.options,!0,!1),this._updateStyles(),this.perspectiveView.trigger("hide:widget",this.widgetView)},"_onShowWidget":function(){this.perspectiveView.trigger("before:show:widget",this.widgetView),u.setWidgetHidden(this.widgetConfig,!1),this._notifyConfigChanges(this.widgetConfig.options,!0,!1),this._updateStyles(),this.perspectiveView.trigger("show:widget",this.widgetView)}},{"className":"csui-configure-perspective-widget","perspectiveWidget":"csui/perspective.manage/widgets/perspective.widget","placeholderWidget":"csui/perspective.manage/widgets/perspective.placeholder","widgetSizeProperty":"__widgetSize"});return n.Behavior.extend({"defaults":{"perspectiveSelector":".perspective-editing .cs-perspective > div"},"constructor":function(e,i){e||(e={}),e.perspectiveView=e.perspectiveView||i,this.perspectiveView=e.perspectiveView,n.Behavior.prototype.constructor.apply(this,arguments),this.view=i,t.extend(this.perspectiveView,{"getPManPlaceholderWidget":function(){return{"type":h.placeholderWidget,"options":{}}}})},"_ensureWidgetElement":function(){if(t.isObject(this.$widgetEl)||(this.$widgetEl=this.options.el?s(this.options.el):this.view.$el),!this.$widgetEl||0===this.$widgetEl.length)throw new n.Error('An "el" '+this.$widgetEl.selector+" must exist in DOM");return!0},"_checkAndApplyMask":function(){if(this._ensureWidgetElement(),!(this.$widgetEl.children("."+h.className).length>0)){var e=this._resolveWidgetConfiguration();if(!e)throw new n.Error({"name":"NoWidgetConfigurationError","message":'A "widgetConfig" must be specified'});this.maskingView&&this.$widgetEl.has(this.maskingView.$el).length&&t.isEqual(e,this.options.widgetConfig)||(this.maskingView&&this.maskingView.destroy(),this.maskingView=new h(t.extend(this.options,{"widgetView":this.view,"widgetConfig":e})),this.maskingView.render(),this.$widgetEl.append(this.maskingView.el),this.$widgetEl.addClass("csui-pman-editable-widget"),this.$widgetEl.data("pman.widget",{"attributes":{"manifest":e}}),e.type===h.placeholderWidget&&this.$widgetEl.removeClass("csui-draggable-item"))}},"_resolveWidgetConfiguration":function(){return this.view.model&&this.view.model.get("widget")?this.view.model.get("widget"):this.view.getPManWidgetConfig&&t.isFunction(this.view.getPManWidgetConfig)?this.view.getPManWidgetConfig():this.options.widgetConfig?t.result(this.options,"widgetConfig"):void 0},"onRender":function(){this.options.notifyUpdatesImmediatly&&this.view.isUpdating||(this._checkAndApplyMask(),this.maskingView&&this.maskingView._enableorDisableSaveButton())},"onDestroy":function(){this.maskingView&&this.maskingView.destroy(),this.maskingView=void 0}})}),csui.define("csui/perspective.manage/pman.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/utils/non-emptying.region/non-emptying.region","csui/perspective.manage/impl/pman.panel.view","csui/utils/perspective/perspective.util","csui/utils/contexts/factories/application.scope.factory","csui/utils/contexts/factories/node","csui/utils/contexts/factories/user","csui/models/perspective/personalization.model","i18n!csui/perspective.manage/impl/nls/lang","hbs!csui/perspective.manage/impl/pman","css!csui/perspective.manage/impl/pman","csui/perspective.manage/behaviours/pman.widget.config.behaviour"],function(e,i,t,s,n,o,a,r,c,p,l,d,u,g){var h;return s.ItemView.extend({"className":function(){var i=["pman","pman-container"];return i.push("pman-mode-"+this.options.mode),e.unique(i).join(" ")},"template":g,"templateHelpers":function(){return{"addWidget":u.addWidget,"save":u.save,"cancel":u.cancel,"reset":u.reset,"personalizeMode":this.mode===r.MODE_PERSONALIZE&&(this.options.perspective.has("perspective_id")||this.options.perspective.has("id"))}},"ui":{"pmanPanel":".pman-header .pman-pannel-wrapper","cancelEdit":".pman-header .cancel-edit","addIcon":".pman-header .icon-toolbarAdd","saveBtn":".pman-header .icon-save","trashArea":".pman-header .pman-trash-area","resetBtn":".pman-header .icon-reset"},"events":{"click @ui.cancelEdit":"onClickClose","click @ui.addIcon":"togglePannel","click @ui.saveBtn":"onClickSave","click @ui.resetBtn":"onClickReset"},"constructor":function(t){t||(t={}),e.defaults(t,{"applyMasking":this.applyMasking.bind(this),"container":document.body,"mode":r.MODE_EDIT_PERSPECTIVE}),t.container=i(t.container),this.context=t.context,this.applicationScope=this.context.getModel(c),this.mode=t.mode,this._prepareForEdit(t.perspective),s.ItemView.prototype.constructor.call(this,t),this._registerEventHandler()},"_registerEventHandler":function(){this.listenTo(this,"change:layout",function(e){this.perspective.setPerspective({"type":e,"options":{"perspectiveMode":this.mode}},{"silent":!0}),this._triggerEditMode(),this.togglePannel()}),this.listenTo(this.context,"save:perspective",this._savePerspective),this.listenTo(this.context,"change:perspective",this._onChangePerspective),this.listenTo(this.context,"retain:perspective",this._doExitPerspective),this.listenTo(this.context,"finish:exit:edit:perspective",this._doCleanup)},"_prepareForEdit":function(e){if(!e)throw new Error("Missing perspective");this.perspective=this._clonePrespective(e),this.perspective.isNew()&&this.mode===r.MODE_EDIT_PERSPECTIVE&&this.perspective.setPerspective(this._getDefaultPerspectiveConfig())},"_clonePrespective":function(e){var i=e.getPerspective(),t=JSON.parse(JSON.stringify(i));return e.setPerspective(t),e},"show":function(){var e=this.getContainer();return new o({"el":e}).show(this),this},"getContainer":function(){return h&&i.contains(this.options.container,h)||(h=i("<div>",{"class":"binf-widgets"}).appendTo(this.options.container)[0]),h},"_getDefaultPerspectiveConfig":function(){return{"type":"left-center-right","options":{"center":{"type":"csui/widgets/nodestable"}}}},"_savePerspective":function(i){if(i&&i.error)return void this.ui.saveBtn.prop("disabled",!1);this.perspective.update(i),this.perspective.save().then(e.bind(this._onSaveSuccess,this),e.bind(this._onSaveError,this))},"_onSaveSuccess":function(){var i=this;i.mode===r.MODE_EDIT_PERSPECTIVE?this._showMessage("success",u.perspectiveSaveSuccess):this._showMessage("success",u.personalizationSaveSuccess);var t=i.context.perspective.get("perspectiveMode")||r.MODE_EDIT_PERSPECTIVE,s=i._getSourceModel(),n=i.perspective.getPerspective();if(n.id=i.perspective.getPerspectiveId(),i.mode===r.MODE_EDIT_PERSPECTIVE){var o=s.get("perspective");s.set("perspective",e.defaults(n,o))}else{var o=s.get("perspective");s.set("perspective",e.defaults({"personalizations":i.perspective.toJSON()},o))}if(t===i.mode)i.context.perspective.set(n);else if(i.mode===r.MODE_EDIT_PERSPECTIVE){var a=new d({},{"perspective":n});a.setPerspective(i.context.perspective.toJSON()),n=a.getPerspective(),i.context.perspective.set(n)}else if(i.mode===r.MODE_PERSONALIZE){var a=new d({},{"perspective":s.get("perspective")});a.setPerspective(n),n=a.getPerspective(),i.context.perspective.set(n)}i._doExitPerspective()},"_onSaveError":function(e){this.ui.saveBtn.prop("disabled",!1);var t;if(e&&e.responseJSON&&e.responseJSON.error)t=e.responseJSON.error;else{var s=n.MessageHelper.toHtml();n.MessageHelper.reset(),t=i(s).text()}this._showMessage("error",t)},"_showMessage":function(e,i){csui.require(["csui/controls/globalmessage/globalmessage"],function(t){t.showMessage(e,i)})},"onClickSave":function(){this.ui.saveBtn.prop("disabled",!0);var e=this.options.container.find(".binf-popover");e.length&&e.binf_popover("hide"),this.context.triggerMethod("serialize:perspective",this.perspective)},"onClickReset":function(){var e=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(i){i.confirmQuestion(u.resetConfirmMsg,u.reset,{"buttons":{"showYes":!0,"labelYes":u.reset,"showNo":!0,"labelNo":u.cancel}}).done(function(i){i&&e._doReset()})})},"_doReset":function(){var e=this._getSourceModel();originalPerspective=JSON.parse(JSON.stringify(e.get("perspective"))),originalPerspective.options=originalPerspective.options||{},originalPerspective.options.perspectiveMode=this.mode;var i=new t.Model(originalPerspective);this.context.triggerMethod("enter:edit:perspective",i),this.listenToOnce(this.context,"finish:enter:edit:perspective",function(){this._showMessage("success",u.resetSuccessful)})},"_getSourceModel":function(e){var i;return"node"===this.applicationScope.get("id")?i=this.context.getModel(p):this.applicationScope.get("id")||(i=this.context.getModel(l)),i},"onClickClose":function(){this._doExitPerspective()},"togglePannel":function(){this.ui.pmanPanel.hasClass("binf-active")?this._closeToolsPanel():this._openToolsPanel()},"_openToolsPanel":function(){this.pmanPanelView.trigger("reset:items"),this.ui.addIcon.addClass("binf-active"),this.ui.addIcon.attr("title",u.close),this.ui.pmanPanel.addClass("binf-active"),this.pmanPanelView.triggerMethod("panel:open")},"_closeToolsPanel":function(){this.ui.pmanPanel.removeClass("binf-active"),this.ui.addIcon.attr("title",u.addWidget),this.ui.addIcon.removeClass("binf-active")},"applyMasking":function(){},"_initializeWidgets":function(){this.mode!==r.MODE_PERSONALIZE&&(this.pmanPanelRegion=new s.Region({"el":this.ui.pmanPanel}),this.pmanPanelView=new a({"pmanView":this}),this.pmanPanelRegion.show(this.pmanPanelView),e.isFunction(this.ui.trashArea.droppable)&&this.ui.trashArea.droppable({"tolerance":"pointer","hoverClass":"pman-trash-hover","accept":function(){return!1}}))},"_triggerEditMode":function(){var e=this.perspective.getPerspective();e.options=e.options||{},e.options.perspectiveMode=this.mode;var i=new t.Model(e);this.context.triggerMethod("enter:edit:perspective",i)},"_beforeTransition":function(){var e=this.options.container.find(".cs-perspective");this.options.container.addClass("perspective-editing-transition"),n.onTransitionEnd(e,function(){this.options.container.removeClass("perspective-editing-transition")},this)},"onRender":function(){this._beforeTransition(),this.options.container.addClass("perspective-editing"),this.options.applyMasking(),this._initializeWidgets(),this._triggerEditMode(),i(document).on("click."+this.cid,{"view":this},this._documentClick)},"_documentClick":function(e){var i=e.data.view;i.ui.addIcon.is(e.target)||i.ui.addIcon.has(e.target).length||i.ui.pmanPanel.is(e.target)||i.ui.pmanPanel.has(e.target).length||i._closeToolsPanel()},"_onChangePerspective":function(){this._doCleanup()},"_doCleanup":function(){var e=this.options.container.find(".binf-popover");this._beforeTransition(),e.length&&e.binf_popover("destroy"),this.options.container.removeClass("perspective-editing"),i(document).off("click."+this.cid,this._documentClick),this.trigger("destroy")},"_doExitPerspective":function(){this.context.triggerMethod("exit:edit:perspective",this.perspective)}})}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/root/lang",{"dndWidgetsHere":"Drag and Drop widgets here"}),csui.define("hbs!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="csui-placeholder-title" title="'+this.escapeExpression((n=null!=(n=i.dndWidgetsHere||(null!=e?e.dndWidgetsHere:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"dndWidgetsHere","hash":{}}):n))+'">\r\n  <div class="csui-placeholder-icon"></div>\r\n  <div>'+this.escapeExpression((n=null!=(n=i.dndWidgetsHere||(null!=e?e.dndWidgetsHere:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"dndWidgetsHere","hash":{}}):n))+"</div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_widgets_perspective.placeholder_impl_perspective.placeholder",s),s}),csui.define("css!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder",[],function(){}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","i18n!csui/perspective.manage/widgets/perspective.placeholder/impl/nls/lang","hbs!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder","css!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder"],function(e,i,t,s,n){return t.ItemView.extend({"className":"csui-perspective-placeholder","template":n,"templateHelpers":function(){return{"dndWidgetsHere":s.dndWidgetsHere}},"constructor":function(e){t.ItemView.apply(this,arguments)},"onShow":function(){this.$el.parent().addClass("csui-pman-placeholder-container")},"onDestroy":function(){this.$el.parent().removeClass("csui-pman-placeholder-container")}})}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/root/lang",{"noConfig":"No configuration needed","clickToConfig":"Configuration needed"}),csui.define("hbs!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="tile-header">\r\n  <div class="tile-title">\r\n    <h2 class="csui-heading" title="'+this.escapeExpression((n=null!=(n=i.widgetTitle||(null!=e?e.widgetTitle:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetTitle","hash":{}}):n))+'">'+this.escapeExpression((n=null!=(n=i.widgetTitle||(null!=e?e.widgetTitle:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetTitle","hash":{}}):n))+'</h2>\r\n  </div>\r\n</div>\r\n<div>\r\n  <div title="'+this.escapeExpression((n=null!=(n=i.widgetMessage||(null!=e?e.widgetMessage:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetMessage","hash":{}}):n))+'" class="csui-pman-widget-msg">\r\n    <div class="csui-pman-widget-icon"></div>\r\n    <div>'+this.escapeExpression((n=null!=(n=i.widgetMessage||(null!=e?e.widgetMessage:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetMessage","hash":{}}):n))+"</div>\r\n  </div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_widgets_perspective.widget_impl_perspective.widget",s),s}),csui.define("css!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget",[],function(){}),csui.define("csui/perspective.manage/widgets/perspective.widget/perspective.widget.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","i18n!csui/perspective.manage/widgets/perspective.widget/impl/nls/lang","hbs!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget","css!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget"],function(e,i,t,s,n){return t.ItemView.extend({"className":"csui-pman-widget","template":n,"templateHelpers":function(){var i=this.widget&&this.widget.get("manifest"),t=this.widget&&this.widget.get("title"),n=!i||!i.schema||!i.schema.properties||e.isEmpty(i.schema.properties);return{"widgetTitle":t||s.noTitle,"widgetMessage":n?s.noConfig:s.clickToConfig}},"constructor":function(i){i||(i={}),i=e.defaults(i,{"data":{}}),t.ItemView.apply(this,arguments),this.widget=i.data.widget}})}),csui.define("json!csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{title}}","description":"{{description}}","kind":"tile","schema":{"type":"object","properties":{}}}),csui.define("json!csui/perspective.manage/widgets/perspective.widget/perspective.widget.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{title}}","description":"{{description}}","kind":"tile","schema":{"type":"object","properties":{}}}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/perspective.placeholder.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/root/perspective.placeholder.manifest",{"dndWidgetsHere":"Drag and Drop widgets here"}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/perspective.widget.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/root/perspective.widget.manifest",{"noConfig":"No configuration needed","clickToConfig":"Configuration needed"}),csui.define("bundles/csui-perspective",["csui/perspective.manage/pman.view","csui/perspective.manage/behaviours/pman.widget.config.behaviour","csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.view","csui/perspective.manage/widgets/perspective.widget/perspective.widget.view","json!csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.manifest.json","json!csui/perspective.manage/widgets/perspective.widget/perspective.widget.manifest.json","i18n!csui/perspective.manage/widgets/perspective.placeholder/impl/nls/perspective.placeholder.manifest","i18n!csui/perspective.manage/widgets/perspective.widget/impl/nls/perspective.widget.manifest"],{}),csui.require(["require","css"],function(e,i){i.styleLoad(e,"csui/bundles/csui-perspective",!0)});
//# sourceMappingURL=csui-perspective.js.map